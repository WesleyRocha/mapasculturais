{"version":3,"sources":["application/themes/BaseV1/assets/js/mapasculturais.js","application/themes/BaseV1/assets/js/ng-mapasculturais.js","application/themes/BaseV1/assets/js/ng.mc.module.notifications.js"],"names":["MapasCulturais","$","TemplateManager","init","Modal","initKeyboard","initDialogs","initButtons","EditBox","initBoxes","Video","setupVideoGallery","Search","click","this","parent","slideUp","css","request","controller","App","$els","entity","useRegistrations","hide","on","e","reason","editable","fadeIn","fadeOut","$self","$target","eval","data","one","event","find","target","length","fadeToggle","$dropdown","parents","$submenu","is","show","roleToRemove","roleToAdd","label","html","change","post","baseURL","id","role","r","error","spinnerURL","assetURL","navigator","appName","userAgent","indexOf","addClass","ua","toLowerCase","isNaN","version","parseInt","split","getTypeName","utils","getObjectProperties","obj","keys","key","push","sortOjectProperties","newObj","sort","forEach","isObjectEquals","obj1","obj2","JSON","stringify","inArray","array","i","arraySearch","createUrl","controller_id","action_name","args","shortcuts","routes","actions","controllers","u","route","default_action_name","val","auth","cb","require","attr","finish","templates","$templates","$this","each","text","remove","getTemplate","selector","trigger","defaultAvatarURL","assets","avatarAgent","editableEntityAddHash","href","cleanHref","location","hash","jQuery","document","ready","window","Messages","delayToFadeOut","fadeOutSpeed","showMessage","type","message","$container","$message","$mainSection","append","hasClass","slideDown","animate","marginTop","delay","success","help","alert","confirm","time","body","keyup","keyCode","$dialog","prepend","close","dialog_selector","open","setTimeout","top","height","scrollTop","left","marginLeft","width","opacity","setPosition","$box","position","my","at","of","submit_label","cancel_label","submit","$button","AjaxUploader","resetProgressBar","not","first","focus","collection","parseURL","url","purl","isYoutube","parsedURL","getYoutubeData","youtubeVideoID","thumbnalURL","videoID","playerURL","getVideoBasicData","host","provider","param","gallerySelector","getAndSetVideoData","setupVideoGalleryItem","$firstItem","videoData","$element","thumbnailURL","video_id","removeClass","setTitle","videoTitle","videoURL","callback","trim","details","getJSON","entry","title","$t","tmpArray","format","thumbnail_small","withDetails","functionName","limit","$selector","name","select2","placeholder","minimumInputLength","allowClear","initSelection","ajax","apiMethod","formats","dataType","quietMillis","term","page","searchParams","getEntityController","ajaxData","results","more","formatResult","result","formatSelection","selection","formatNoMatches","noMatches","escapeMarkup","m","stopPropagation","arguments","input","$input","onSave","console","log","onHidden","entitiyControllers","default","replace","@select","@limit","@page","@order","@files","agent","processEntity","areas","terms","area","join","linguagens","linguagem","tags","thumbnail","entityDefaultAvatar","toUpperCase","slice","renderTemplate","template","Mustache","render","getEntityThumbnail","thumbName","files","searchResultTemplate","excludedIds","toString","chooseProject","onClear","chooseSpace","avatarUrl","shortDescription","avatar","avatarSmall","createAgentRelation","$selectionTarget","targetAction","selectionTemplate","groupname","agentId","group","has_control","RelatedAgents","addAgentToGroup","markup","noResultTemplate","agentRelationGroupExludeIds","concat","map","toArray","parentSpace","excludeIds","childrenIds","parentProject","projectRegistration","cookies","get","user","isUserProfile","changeOwner","ownerId","nameEQ","ca","cookie","c","charAt","substring","set","value","options","extend","expires","days","t","Date","setDate","getDate","toUTCString","String","encodeURIComponent","raw","path","domain","secure","Map","initialize","mapSelector","locateMeControl","exportToGlobalScope","mapCenter","angular","app","module","config","$httpProvider","responseInterceptors","$q","$rootScope","promise","$broadcast","then","response","reject","factory","$log","$http","service","deferred","defer","resolve","updateOne","action","$sce","$scope","$interval","NotificationService","panelURI","notifications","index","trustAsHtml","getNotifications","approve","delete","adjustScroll","slimScroll","distance","color","alwaysVisible","railVisible","directive","scope","element","attrs","$last","$evalAsync","onLastRepeat","moduleName","ctrl","querySelector","parentElement","bootstrap"],"mappings":"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","file":"/vagrant/src/assets/js/app-b09e83ca76bbbe390e2b9e2a7405a4b2.js","sourcesContent":["MapasCulturais = MapasCulturais || {};\n\n$(function(){\n//    $.fn.select2.defaults.separator = '; ';\n//    $.fn.editabletypes.select2.defaults.viewseparator = '; ';\n    MapasCulturais.TemplateManager.init();\n    MapasCulturais.Modal.initKeyboard('.js-dialog');\n    MapasCulturais.Modal.initDialogs('.js-dialog');\n    MapasCulturais.Modal.initButtons('.js-open-dialog');\n\n    MapasCulturais.EditBox.initBoxes('.js-editbox');\n    MapasCulturais.EditBox.initButtons('.js-open-editbox');\n\n\n    MapasCulturais.Video.setupVideoGallery('.js-videogallery');\n    MapasCulturais.Search.init(\".js-search\");\n\n    // bind alert close buttons\n    $('.alert .close').click(function(){\n        $(this).parent().slideUp('fast');\n    }).css('cursor', 'pointer');\n    \n    if(MapasCulturais.request.controller === 'app'){\n        MapasCulturais.App.init();\n    }\n\n    // dropdown\n\n    if(MapasCulturais.request.controller === 'project') {\n        var $els = $('#tab-inscricoes,#tab-inscritos').parent();\n        if(!MapasCulturais.entity.useRegistrations){\n            $els.hide();\n        }\n        $('#editable-use-registrations').on('hidden', function(e, reason) {\n            if($(this).editable('getValue', true) == '1'){\n                $els.fadeIn('fast');\n            }else{\n                $els.fadeOut('fast');\n            }\n        });\n    }\n\n    //main nav submenus toggle on click\n    $('body').on('click', '.js-submenu-toggle', function(){\n        var $self = $(this),\n            $target = eval($self.data('submenu-target'));\n        //hides by clicking outside\n        $('body').one('click', function(event){\n            if($self.find(event.target).length == 0){\n                $target.fadeOut(0);\n            }\n        });\n        $target.fadeToggle(100);\n    });\n\n    $('body').on('click', '.dropdown .placeholder', function(){\n        var $dropdown = $(this).parents('.dropdown'),\n            $submenu = $dropdown.find('.submenu-dropdown');\n\n        if($submenu.is(':visible')){\n            $submenu.hide();\n        }else{\n            $submenu.show();\n        }\n\n        if(!$dropdown.data('init')){\n            $dropdown.data('init', true);\n\n            if($dropdown.data('closeonclick')){\n                $submenu.click(function(){\n                    $submenu.hide();\n                });\n            }\n            //mouse leave disabled\n            // var $timeout;\n            // $submenu.on('mouseleave', function(){\n            //     $timeout = setTimeout(function(){\n            //         $submenu.hide();\n            //     }, 100);\n            // });\n            // $submenu.on('mouseenter', function(){\n            //     clearTimeout($timeout);\n            // });\n            // $dropdown.on('mouseenter', function(){\n            //     clearTimeout($timeout);\n            // });\n            $('body').on('click', function(event){\n                if($submenu.find(event.target).length == 0 && $dropdown.find(event.target).length == 0){\n                    $submenu.hide();\n                }\n            });\n        }\n    });\n\n     if($('#funcao-do-agente').length){\n        $('#funcao-do-agente .js-options li').click(function(){\n            var roleToRemove = $('#funcao-do-agente .js-selected span').data('role');\n            var roleToAdd = $(this).data('role');\n            var label = $(this).find('span').html();\n\n            var change = function(){\n                $('#funcao-do-agente .js-selected span').html(label);\n                $('#funcao-do-agente .js-selected span').data('role', roleToAdd);\n            };\n\n            if(roleToRemove)\n                $.post(MapasCulturais.baseURL + 'agent/removeRole/' + MapasCulturais.entity.id, {role: roleToRemove}, function(r){ if(r && !r.error) change(); });\n\n            if(roleToAdd)\n                $.post(MapasCulturais.baseURL + 'agent/addRole/' + MapasCulturais.entity.id, {role: roleToAdd}, function(r){ if(r && !r.error) change(); });\n\n\n        });\n    }\n\n    MapasCulturais.spinnerURL = MapasCulturais.assetURL + '/img/spinner.gif';\n\n\n    // identify Internet Explorer\n    if(navigator.appName != 'Microsoft Internet Explorer' && !(navigator.appName == 'Netscape' && navigator.userAgent.indexOf('Trident') !== -1)){\n        //not IE\n    }else{\n        // is IE\n        $('body').addClass('ie');\n        //identify version\n        var ua = navigator.userAgent.toLowerCase();\n        if(!isNaN(version = parseInt(ua.split('msie')[1]))){ // 7, 8, 9, 10\n            $('body').addClass('ie'+version);\n        }else if( parseInt(ua.split('rv:')[1]) === 11) { // 11\n            $('body').addClass('ie11');\n        }\n    }\n\n    if(MapasCulturais.entity){\n        MapasCulturais.entity.getTypeName = function(){\n            switch(MapasCulturais.request.controller){\n                case 'agent' : return 'agente'; break;\n                case 'space' : return 'espa√ßo'; break;\n                case 'event' : return 'evento'; break;\n                case 'project' : return 'projeto'; break;\n            }\n        };\n    }\n\n});\n\nMapasCulturais.utils = {\n    getObjectProperties: function (obj) {\n        var keys = [];\n        for (var key in obj) {\n            keys.push(key);\n        }\n        return keys;\n    },\n    sortOjectProperties: function(obj){\n        var newObj = {};\n\n        this.getObjectProperties(obj).sort().forEach(function(e){\n            newObj[e] = obj[e];\n        });\n\n        return newObj;\n    },\n\n    isObjectEquals: function(obj1, obj2){\n//        console.log(JSON.stringify(this.sortOjectProperties(obj1)), JSON.stringify(this.sortOjectProperties(obj2)));\n        return JSON.stringify(this.sortOjectProperties(obj1)) === JSON.stringify(this.sortOjectProperties(obj2));\n    },\n\n    inArray: function(array, obj){\n        for(var i in array){\n            if(this.isObjectEquals(array[i], obj)){\n                return true;\n            }\n        }\n        return false;\n    },\n\n    arraySearch: function(array, obj){\n        for(var i in array){\n            if(this.isObjectEquals(array[i], obj)){\n                return i;\n            }\n        }\n        return false;\n    }\n};\n\nMapasCulturais.createUrl = function(controller_id, action_name, args){\n    var shortcuts = this.routes.shortcuts,\n        actions = this.routes.actions,\n        controllers = this.routes.controllers,\n\n        u = MapasCulturais.utils,\n        route = '';\n\n    action_name = action_name || this.routes.default_action_name;\n\n    if(args){\n        args = u.sortOjectProperties(args);\n    }\n\n    if(args && u.inArray(shortcuts, [controller_id, action_name, args])){\n        route = u.arraySearch(shortcuts, [controller_id, action_name, args]) + '/';\n        args = null;\n    }else if(u.inArray(shortcuts, [controller_id, action_name])){\n        route = u.arraySearch(shortcuts, [controller_id, action_name]) + '/';\n    }else{\n        if(u.inArray(controllers, controller_id)){\n            route = u.arraySearch(controllers, controller_id) + '/';\n        }else{\n            route = controller_id + '/';\n        }\n\n        if(action_name !== this.routes.default_action_name){\n            if(u.inArray(actions, action_name)){\n                route += u.arraySearch(actions, action_name) + '/';\n            }else{\n                route += action_name + '/';\n            }\n        }\n    }\n\n    if(args){\n        for(var key in args){\n            var val = args[key];\n            if(key == parseInt(key)){ // is integer\n                route += val + '/';\n            }else{\n                route += key + ':' + val + '/';\n            }\n        }\n    }\n\n    return MapasCulturais.baseURL + route;\n};\n\nMapasCulturais.auth = {\n    cb: null,\n    require: function(cb){\n        MapasCulturais.auth.cb = cb;\n            $('#require-authentication').attr('src',MapasCulturais.baseURL + 'panel/requireAuth').fadeIn();\n    },\n\n    finish: function(){\n        if(MapasCulturais.auth.cb){\n            MapasCulturais.auth.cb();\n        }\n\n        MapasCulturais.auth.cb = null;\n        $('#require-authentication').fadeOut();\n    }\n}\n\nMapasCulturais.TemplateManager = {\n    templates: {},\n    init: function(){\n        var $templates = $('.js-mustache-template');\n        var $this = this;\n        $templates.each(function(){\n            $this.templates[$(this).attr('id')] = $(this).text();\n            $(this).remove();\n        });\n    },\n\n    getTemplate: function(id){\n        if(this.templates[id])\n            return this.templates[id];\n        else\n            return null;\n    }\n};\n\nMapasCulturais.App = {\n    init: function(){\n        $('.js-select-on-click').on('click', function(){\n            var selector = $(this).data('selectTarget');\n            $(selector).trigger('doubleClick');\n        });\n        \n        if($('.js-input--app-key').length && $('.js-input--app-key--toggle').length){\n            $('.js-input--app-key--toggle').on('click', function(){\n                if($('.js-input--app-key').attr('type') === 'password'){\n                    $('.js-input--app-key').attr('type', 'text');\n                }else{\n                    $('.js-input--app-key').attr('type', 'password');\n                }\n                \n                return false;\n            });\n        }\n    }\n};\n\nMapasCulturais.defaultAvatarURL = MapasCulturais.assets.avatarAgent;\n\nfunction editableEntityAddHash(){\n    $('#editable-entity').find('.js-toggle-edit').each(function(){\n        var href = $(this).attr('href'),\n            cleanHref = href.indexOf('#') !== -1 ? href.split('#')[0] : href;\n        $(this).attr('href', cleanHref+location.hash);\n    });\n}\njQuery(document).ready(function(){\n    editableEntityAddHash();\n    $(window).on('hashchange', function(){\n        editableEntityAddHash();\n    });\n});\n\n\nMapasCulturais.Messages = {\n    delayToFadeOut: 5000,\n    fadeOutSpeed: 'slow',\n    showMessage: function(type, message) {\n        var $container = $('#editable-entity');\n        var $message = $('<div class=\"alert ' + type + '\">\"').html(message);\n        var $mainSection = $('#main-section');\n        var delayToFadeOut = this.delayToFadeOut;\n        $container.append($message);\n\n        if($container.hasClass('js-not-editable')){\n            $container.slideDown('fast');\n            $mainSection.animate({marginTop: parseInt($mainSection.css('margin-top')) + 42}, 'fast', function(){\n                $message.css('display', 'inline-block').css('display', 'inline-block').delay(delayToFadeOut).fadeOut(this.fadeOutSpeed, function() {\n                    $(this).remove();\n                    if($container.find('>').length === 0){\n                        $container.slideUp('fast');\n                        $mainSection.animate({marginTop: parseInt($mainSection.css('margin-top')) - 42}, 'fast');\n                    }\n                });\n            });\n        }else{\n            $message.css('display', 'inline-block').css('display', 'inline-block').delay(delayToFadeOut).fadeOut(this.fadeOutSpeed, function() {\n                $(this).remove();\n            });\n        }\n\n    },\n    success: function(message) {\n        this.showMessage('success', message);\n    },\n    error: function(message) {\n        this.showMessage('danger', message);\n    },\n    help: function(message) {\n        this.showMessage('info', message);\n    },\n    alert: function(message) {\n        this.showMessage('warning', message);\n    }\n\n}\n\nMapasCulturais.confirm = function (message, cb){\n    if(confirm(message))\n        cb();\n};\n\nMapasCulturais.Modal = {\n    time: 'fast',\n    initKeyboard: function (selector){\n        $(document.body).keyup(function (e){\n            if(e.keyCode == 27){\n                $(selector).each(function(){\n                   if($(this).is(':visible')) {\n                       $(this).find('.js-close').click();\n                   }\n                });\n            }\n        });\n    },\n\n    initDialogs: function(selector){\n        $(selector).each(function(){\n            $('body').append($(this));\n            if($(this).find('.js-dialog-disabled').length)\n                return;\n\n            if($(this).data('dialog-init'))\n                return;\n\n            var $dialog = $(this);\n            /*$dialog.hide();  Moved to style.css */\n\n            $dialog.data('dialog-init', 1);\n            $dialog.prepend('<h2>' + $(this).attr('title') + '</h2>');\n            $dialog.prepend('<a href=\"#\" class=\"js-close icon icon-close\"></a>');\n\n            // close button\n            $dialog.find('.js-close').click(function (){\n                MapasCulturais.Modal.close(selector);\n                return false;\n            });\n        });\n    },\n\n    initButtons: function(selector){\n\n        if($(selector).data('button-initialized')) return false;\n        else $(selector).data('button-initialized', true);\n        $(selector).each(function(){\n            var dialog_selector = $(this).data('dialog');\n            var $dialog = $(dialog_selector);\n            if($dialog.find('.js-dialog-disabled').length)\n                $(this).addClass('inactive').addClass('hltip').attr('title', $dialog.find('.js-dialog-disabled').data('message'));\n\n        });\n        $(selector).click(function(){\n            if($(this).hasClass('inactive'))\n                return false;\n\n            var dialog_selector = $(this).data('dialog');\n            MapasCulturais.Modal.open(dialog_selector);\n            if( $(this).data('dialog-callback') )\n                eval( $(this).data('dialog-callback'))($(this));\n            return false;\n        });\n    },\n\n    close: function(selector){\n        $('body').css('overflow','auto');\n        var $dialog = $(selector);\n        //alert('closing');\n        $dialog.find('.editable').editable('hide');\n        $dialog.hide();\n        return;\n    },\n\n    open: function(selector){\n        var $dialog = $(selector);\n\n        $dialog.find('div.alert.danger').html('').hide();\n        $dialog.find('.js-ajax-upload-progress').hide();\n        $dialog.css('opacity',0).show();\n        setTimeout(function(){\n           var top = $dialog.height() + 100 > $(window).height() ? $(window).scrollTop() + 100 : $(window).scrollTop() + ( $(window).height() - $dialog.height()) / 2 - 50;\n\n           $dialog.css({\n                top: top,\n                left: '50%',\n                marginLeft: -$dialog.width() / 2,\n                opacity: 1\n            });\n        },25);\n\n\n        return;\n    }\n};\n\n\nMapasCulturais.EditBox = {\n    time: 'fast',\n\n    setPosition: function($box, target){\n        if($box.hasClass('mc-left')){\n            $box.position({\n                my: 'right-10 center',\n                at: 'left center',\n                of: target\n            });\n\n        }else if($box.hasClass('mc-right')){\n            $box.position({\n                my: 'left+10 center',\n                at: 'right center',\n                of: target\n            });\n\n        }else if($box.hasClass('mc-top')){\n            $box.position({\n                my: 'center bottom-10',\n                at: 'center top',\n                of: target\n            });\n\n        }else if($box.hasClass('mc-bottom')){\n            $box.position({\n                my: 'center top+10',\n                at: 'center bottom',\n                of: target\n            });\n        }\n    },\n\n    initKeyboard: function (selector){\n        $(document.body).keyup(function (e){\n            if(e.keyCode == 27){\n                $(selector).each(function(){\n                   if($(this).is(':visible')) {\n                       $(this).find('.js-close').click();\n                   }\n                });\n            }\n        });\n    },\n\n    initBoxes: function(selector){\n\n        $(selector).each(function(){\n            var $dialog = $(this);\n\n            if($dialog.find('.js-dialog-disabled').length)\n                return;\n\n            if($dialog.data('dialog-init'))\n                return;\n\n            if($dialog.data('init'))\n                return;\n\n            $dialog.data('init', true);\n\n            /*$dialog.hide();  Moved to style.css */\n\n            $dialog.addClass('edit-box');\n\n            $dialog.data('dialog-init', 1);\n            if($dialog.attr('title')){\n                $dialog.prepend('<header><h1>' + $(this).attr('title') + '</h1></header>');\n            }\n            var submit_label = $dialog.data('submit-label') ? $dialog.data('submit-label') : 'Enviar';\n            var cancel_label = $dialog.data('cancel-label') ? $dialog.data('cancel-label') : 'Cancelar';\n\n            $dialog.append('<footer><button class=\"mc-cancel btn btn-default\">' + cancel_label + '</button> <button type=\"submit\" class=\"mc-submit\">' + submit_label + '</button> </footer><div class=\"mc-arrow\"></div>');\n\n            // close button\n            $dialog.find('.mc-cancel').click(function (){\n                MapasCulturais.EditBox.close($dialog);\n                return false;\n            });\n\n            // submit form\n            $dialog.find('footer button.mc-submit').click(function(){\n                $dialog.find('form').submit();\n            });\n        });\n    },\n\n    initButtons: function(selector){\n        $(selector).each(function(){\n            var $button = $(this);\n            var dialog_selector = $(this).data('target');\n            var $dialog = $(dialog_selector);\n            if($dialog.find('.js-dialog-disabled').length)\n                $(this).addClass('inactive').addClass('hltip').attr('title', $dialog.find('.js-dialog-disabled').data('message'));\n\n        });\n        $(selector).click(function(){\n            var $button = $(this);\n            if($button.hasClass('inactive'))\n                return false;\n\n            var dialog_selector = $button.data('target');\n\n            MapasCulturais.EditBox.open(dialog_selector, $button);\n\n            if($button.data('dialog-title'))\n                $(dialog_selector).find('header h1').html($button.data('dialog-title'));\n\n            if( $button.data('dialog-callback') )\n                eval( $button.data('dialog-callback'))($button);\n\n            return false;\n        });\n    },\n\n    close: function(selector){\n        $('body').css('overflow','auto');\n        var $dialog = $(selector);\n        //alert('closing');\n        $dialog.find('.editable').editable('hide');\n        $dialog.hide();\n        return;\n    },\n\n    open: function(selector, $button){\n        var $dialog = $(selector);\n        $dialog.find('div.alert.danger').html('').hide();\n\n        MapasCulturais.AjaxUploader.resetProgressBar(selector);\n\n        $dialog.show();\n        $dialog.find('input,textarea').not(':hidden').first().focus();\n        $dialog.css('opacity',0);\n        MapasCulturais.EditBox.setPosition($dialog, $button);\n        setTimeout(function(){\n            MapasCulturais.EditBox.setPosition($dialog, $button);\n            $dialog.css('opacity',1);\n        },25);\n\n        return;\n    }\n};\n\n\nMapasCulturais.Video = {\n    collection : {},\n    parseURL : function(url){\n        return purl(url);\n    },\n    isYoutube : function(parsedURL){\n            return parsedURL.attr('host').indexOf('youtube') != -1;\n    },\n    getYoutubeData : function(youtubeVideoID){\n        return {\n            thumbnalURL : 'http://img.youtube.com/vi/'+videoID+'/0.jpg',\n            playerURL : '//www.youtube.com/embed/'+videoID+'?html5=1'\n        }\n    },\n    getVideoBasicData : function(url){\n        var parsedURL = this.parseURL(url);\n        var host = parsedURL.attr('host');\n        var provider = '';\n        var videoID = '';\n        if(parsedURL.attr('host').indexOf('youtube') != -1 ){\n            provider = 'youtube';\n            videoID = parsedURL.param('v');\n        }else if(parsedURL.attr('host').indexOf('vimeo') != -1){\n            provider = 'vimeo';\n            videoID = parsedURL.attr('path').split('/')[1];\n        }\n        return {\n            'parsedURL' : parsedURL,\n            'provider' : provider,\n            'videoID' : videoID\n        }\n    },\n    setupVideoGallery : function(gallerySelector){\n\n        if($(gallerySelector).length == 0)\n            return false;\n\n        $( gallerySelector + ' .js-metalist-item-display').each(function(){\n            MapasCulturais.Video.getAndSetVideoData($(this).data('videolink'), $(this).parent(), MapasCulturais.Video.setupVideoGalleryItem);\n        });\n        var $firstItem = $( gallerySelector + ' .js-metalist-item-display:first').parent();\n        if(!$firstItem.length) {\n            $('#video-player').hide();\n            return false;\n        }\n        $('iframe#video_display').attr('src', $firstItem.data('player-url'));\n        $firstItem.addClass('active');\n    },\n    setupVideoGalleryItem : function(videoData, $element){\n        //$Element should be a.js-metalist-item-display\n        $element.attr('href', '#video');\n        $element.data('player-url', videoData.playerURL);\n        $element.find('img').attr('src', videoData.thumbnailURL);\n\n        var video_id = $element.attr('id');\n\n        $element.on('click', function(){\n            $('iframe#video_display').attr('src', videoData.playerURL);\n            $('iframe#video_display').data('open-video', $(this).attr('id'));\n            $(this).parent().find('.active').removeClass('active');\n            $(this).addClass('active');\n        });\n\n        var $container = $element.parent();\n        if($element.find('.js-remove-item').length){\n            $element.find('.js-remove-item').data('remove-callback', function(){\n                if($('iframe#video_display').data('open-video') == video_id)\n                    $('iframe#video_display').attr('src', '');\n\n                if($container.find('>li').length == 0)\n                    $('#video-player').hide();\n            });\n        }\n\n        if($container.find('>li').length == 1){\n            $element.addClass('active');\n            $('iframe#video_display').attr('src', videoData.playerURL);\n        }\n\n    },\n    setTitle : function(videoData, $element){\n        $element.val(videoData.videoTitle);\n    },\n    getAndSetVideoData : function (videoURL, $element, callback){\n        videoURL = videoURL.trim();\n        var videoData = {\n            parsedURL : purl(videoURL),\n            provider : '',\n            videoID : '',\n            thumbnailURL : '',\n            playerURL : '',\n            details : {}\n        };\n\n        if(videoData.parsedURL.attr('host').indexOf('youtube') != -1){\n            videoData.provider = 'youtube';\n            videoData.videoID = videoData.parsedURL.param('v');\n            videoData.thumbnailURL = 'http://img.youtube.com/vi/'+videoData.videoID+'/0.jpg';\n            videoData.playerURL = '//www.youtube.com/embed/'+videoData.videoID+'?html5=1';\n            callback(videoData, $element);\n            $.getJSON('https://gdata.youtube.com/feeds/api/videos/'+videoData.videoID+'?v=2&alt=json', function(data) {\n                videoData.details = data;\n                videoData.videoTitle = data.entry.title.$t;\n                MapasCulturais.Video.collection[videoURL] = videoData;\n                callback(videoData, $element);\n                return videoData;\n            });\n        }else if(videoData.parsedURL.attr('host').indexOf('vimeo') != -1){\n            videoData.provider = 'vimeo';\n            var tmpArray = videoData.parsedURL.attr('path').split('/');\n            videoData.videoID = tmpArray[tmpArray.length-1];\n            $.getJSON('http://www.vimeo.com/api/v2/video/'+videoData.videoID+'.json?callback=?', {format: \"json\"}, function(data) {\n                videoData.details = data[0];\n                videoData.thumbnailURL = data[0].thumbnail_small;\n                videoData.playerURL = '//player.vimeo.com/video/'+videoData.videoID+'';\n                videoData.videoTitle = data[0].title;\n                callback(videoData, $element);\n                MapasCulturais.Video.collection[videoURL] = videoData;\n                return videoData;\n            });\n        }else{\n            //no valid provider\n            videoData.thumbnailURL = 'http://www.bizreport.com/images/shutterstock/2013/04/onlinevideo_135877229-thumb-380xauto-2057.jpg';\n            callback(videoData, $element);\n            return videoData;\n        }\n\n        var withDetails = function(){\n            // get details from youtube api\n            if(!videoData.details) {\n                $.getJSON('https://gdata.youtube.com/feeds/api/videos/'+videoData.videoID+'?v=2&alt=json', {format: \"json\"}, function(data) {\n                    videoData.details = data;\n                    functionName(videoData, $element);\n                    return videoData;\n                });\n            }\n        };\n    }\n};\n\nMapasCulturais.Search = {\n    limit: 10,\n\n    init : function(selector){\n        if( $(selector).length === 0 || $(selector).hasClass('select2-offscreen')) return false;\n\n        $(selector).each(function(){\n            var $selector = $(this);\n\n            $selector.editable({\n                type:'select2',\n                name: $selector.data('field-name') ? $selector.data('field-name') : null,\n                select2:{\n//                    multiple: $selector.data('multiple'),\n//                    tokenSeparators: [\";\",\";\"],\n//                    separator:'; ',\n//                    viewseparator: '; ',\n                    width: $selector.data('search-box-width'),\n                    placeholder: $selector.data('search-box-placeholder'),\n                    minimumInputLength: 0,\n                    allowClear: $selector.data('allow-clear'),\n                    initSelection: function(e,cb){\n                        cb({id: $selector.data('value'), name: $selector.data('editable').$element.html()});\n                    },\n                    ajax: {\n                        url: function(){\n                            var format = $selector.data('selection-format');\n                            var apiMethod = 'find';\n                            if(MapasCulturais.Search.formats[format] && MapasCulturais.Search.formats[format].apiMethod)\n                                apiMethod =  MapasCulturais.Search.formats[format].apiMethod;\n                            return MapasCulturais.baseURL + 'api/' + $selector.data('entity-controller') + '/' + apiMethod;\n                        },\n                        dataType: 'json',\n                        quietMillis: 350,\n                        data: function (term, page) { // page is the one-based page number tracked by Select2\n                            var searchParams = MapasCulturais.Search.getEntityController(term, page, $selector);\n\n                            var format = $selector.data('selection-format');\n\n                            if(MapasCulturais.Search.formats[format] && MapasCulturais.Search.formats[format].ajaxData)\n                                searchParams = MapasCulturais.Search.formats[format].ajaxData(searchParams, $selector);\n                            else\n                                searchParams = MapasCulturais.Search.ajaxData(searchParams, $selector);\n\n                            return searchParams;\n                        },\n                        results: function (data, page) {\n                            var more = data.length == MapasCulturais.Search.limit;\n                            // notice we return the value of more so Select2 knows if more results can be loaded\n\n                            return {results: data, more: more};\n                        }\n                    },\n                    formatResult: function(entity){\n                        var format = $selector.data('selection-format');\n                        if(MapasCulturais.Search.formats[format] && MapasCulturais.Search.formats[format].result)\n                            return MapasCulturais.Search.formats[format].result(entity, $selector);\n                        else\n                            return MapasCulturais.Search.formatResult(entity, $selector);\n                    }, // omitted for brevity, see the source of this page\n\n                    formatSelection: function(entity){\n                        var format = $selector.data('selection-format');\n                        return MapasCulturais.Search.formats[format].selection(entity, $selector);\n                    }, // omitted for brevity, see the source of this page\n\n                    formatNoMatches: function(term){\n                        var format = $selector.data('selection-format');\n                        return MapasCulturais.Search.formats[format].noMatches(term, $selector);\n                    },\n                    escapeMarkup: function (m) { return m; }, // we do not want to escape markup since we are displaying html in results\n                }\n            });\n            if($selector.data('disable-buttons') ){\n                $selector.on('shown', function(e, editable) {\n                    var format = $selector.data('selection-format');\n\n                    /*Hide editable buttons because the option showbuttons:false autosubmitts the form adding two agents...\n                    Also Auto-open select2 on editable.shown and auto-close editable popup on select2-close*/\n\n                    e.stopPropagation();\n                    if (arguments.length == 2) {\n                        setTimeout(function() {\n                            editable.input.$input.parents('.control-group').addClass('editable-popup-botoes-escondidos');\n                        }, 0);\n                        setTimeout(function() {\n                            editable.input.$input.select2(\"open\");\n                        }, 200);\n                        editable.input.$input.on('select2-close', function(){\n                            setTimeout(function() {\n                                $selector.editable('hide');\n                            }, 200);\n                        });\n                    }\n                });\n            }\n            if($selector.data('auto-open') ){\n                $selector.on('shown', function(e, editable) {\n                    setTimeout(function() {\n                        editable.input.$input.select2(\"open\");\n                    }, 200);\n                });\n            }\n            var format = $selector.data('selection-format');\n            $selector.on('save',function(){\n                try{\n                    MapasCulturais.Search.formats[format].onSave($selector);\n                }catch(e){\n                    console.log(\"EXECEPTION: \", e.message);\n                }\n            });\n            $selector.on('hidden',function(){\n                try{\n                    MapasCulturais.Search.formats[format].onHidden($selector);\n                }catch(e){\n                    console.log(\"EXECEPTION: \", e.message);\n                }\n            });\n\n        });\n    },\n\n\n\n    getEntityController : function(term, page, $selector){\n\n        var entitiyControllers = {\n            'default':{\n                name: 'ilike(*'+term.replace(' ', '*')+'*)', //search term\n                '@select': 'id,name,terms,type',\n                '@limit': MapasCulturais.Search.limit, // page size\n                '@page': page,\n                '@order':'name ASC', // page number\n                '@files':'(avatar.avatarSmall):url'\n            },\n            'agent':{ //apenas adicionei a shortDescription\n                name: 'ilike(*'+term.replace(' ', '*')+'*)', //search term,\n                '@select': 'id,name,terms,type',\n                '@limit': MapasCulturais.Search.limit, // page size\n                '@page': page,\n                '@order':'name ASC', // page number\n                '@files':'(avatar.avatarSmall):url'\n            }\n        };\n\n        if(entitiyControllers[$selector.data('entity-controller')]){\n            return entitiyControllers[$selector.data('entity-controller')];\n        }else{\n            return entitiyControllers['default'];\n        }\n    },\n\n    processEntity: function(entity, $selector){\n        entity.areas = function(){\n            if(this.terms && this.terms.area)\n                return this.terms.area.join(', ');\n            else\n                return '';\n        };\n\n        entity.linguagens = function(){\n            if(this.terms && this.terms.linguagem)\n                return this.terms.linguagem.join(', ');\n            else\n                return '';\n        };\n\n        entity.tags = function(){\n            if(this.terms && this.terms.tags)\n                return this.terms.tags.join(', ');\n            else\n                return '';\n        };\n\n        entity.thumbnail = function(){\n            var entityDefaultAvatar = MapasCulturais.assets['avatar'+$selector.data('entity-controller')[0].toUpperCase() + $selector.data('entity-controller').slice(1)];\n            if(this['@files:avatar.avatarSmall'])\n                return this['@files:avatar.avatarSmall'].url;\n            else\n                return entityDefaultAvatar;\n        };\n\n    },\n\n    renderTemplate : function(template, entity, $selector){\n        this.processEntity(entity, $selector);\n        return Mustache.render(template, entity);\n    },\n\n    getEntityThumbnail : function (entity, thumbName){\n        if(!entity.files || entity.files.length == 0 || !entity.files[thumbName] || entity.files[thumbName].length == 0)\n            return '';\n        else{\n            if(entity.files[thumbName].files['avatarSmall'])\n                return entity.files[thumbName].files['avatarSmall'].url;\n        }\n    },\n\n    formatResult : function (entity, $selector) {\n        var searchResultTemplate = $($selector.data('search-result-template')).text();\n        return this.renderTemplate(searchResultTemplate, entity, $selector);\n    },\n\n    ajaxData: function(searchParams, $selector){\n        var excludedIds = MapasCulturais.request.controller === $selector.data('entity-controller') && MapasCulturais.entity.id ? [MapasCulturais.entity.id] : [];\n\n        if(excludedIds.length > 0)\n            searchParams.id = '!in(' + excludedIds.toString() + ')';\n\n        return searchParams;\n    },\n\n    formats: {\n        chooseProject:{\n            //apiMethod : 'findByUserApprovedRegistration',\n            onSave: function($selector){\n                var entity = $selector.data('entity');\n                $selector.data('value', entity.id);\n                $selector.data('value-name', entity.name);\n            },\n            selection: function(entity, $selector){\n                $selector.data('entity', entity);\n                return entity.name;\n            },\n\n            noMatches: function(term, $selector){\n                return 'Nenhum projeto encontrado.';\n            },\n\n            onClear: function($selector){\n            },\n\n            ajaxData: function(searchParams){\n                searchParams['@permissions'] = 'requestEventRelation';\n                return searchParams;\n            }\n        },\n\n        chooseSpace: {\n            onSave: function($selector){\n                var entity = $selector.data('entity'),\n                    avatarUrl = MapasCulturais.defaultAvatarURL,\n                    shortDescription = entity.shortDescription ? entity.shortDescription.replace(\"\\n\",'<br/>') : '';\n\n                $selector.data('value', entity.id);\n\n                try{\n                    avatarUrl = entity.files.avatar.files.avatarSmall.url;\n                }catch(e){};\n\n                $selector.parents('.js-space').find('.js-space-avatar').attr('src', avatarUrl);\n                $selector.parents('.js-space').find('.js-space-description').html(shortDescription);\n\n                $selector.parents('form').find('input[name=\"spaceId\"]').val(entity.id);\n            },\n            onHidden : function ($selector) {\n                $selector.removeClass('editable-unsaved');\n            },\n\n            selection: function(entity, $selector){\n                $selector.data('entity', entity);\n                return entity.name;\n            },\n\n            noMatches: function(term, $selector){\n                return 'Nenhum espa√ßo encontrado.';\n            },\n\n            onClear: function($selector){ },\n\n            ajaxData: function(searchParams, $selector){\n\n                if($selector.data('value')){\n                    searchParams.id = '!in('+$selector.data('value')+')';\n                }\n\n                //if(!MapasCulturais.cookies.get('mapasculturais.adm'))\n                //    searchParams.owner = 'in(@me.spaces)';\n\n                searchParams['@select'] += ',shortDescription';\n//                searchParams['@permissions'] += '@control';\n                return searchParams;\n            }\n        },\n\n        createAgentRelation: {\n            selection: function (entity, $selector) {\n                var $selectionTarget =   $($selector.data('selection-target'));\n                var targetAction =      $selector.data('target-action');\n                var selectionTemplate = $($selector.data('selection-template')).text();\n\n                var groupname = $selector.parents('.js-related-group').find('.js-related-group-name').text();\n\n                $.post(\n                    MapasCulturais.baseURL + MapasCulturais.request.controller + '/createAgentRelation/id:' + MapasCulturais.entity.id,\n                    {agentId: entity.id, group:groupname, has_control: '0'}\n                );\n\n\n                if(targetAction == 'append'){\n                    MapasCulturais.RelatedAgents.addAgentToGroup(groupname, entity);\n                    return $selector.data('search-box-placeholder');\n                }else{\n                    $selectionTarget.html(markup);\n                    return entity.name;\n                }\n            },\n\n            noMatches: function (term, $selector){\n                var noResultTemplate = $($selector.data('no-result-template')).text();\n                $('#dialog-adicionar-integrante').data('group-element', $selector.parents('.js-related-group').find('.js-relatedAgentsContainer'));\n                //return term + ' HAHAHA!';\n                return noResultTemplate.replace('{{group}}', $selector.parents('.js-related-group').find('.js-related-group-name').text());\n            },\n\n            ajaxData: function(searchParams, $selector){\n                var group = $selector.parents('.js-related-group').find('.js-related-group-name').text();\n\n                var excludedIds = MapasCulturais.request.controller === 'agent' && MapasCulturais.entity.id? [MapasCulturais.entity.id] : [];\n                try{\n                    if(MapasCulturais.agentRelationGroupExludeIds[group])\n                        excludedIds = excludedIds.concat(MapasCulturais.agentRelationGroupExludeIds[group]);\n                }catch(e){}\n\n                excludedIds = excludedIds.concat (\n                    $selector.parents('.js-related-group').find('.agentes .avatar').map(\n                        function(){ return $(this).data('id'); }\n                ).toArray());\n\n\n                if ( excludedIds.length > 0)\n                    searchParams.id = '!in('+excludedIds.toString()+')';\n\n                return searchParams;\n            }\n        },\n\n        parentSpace:{\n            selection: function(entity, $selector){\n                return entity.name;\n            },\n\n            noMatches: function(term, $selector){\n                return 'Nenhum espa√ßo encontrado.';\n            },\n\n            onClear: function($selector){\n            },\n\n            ajaxData: function(searchParams, $selector){\n                if(MapasCulturais.entity.id){\n                    var excludeIds = [MapasCulturais.entity.id].concat(MapasCulturais.entity.childrenIds);\n                    if(excludeIds){\n                        searchParams['id'] = '!IN(' + excludeIds + ')';\n                    }\n\n                }\n                return searchParams;\n            }\n        },\n\n        parentProject:{\n            selection: function(entity, $selector){\n                return entity.name;\n            },\n\n            noMatches: function(term, $selector){\n                return 'Nenhum projeto encontrado.';\n            },\n\n            onClear: function($selector){\n            },\n\n            ajaxData: function(searchParams, $selector){\n                if(MapasCulturais.entity.id){\n                    var excludeIds = [MapasCulturais.entity.id].concat(MapasCulturais.entity.childrenIds);\n                    if(excludeIds){\n                        searchParams['id'] = '!IN(' + excludeIds + ')';\n                    }\n\n                }\n\n                return searchParams;\n            }\n        },\n\n        projectRegistration: {\n            onSave: function($selector){\n                var entity = $selector.data('entity'),\n                    avatarUrl = MapasCulturais.defaultAvatarURL,\n                    shortDescription = entity.shortDescription.replace(\"\\n\",'<br/>');\n\n                $('#registration-agent-id').val(entity.id);\n\n            },\n\n            onHidden : function ($selector) {\n                $selector.removeClass('editable-unsaved');\n            },\n\n            selection: function(entity, $selector){\n                $selector.data('entity', entity);\n                return entity.name;\n            },\n\n            noMatches: function(term, $selector){\n                return 'Nenhum agente encontrado.';\n            },\n\n            onClear: function($selector){ },\n\n            ajaxData: function(searchParams, $selector){\n                var excludedIds = MapasCulturais.request.controller === 'agent' && MapasCulturais.entity.id? [MapasCulturais.entity.id] : [];\n\n                excludedIds.push($selector.data('value'));\n\n                if ( excludedIds.length > 0)\n                    searchParams.id = '!in('+excludedIds.toString()+')';\n\n                if(!MapasCulturais.cookies.get('mapasculturais.adm'))\n                    searchParams.user = 'eq(@me)';\n\n                if($selector.data('profiles-only'))\n                    searchParams.isUserProfile = 'eq(true)';\n\n                searchParams['@select'] += ',shortDescription,';\n                return searchParams;\n            }\n\n        },\n\n        changeOwner:{\n            onSave: function($selector){\n                var entity = $selector.data('entity'),\n                    avatarUrl = MapasCulturais.defaultAvatarURL,\n                    shortDescription = entity.shortDescription.replace(\"\\n\",'<br/>');\n\n                $selector.data('value', entity.id);\n\n                try{\n                    avatarUrl = entity.files.avatar.files.avatarSmall.url;\n                }catch(e){};\n\n                $selector.parents('.js-owner').find('.js-owner-avatar').attr('src', avatarUrl);\n                $selector.parents('.js-owner').find('.js-owner-description').html(shortDescription);\n\n            },\n\n            selection: function(entity, $selector){\n                $selector.data('entity', entity);\n                return entity.name;\n            },\n\n            noMatches: function(term, $selector){\n                return 'Nenhum agente encontrado.';\n            },\n\n            onClear: function($selector){ },\n\n            ajaxData: function(searchParams, $selector){\n                var excludedIds = [$selector.editable('getValue').ownerId];\n\n                if(MapasCulturais.request.controller === 'agent' && MapasCulturais.entity.id){\n                    excludedIds.push(MapasCulturais.entity.id);\n                    if(MapasCulturais.entity.childrenIds){\n                        excludedIds = excludedIds.concat(MapasCulturais.entity.childrenIds);\n                    }\n                }\n\n                if ( excludedIds.length > 0)\n                    searchParams.id = '!in('+excludedIds.toString()+')';\n\n                searchParams['@select'] += ',shortDescription';\n                searchParams['@permissions'] = '@control';\n                return searchParams;\n            }\n        }\n    }\n};\n\n\nMapasCulturais.cookies = {\n    get: function(name) {\n        var nameEQ = name + \"=\";\n        var ca = document.cookie.split(';');\n        for(var i=0;i < ca.length;i++) {\n            var c = ca[i];\n            while (c.charAt(0)==' ') c = c.substring(1,c.length);\n            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);\n        }\n        return null;\n    },\n\n    set: function(key, value, options){\n        options = $.extend({}, options);\n\n        if (value == null) {\n            options.expires = -1;\n        }\n\n        if (typeof options.expires === 'number') {\n            var days = options.expires, t = options.expires = new Date();\n            t.setDate(t.getDate() + days);\n            options.expires = options.expires.toUTCString();\n        }else{\n            options.expires = 'Session';\n        }\n\n        value = String(value);\n\n        return (document.cookie = [\n            encodeURIComponent(key), '=', options.raw ? value : encodeURIComponent(value),\n            options.expires ? '; expires=' + options.expires : '', // use expires attribute, max-age is not supported by IE\n            options.path    ? '; path=' + options.path : '',\n            options.domain  ? '; domain=' + options.domain : '',\n            options.secure  ? '; secure' : ''\n            ].join(''));\n    }\n};\n","//Inicia o mapa para a busca e configura o timeout do scroll\njQuery(document).ready(function() {\n\n    if ($('body').hasClass('action-search')) {\n        MapasCulturais.Map.initialize({mapSelector: '.js-map', locateMeControl: false, exportToGlobalScope: true, mapCenter: MapasCulturais.mapCenter});\n    }\n\n});\n\n\n(function(angular) {\n    var app = angular.module('ng-mapasculturais', []);\n    app.config([\"$httpProvider\", function($httpProvider) {\n\n            $httpProvider.responseInterceptors.push(['$q', '$rootScope', function($q, $rootScope) {\n\n                return function(promise) {\n                    $rootScope.$broadcast(\"event:startProgress\");\n                    return promise\n                        .then(\n                            function(response) {\n                                $rootScope.$broadcast(\"event:endProgress\");\n                                return response;\n                            },\n                            function(response) { //on error\n                                $rootScope.$broadcast(\"event:endProgress\");\n                                return $q.reject(response);\n                            }\n                        );\n\n                };\n            }]);\n        }]);\n})(angular);\n\n","(function(angular){\n    \"use strict\";\n\n    var module = angular.module('mc.module.notifications', []);\n\n    module.factory('NotificationService', ['$log','$http', '$q', '$rootScope', function($log, $http, $q, $rootScope){\n\n        var service = {};\n\n        service.url = MapasCulturais.baseURL + 'notification/';\n\n        service.get = function (){\n            var deferred = $q.defer();\n            $http.get(\n                MapasCulturais.baseURL+'api/notification/find/?&@select=id,status,isRequest,createTimestamp,message,approveUrl,request.permissionTo.approve,request.permissionTo.reject,request.requesterUser.id&user=eq(@me)&@ORDER=createTimestamp%20DESC'\n            ).success(function(data){\n                deferred.resolve(data);\n            }).error(function(){\n                deferred.reject('There was an error');\n            });\n            return deferred.promise;\n        };\n        service.updateOne = function(id, action){\n            var deferred = $q.defer();\n            $http.get(\n                service.url+action+'/'+id)\n            .success(function(data){\n                deferred.resolve(data);\n            }).error(function(){\n                deferred.reject('There was an error');\n            });\n            return deferred.promise;\n        };\n        return service;\n    }]);\n\n    module.controller('NotificationController', ['$log', '$sce', '$scope', '$rootScope', '$interval', 'NotificationService', function($log, $sce, $scope, $rootScope, $interval, NotificationService){\n\n        $scope.panelURI = MapasCulturais.baseURL+'panel';\n        $scope.MapasCulturais = MapasCulturais;\n\n        MapasCulturais.notifications.forEach(function(value,index){\n            MapasCulturais.notifications[index].message = $sce.trustAsHtml(value.message);\n        });\n        $scope.data = MapasCulturais.notifications;\n\n        var getNotifications = function (){\n            NotificationService.get().then(function(data){\n                if(data){\n                    data.forEach(function(value,index){\n                        data[index].message = $sce.trustAsHtml(value.message);\n                    });\n                    $scope.data = data;\n                }\n            });\n        };\n\n        $interval(function(){\n            getNotifications();\n        }, 60*1000);\n\n        $scope.approve = function(id){\n            NotificationService.updateOne(id,'approve').then(getNotifications);\n        };\n        $scope.reject = function(id){\n            NotificationService.updateOne(id,'reject').then(getNotifications);\n        };\n        $scope.delete = function(id){\n            NotificationService.updateOne(id,'delete').then(getNotifications);\n        };\n\n        $scope.adjustScroll = function(){\n            jQuery('.notifications .submenu ul').slimScroll({\n                position: 'right',\n                distance: '0px',\n                color: '#000',\n                height: '316px',\n                alwaysVisible: true,\n                railVisible: true\n            });\n        };\n    }]);\n\n    module.directive('onLastRepeat', function() {\n        return function(scope, element, attrs) {\n            if (scope.$last) { // all are rendered\n                scope.$evalAsync(attrs.onLastRepeat);\n            }\n        };\n    });\n\n    angular.element(document).ready(function(){\n        var app = null;\n        //checks existence of default search and Entity (singles') angular modules\n        ['search.app', 'entity.app'].forEach(function(moduleName){\n            if(!app){\n                try{\n                    app = angular.module(moduleName);\n                }catch(e){}\n            }\n        });\n        //can't find expected app\n        if(!app) {\n            var ctrl = document.querySelector('[ng-controller=NotificationController]');\n\n            // let's search again\n            if(ctrl && !angular.element(ctrl.parentElement).scope()) {\n                angular.bootstrap(ctrl.parentElement, ['mc.module.notifications']);\n            }\n        }\n        app = angular.module('mc.module.notifications');\n    });\n\n})(angular);\n\n\n"]}