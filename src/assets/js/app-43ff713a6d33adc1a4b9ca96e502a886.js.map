{"version":3,"sources":["application/themes/BaseV1/assets/js/tim.js","application/themes/BaseV1/assets/js/mapasculturais.js","application/themes/BaseV1/assets/js/ng-mapasculturais.js","application/themes/BaseV1/assets/js/ng.mc.module.notifications.js","application/themes/BaseV1/assets/js/editable.js","application/themes/BaseV1/assets/js/events.js","application/themes/BaseV1/assets/js/ng.mc.directive.multiselect.js","application/themes/BaseV1/assets/js/ng.mc.directive.singleselect.js","application/themes/BaseV1/assets/js/ng.mc.directive.editBox.js","application/themes/BaseV1/assets/js/ng.mc.directive.mcSelect.js","application/themes/BaseV1/assets/js/ng.mc.module.findEntity.js","application/themes/BaseV1/assets/js/ng.entity.module.relatedAgents.js","application/themes/BaseV1/assets/js/ng.entity.module.changeOwner.js","application/themes/BaseV1/assets/js/ng.entity.directive.editableMultiselect.js","application/themes/BaseV1/assets/js/ng.entity.directive.editableSingleselect.js","application/themes/BaseV1/assets/js/ng.entity.app.js","application/themes/BaseV1/assets/js/ng.entity.module.project.js","application/themes/BaseV1/assets/js/map.js"],"names":["$","document","unbind","MapasCulturais","mode","i","s","o","g","r","a","m","q","push","arguments","l","Date","createElement","getElementsByTagName","async","src","parentNode","insertBefore","window","ga","ready","deviceAgent","navigator","userAgent","toLowerCase","isTouchDevice","documentElement","match","addClass","remove","lastScrollTop","$mainHeader","headerHeight","outerHeight","header_animation_status","length","is","css","body","hasClass","magnificPopup","delegate","type","closeMarkup","gallery","enabled","arrowMarkup","tPrev","tNext","tCounter","adjustHeader","$mapa","$editableEntity","$busca","buscaTop","headerDosResultadosHeight","scrollTop","this","diffScrollTop","newHeaderTop","parseInt","parent","append","find","appendTo","data","height","leaflet","map","invalidateSize","removeClass","position","top","stop","fadeIn","fadeOut","scroll","resize","each","$active","$content","$links","filter","location","hash","attr","not","hide","replace","on","e","show","preventDefault","toString","click","slimScroll","distance","color","alwaysVisible","railVisible","maxHeight","parents","$input","setTimeout","select","focus","event","stopPropagation","target","url_template","params","entity","keyword","val","search_url","Mustache","render","keyCode","blur","prev","next","display","opacity","kc","tabindex","$items","find_next_page_menu_item","$next_page_item","offset","find_prev_page_menu_item","show_hide_scrolls","skip_animation","speed","animate","scroll_timeout","clearTimeout","__this","scrollto","Math","ceil","nav_mouseenter","apply","$target","skip_show","$page_item","html","mouseenter","mouseleave","width","hover","siblings","marginLeft","$slider","hl","tip","init","$this","_left","left","outerWidth","scrollLeft","_top","_height","content","indexOf","substr","zIndex","diff","jQuery","TemplateManager","Modal","initKeyboard","initDialogs","initButtons","EditBox","initBoxes","Video","setupVideoGallery","Search","slideUp","request","controller","App","$els","useRegistrations","reason","editable","$self","eval","one","fadeToggle","$dropdown","$submenu","roleToRemove","roleToAdd","label","change","post","baseURL","id","role","error","spinnerURL","assetURL","appName","ua","isNaN","version","split","getTypeName","utils","getObjectProperties","obj","keys","key","sortOjectProperties","newObj","sort","forEach","isObjectEquals","obj1","obj2","JSON","stringify","inArray","array","arraySearch","createUrl","controller_id","action_name","args","shortcuts","routes","actions","controllers","u","route","default_action_name","auth","cb","require","finish","templates","$templates","text","getTemplate","selector","trigger","defaultAvatarURL","assets","avatarAgent","editableEntityAddHash","href","cleanHref","Messages","delayToFadeOut","fadeOutSpeed","showMessage","message","$container","$message","$mainSection","slideDown","marginTop","delay","success","help","alert","confirm","time","keyup","$dialog","prepend","close","dialog_selector","open","setPosition","$box","my","at","of","submit_label","cancel_label","submit","$button","AjaxUploader","resetProgressBar","first","collection","parseURL","url","purl","isYoutube","parsedURL","getYoutubeData","youtubeVideoID","thumbnalURL","videoID","playerURL","getVideoBasicData","host","provider","param","gallerySelector","getAndSetVideoData","setupVideoGalleryItem","$firstItem","videoData","$element","thumbnailURL","video_id","setTitle","videoTitle","videoURL","callback","trim","details","getJSON","entry","title","$t","tmpArray","format","thumbnail_small","withDetails","functionName","limit","$selector","name","select2","placeholder","minimumInputLength","allowClear","initSelection","ajax","apiMethod","formats","dataType","quietMillis","term","page","searchParams","getEntityController","ajaxData","results","more","formatResult","result","formatSelection","selection","formatNoMatches","noMatches","escapeMarkup","input","onSave","console","log","onHidden","entitiyControllers","default","@select","@limit","@page","@order","@files","agent","processEntity","areas","terms","area","join","linguagens","linguagem","tags","thumbnail","entityDefaultAvatar","toUpperCase","slice","renderTemplate","template","getEntityThumbnail","thumbName","files","searchResultTemplate","excludedIds","chooseProject","onClear","chooseSpace","avatarUrl","shortDescription","avatar","avatarSmall","createAgentRelation","$selectionTarget","targetAction","selectionTemplate","groupname","agentId","group","has_control","RelatedAgents","addAgentToGroup","markup","noResultTemplate","agentRelationGroupExludeIds","concat","toArray","parentSpace","excludeIds","childrenIds","parentProject","projectRegistration","cookies","get","user","isUserProfile","changeOwner","ownerId","nameEQ","ca","cookie","c","charAt","substring","set","value","options","extend","expires","days","t","setDate","getDate","toUTCString","String","encodeURIComponent","raw","path","domain","secure","Map","initialize","mapSelector","locateMeControl","exportToGlobalScope","mapCenter","angular","app","module","config","$httpProvider","responseInterceptors","$q","$rootScope","promise","$broadcast","then","response","reject","factory","$log","$http","service","deferred","defer","resolve","updateOne","action","$sce","$scope","$interval","NotificationService","panelURI","notifications","index","trustAsHtml","getNotifications","approve","delete","adjustScroll","directive","scope","element","attrs","$last","$evalAsync","onLastRepeat","moduleName","ctrl","querySelector","parentElement","bootstrap","tabIndex","tabEnabled","fn","editableform","buttons","defaults","separator","editabletypes","viewseparator","Editables","MetalistManager","Remove","masks","mask","onKeyPress","field","possibleSize","max","container","$form","which","ctrlKey","$el","shiftKey","prevAll","nextAll","dataSelector","baseTarget","editableEntitySelector","createAll","isEditable","setButton","initTaxonomies","initTypes","initRegistrationCategories","initSpacePublicEditable","taxonomy","select2_option","tokenSeparators","taxonomyTerms","createSearchChoice","poshytip","showAniDuration","hideAniDuration","source","registrationCategories","entityTypes","getEditableElements","definition","field_name","input_type","emptytext","select_value","k","viewformat","datepicker","weekStart","yearRange","clear","$e","v","that","$datepicker","$timepicker","$hidden","insertAfter","newValue","moment","onComplete","$submitButton","status","$editables","add","ajaxOptions","statusCode",202,"statusText","createdRequests","parse","getResponseHeader","typeName","$field","errors","unknow_errors","field_found","firstShown","p","errorHtml","containerSelector","acivate","bar","percent","percentVal","animationTime","ajaxForm","beforeSend","xhr","beforeSubmit","arr","uploadProgress","total","percentComplete","error_message","replaceWith","description","reset","$linkField","$errorTag","pattern","test","$editBtn","$html","updateDialog","$caller","item","responseTemplate","concatena_enderco","nome_logradouro","cep","numero","complemento","bairro","municipio","estado","endereco","logradouro","localidade","uf","EventOccurrenceManager","initMapTogglers","eventOccurrenceUpdateDialog","formAction","editUrl","rule","frequency","monthly","EventHumanReadableManager","EventDates","$startsAt","$duration","$endsAt","mtime","duration","isValid","isNumeric","mendtime","abs","localeDateOptions","locale","dateOptions","day","month","year","formatDate","toLocaleDateString","pending","isEditing","screen_startsOn","startsOn","screen_until","until","screen_frequency","frequencies","$renderedData","space","textStatus","errorThrown","$map","closest","reenableScrollWheelZoom","scrollWheelZoom","disable","fieldSelector","altFieldSelector","dateFormat","altFormat","altField","updateSuggestion","date_s","hour","human","getSuggestion","date_e","weekDays","mdate_s","mdate_e","count","wformat","restrict","templateUrl","multiselect","allowOther","allowOtherText","values","link","attribute","cfg","outros","sanitize","setOutros","virgula","_outros","has","checked","toggleTerm","isArray","idx","splice","update","singleselect","clickOther","showOther","notOther","$watch","b","editBox","openEditboxes","register","editboxId","getElementById","Error","$submitInput","$event","$firstInput","transclude","spinnerCondition","onOpen","onSubmit","onCancel","el","editbox","cancelLabel","spinnerUrl","classes","mc-bottom","mc-top","mc-left","mc-right","isFunction","cancel","closeOnCancel","MCSelect","model","setter","getter","selectItem","getSelectedValue","getSelectedItem","selectedValue","getSelectedLabel","isSelected","baseUrl","canceller","query","success_cb","error_cb","cancelRequest","method","timeout","cache","findOne","pagination","resultsPerPage","executing","call","nextPage","currentPage","_page","previousPage","$timeout","FindService","timeouts","findEntity","noResultsText","onRepeatDone","apiQuery","searchText","noEntityFound","noMoreResults","containerInnerHeight","scrollHeight","containerScroll","containerHeight","bottomY","paginating","bind","e0","originalEvent","delta","wheelDelta","detail","isObject","lastS","processResult","headers","transformRequest","controllerId","entityId","getUrl","create","$emit","giveControl","setControl","removeControl","hasControl","RelatedAgentsService","groups","agentRelations","relations","showCreateDialog","spinners","canChangeControl","canUserCreateRelatedAgentsWithControl","agentRelationDisabledCD","disabledCD","groupName","getGroup","groupExists","closeNewGroupEditBox","newGroupName","getCreateAgentRelationEditBoxId","createGroup","newGroup","createRelation","_scope","$parent","deleteRelation","relation","oldRelations","toggleControl","filterResult","ids","setOwnerTo","ChangeOwnerService","adjustingBoxPosition","spinner","userHasControl","adjustBoxPosition","$on","ov","nv","requestEntity","singleUrl","editableMultiselect","entityProperty","emptyLabel","boxTitle","helpText","def","object","originalValue","resetValues","inputVal","optionsOrder","editBoxId","openEditBox","valuesText","editableSingleselect","resetValue","displayValue","inputValue","angularAppDependencies","teste","common","UrlService","publish","unpublish","registrationId","projectId","owner","category","setStatusTo","registration","registrationStatus","send","edit","RegistrationFileConfigurationService","maxUploadSize","maxUploadSizeFormatted","uploadFileGroup","getUploadUrl","fileConfigurationSkeleton","required","fileConfigurations","registrationFileConfigurations","newFileConfiguration","copy","sortFiles","fileConfigurationBackups","createFileConfiguration","removeFileConfiguration","$index","editFileConfiguration","sendFile","cancelFileConfigurationEditBox","openFileConfigurationEditBox","openFileConfigurationTemplateEditBox","initAjaxUploader","removeFileConfigurationTemplate","deleteUrl","abort","evt","$apply","ProjectEventsService","events","numSelectedEvents","num","selected","selectAll","hidden","deselectAll","eventFilterTimeout","filterEvents","keywords","eventFilter","classificacaoEtaria","occurrences","processing","publishSelectedEvents","processingText","unpublishSelectedEvents","toggle","registrationsUrl","uploadUrl","file","registrationFiles","openFileEditBox","removeFile","RegistrationService","categories","uploadSpinner","registrationCategoriesToFilter","registrationStatuses","registrationStatusesNames","publishedRegistrationStatuses","publishedRegistrationStatusesNames","publishedRegistrationStatus","propLabels","relationApiQuery","labels","registrationAgents","agentRelationGroupName","@permissions","fns","hideStatusInfo","getStatusSlug","getStatusNameById","statuses","setRegistrationStatus","registrations","getRegistrationStatus","getReadableLocation","isString","latitude","longitude","showRegistration","registrationCategory","getFilteredRegistrations","usingFilters","replaceRegistrationAgentBy","relationStatus","setRegistrationOwner","setRegistrationAgent","unsetRegistrationAgent","rs","sendRegistrationRulesFile","openRulesUploadEditbox","removeRegistrationRulesFile","registrationRulesFile","sendRegistration","focused","Object","Array","prop","offsetTop","L","Icon","Default","imagePath","initializerOptions","mapsDefaults","defaultIconOptions","shadowUrl","pinShadow","iconSize","shadowSize","iconAnchor","shadowAnchor","popupAnchor","iconTypeMapping","pinAgent","coletivo","pinSpace","pinEvent","pinMarker","iconOptions","iconType","opts","iconUrl","icon","isMapEditable","cursor","$dataTarget","isPositionDefined","defaultZoom","zoomPrecise","zoomDefault","defaultLocateMaxZoom","defaultAproximatePrecisionZoom","zoomApproximate","defaultMaxCircleRadius","LatLng","dragging","zoomControl","doubleClickZoom","center","lat","lng","zoom","minZoom","zoomMin","openStreetMap","tileLayer","attribution","maxZoom","zoomMax","addLayer","enable","marker","getCenter","draggable","markerIcon","setIcon","setLatLng","addTo","latlng","radius","accuracy","locate","setView","Polygon","prototype","pts","_latlngs","off","twicearea","x","y","nPts","p1","p2","f","j","geocoder","google","maps","Geocoder","geocode_callback","GeocoderStatus","OK","geometry","foundLocation","latLng","strAddress","geocode","address","Control","onAdd","controlDiv","DomUtil","DomEvent","addListener","controlUI","innerHTML","addControl","camadasBase","includeGoogleLayers","googleSatelite","Google","googleMapa","_type","googleHibrido","googleRelevo","camadasGoogle","Google Satélite","Google Mapa","Google Satélite Puro","Google Relevo","geoDivisions","lvector","PRWSF","vectorLayersURL","geotable","fields","geomFieldName","mapGeometryFieldQuery","uniqueField","srid","showAll","mouseoverEvent","feature","labelText","properties","vector","bindLabel","showLabel","singlePopup","symbology","vectorOptions","className","FullScreen","Zoom","geoDivisionsObj","div_id","geoDivisionsHierarchy","div_label","onRemove","layersControl","Layers","setGeoChecboxes","$checkbox","setMap","where","geoDivisionType","_makeJsonpRequest","_processFeatures","$control","publicLocation","empty","undefined","fullScreenApi","requestFullScreen","prefix","requestFullscreen","Element","ALLOW_KEYBOARD_INPUT"],"mappings":"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","file":"/vagrant/src/assets/js/app-43ff713a6d33adc1a4b9ca96e502a886.js","sourcesContent":["(function($) {\n    // to prevent jQuery bug\n    $(document).unbind('DOMNodeInserted.mask');\n\n    // Analytics\n    if(MapasCulturais.mode !== 'development'){\n        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');\n\n        ga('create', 'UA-53455459-1', 'auto');\n        ga('send', 'pageview');\n    }\n\n\n    $(document).ready(function() {\n\n        var deviceAgent = navigator.userAgent.toLowerCase();\n\n        var isTouchDevice = 'ontouchstart' in document.documentElement ||\n        (deviceAgent.match(/(iphone|ipod|ipad)/) ||\n        deviceAgent.match(/(android)/)  ||\n        deviceAgent.match(/(iemobile)/) ||\n        deviceAgent.match(/iphone/i) ||\n        deviceAgent.match(/ipad/i) ||\n        deviceAgent.match(/ipod/i) ||\n        deviceAgent.match(/blackberry/i) ||\n        deviceAgent.match(/bada/i));\n\n        window.isTouchDevice = isTouchDevice;\n        $('body').addClass('touch-device');\n\n        if(MapasCulturais.mode !== 'development')\n            $('.staging-hidden').remove();\n\n        // posição do header\n        var lastScrollTop = 0;\n\n        var $mainHeader = $('#main-header');\n        var headerHeight = $mainHeader.outerHeight(true);\n\n        var header_animation_status = 0;\n\n        if ($('#editable-entity').length && $('#editable-entity').is(':visible')) {\n            $('#main-section').css('margin-top', headerHeight + $('#editable-entity').outerHeight(true));\n        }\n\n        // inicializa a galeria\n        if ($(document.body).hasClass('action-single') && $(document.body).hasClass('entity')) {\n            $('.js-gallery').magnificPopup({\n                delegate: 'a', // child items selector, by clicking on it popup will open\n                type: 'image',\n                closeMarkup: '<span class=\"mfp-close icon icon-close\"></span>',\n                gallery:{\n                    enabled:true,\n\n                    arrowMarkup: '<button title=\"%title%\" type=\"button\" class=\"mfp-arrow mfp-arrow-%dir%\"><span class=\"icon icon-arrow-%dir% mfp-prevent-close\"></span></button>', // markup of an arrow button\n                    tPrev: 'Anterior', // title for left button\n                    tNext: 'Próxima', // title for right button\n                    tCounter: '%curr% de %total%' // markup of counter\n                }\n            });\n        }\n\n\n        // ajusta o tamanho do mapa internamente no leaflet\n\n        function adjustHeader() {\n            // @TODO: pra otimizar a performance só calcular e executar a animação se esta ainda não terminou para o sentido do scroll,\n            // exemplo: se está scrollando pra baixo e o header já está oculto não precisa calcular e mover ele\n            var $mapa, $editableEntity, $busca, $mapa, buscaTop, headerDosResultadosHeight,\n                    scrollTop = $(this).scrollTop(),\n                    diffScrollTop = (lastScrollTop - scrollTop),\n                    newHeaderTop = parseInt($mainHeader.css('top')) + diffScrollTop;\n\n            if ($('#header-search-row').length) {\n                $busca = $('#header-search-row');\n                $mapa = $('#search-map-container');\n                if (!$busca.parent().is($mainHeader)) {\n                    $mainHeader.append($('<div id=\"header-nav-row\" class=\"clearfix\">').append($mainHeader.find('>*')));\n                    $busca.appendTo($mainHeader);\n                }\n\n                headerDosResultadosHeight = $(\"#search-results-header\").outerHeight(true);\n\n                headerHeight = $mainHeader.outerHeight() - headerDosResultadosHeight;\n\n                buscaTop = $mainHeader.outerHeight(true);\n\n                if (buscaTop < 0)\n                    buscaTop = 0;\n//                $busca.css({position: 'fixed', top: buscaTop, zIndex: 123});\n\n\n                $('#lista').css('margin-top', headerHeight + headerDosResultadosHeight);\n\n                if ($mapa.is(':visible')) {\n                    $busca.addClass('sombra');\n\n                    $mapa.css('top', newHeaderTop + headerHeight + headerDosResultadosHeight);\n\n                    if ($mapa.data('oldHeight') != $mapa.height() && window.leaflet)\n                        window.leaflet.map.invalidateSize();\n\n                    if ($('#infobox'))\n                        $('#infobox').height($('#search-map-container').height() - 44)\n\n                    $mapa.data('oldHeight', $mapa.height());\n                } else if (scrollTop == 0 && !$mapa.is(':visible'))\n                    $busca.removeClass('sombra');\n                else\n                    $busca.addClass('sombra');\n\n\n                $('body').css('min-height', $(window).height() + headerHeight - headerDosResultadosHeight - 30);\n\n            }\n\n            if (newHeaderTop <= -headerHeight) {\n                newHeaderTop = -headerHeight;\n\n            } else if (newHeaderTop >= 0) {\n                newHeaderTop = 0;\n\n            } else if (newHeaderTop < -$(window).scrollTop()) {\n                newHeaderTop = -$(window).scrollTop();\n            }\n            if (parseInt($mainHeader.css('top')) <= -headerHeight + 3)\n                $mainHeader.removeClass('sombra');\n            else\n                $mainHeader.addClass('sombra');\n\n            $mainHeader.css('top', newHeaderTop);\n\n\n\n            if ($('#editable-entity:visible').length) {\n                $editableEntity = $('#editable-entity');\n\n                $editableEntity.css('top', newHeaderTop + headerHeight);\n\n                //Sugestão de colocar o logo e outras coisas na edit bar:\n                // if scrolltop > x\n                if ($editableEntity.position().top == 0) {\n                    $mainHeader.removeClass('sombra');\n                    $editableEntity.addClass('sombra');\n                    $('#small-brand').stop().fadeIn(100);\n                } else {\n                    $editableEntity.removeClass('sombra');\n                    $('#small-brand').stop().fadeOut(100);\n                }\n\n            }\n\n            lastScrollTop = scrollTop;\n        }\n\n        // animações do scroll\n        $(window).scroll(adjustHeader).resize(adjustHeader);\n        adjustHeader();\n        window.adjustHeader = adjustHeader;\n\n        $('ul.abas').each(function() {\n            // For each set of tabs, we want to keep track of\n            // which tab is active and it's associated content\n            var $active, $content, $links = $(this).find('a');\n\n            // If the location.hash matches one of the links, use that as the active tab.\n            // If no match is found, use the first link as the initial active tab.\n            $active = $($links.filter('[href=\"' + location.hash + '\"]')[0] || $links[0]);\n            $active.parent().addClass('active');\n            $content = $($active.attr('href'));\n\n            // Hide the remaining content\n            $links.not($active).each(function() {\n                $($(this).attr('href')).hide();\n            });\n\n            $links.each(function() {\n                $(this).attr('id', 'tab-' + $(this).attr('href').replace('#', ''));\n            });\n\n\n            // Bind the click event handler\n            $(this).on('click', 'a', function(e) {\n                // Make the old tab inactive.\n                $active.parent().removeClass('active');\n                $content.hide();\n\n                // Update the variables with the new link and content\n                $active = $(this);\n                $content = $($(this).attr('href'));\n\n                // Make the tab active.\n                $active.parent().addClass('active');\n                $content.show();\n\n                // Prevent the anchor's default click action\n                e.preventDefault();\n\n                location.hash = $(this).attr('id').replace('tab-', 'tab=');\n            });\n\n            $links.each(function() {\n                if (location.hash.toString().replace('#', '') === $(this).attr('id').replace('tab-', 'tab=')) {\n                    $(this).click();\n                }\n            });\n        });\n\n\n\n        $('.tag-box div').slimScroll({\n            position: 'right',\n            distance: '0px',\n            color: '#000',\n            height: '148px',\n            alwaysVisible: true,\n            railVisible: true\n        });\n        $('.submenu-dropdown .filter-list').slimScroll({\n            position: 'right',\n            distance: '3px',\n            color: '#000',\n            height: '222px',\n            alwaysVisible: true,\n            railVisible: true\n        });\n        $('.js-slimScroll').each(function() {\n\n            $(this).slimScroll({\n                position: 'right',\n                distance: '0px',\n                color: '#000',\n                height: '192px'\n            });\n\n            $(this).css({height: 'initial', maxHeight: 192}).parents('.slimScrollDiv').css({height: 'initial', maxHeight: 216});\n        });\n\n        $('#share-tools a.icon-share').click(function() {\n            if ($('form#share-url').is(':hidden')) {\n                $('form#share-url').show();\n                var $input = $('form#share-url input');\n                $input.on('focus click', function() {\n                    window.setTimeout(function() {\n                        $input.select();\n                    }, 0);\n                }).focus();\n                //$input.focus();\n                event.stopPropagation();\n            } else {\n                $('form#share-url').hide();\n            }\n        });\n        $('html').on('click', function(event) {\n            if (!$(event.target).parents('#share-tools').length) {\n                $('form#share-url').hide();\n            }\n        });\n\n        //Botão de busca da home\n        if($('#home-search-form').length){\n            $('#campo-de-busca').focus();\n            $('#home-search-filter .submenu-dropdown li').click(function() {\n                var url_template = $(this).data('searh-url-template') ?\n                        $(this).data('searh-url-template') : $(\"#home-search-filter\").data('searh-url-template');\n\n                var params = {\n                    entity: $(this).data('entity'),\n                    keyword: $('#campo-de-busca').val()\n                };\n                var search_url = Mustache.render(url_template, params);\n                document.location = search_url;\n            }).on('keydown', function(event){\n\n                if(event.keyCode === 13 || event.keyCode === 32){\n                    event.preventDefault();\n                    $(this).click();\n                }else if(event.keyCode === 27){\n                    $(this).attr('css', '');\n                    $(this).blur();\n                    $('#campo-de-busca').focus();\n                    return false;\n                }else if(event.keyCode === 38){\n                    // up\n                    if($('#home-search-filter .submenu-dropdown li:focus').is($('#home-search-filter .submenu-dropdown li:first'))){\n                       $('#home-search-filter .submenu-dropdown li:last').focus();\n                    }else{\n                        $('#home-search-filter .submenu-dropdown li:focus').prev().focus();\n                    }\n                    event.preventDefault();\n\n                }else if(event.keyCode === 40){\n                    // down\n                    if($('#home-search-filter .submenu-dropdown li:focus').is($('#home-search-filter .submenu-dropdown li:last'))){\n                       $('#home-search-filter .submenu-dropdown li:first').focus();\n                    }else{\n                        $('#home-search-filter .submenu-dropdown li:focus').next().focus();\n                    }\n                    event.preventDefault();\n                }\n\n            });\n\n            $('#home-search-form').on('submit', function(){\n                $('.submenu-dropdown').css({display:'block',opacity:1});\n                $('.submenu-dropdown li:first').focus();\n                return false;\n            });\n            $('#home-search-form #campo-de-busca').on('blur', function(){\n                $('.submenu-dropdown').attr('style','');\n            });\n            $('#home-search-form #campo-de-busca').on('keydown', function(event){\n                var kc = event.keyCode;\n                if(event.keyCode === 9){\n                    $('.submenu-dropdown').css({display:'block',opacity:1});\n                }\n            });\n            var tabindex = 1;\n            $('.submenu-dropdown li').each(function(){\n                tabindex++;\n                $(this).attr('tabindex', tabindex);\n                $(this).on('focus', function(){\n                    $('.submenu-dropdown').css({display:'block',opacity:1});\n                });\n                $(this).on('blur', function(){\n                    $('.submenu-dropdown').attr('style','');\n                });\n            });\n        }\n        //Scroll da Home ////////////////////////////////////////////////////\n\n        $('#home-intro div.view-more a').click(function() {\n            $('nav#home-nav a.down').click();\n            return false;\n        });\n\n        if ($('.js-page-menu-item').length) {\n            var $items = $('.js-page-menu-item');\n\n            // encontra o próximo item para o scroll para baixo\n            var find_next_page_menu_item = function() {\n                var $next_page_item = null;\n\n                $items.each(function() {\n                    if ($(this).offset().top - $(window).scrollTop() > $('#main-header').outerHeight(true) + 50) {\n                        $next_page_item = $(this);\n                        return false;\n                    }\n                });\n\n                return $next_page_item;\n            };\n\n            // encontra o próximo item para o scroll para cima\n            var find_prev_page_menu_item = function() {\n                var $next_page_item = null;\n\n                $items.each(function() {\n                    if ($(this).offset().top - $(window).scrollTop() < 0) {\n                        $next_page_item = $(this);\n                    } else {\n                        return false;\n                    }\n                });\n\n                return $next_page_item;\n            };\n\n            // oculta a setinha de scroll se estiver no topo ou no final da página\n            var show_hide_scrolls = function(skip_animation) {\n                var speed = skip_animation ? 0 : 200;\n                find_prev_page_menu_item() ?\n                        $('nav#home-nav a.up').animate({opacity: 1}, speed) :\n                        $('nav#home-nav a.up').animate({opacity: 0}, speed);\n\n                if(find_next_page_menu_item()){\n                    $('nav#home-nav a.down').animate(speed);\n                    $('nav#home-nav a.down').fadeIn(speed);\n                } else {\n                    $('nav#home-nav a.down').fadeOut(speed);\n                }\n            };\n\n            var scroll_timeout = null;\n            $(window).scroll(function() {\n                clearTimeout(scroll_timeout);\n                scroll_timeout = setTimeout(show_hide_scrolls, 100);\n            });\n\n            $('nav#home-nav a.down').click(function() {\n                var __this = this;\n                var $next_page_item = find_next_page_menu_item();\n                var scrollto;\n\n                if ($next_page_item) {\n\n                    scrollto = $next_page_item.offset().top;// - $('#main-header').outerHeight(true);\n\n\n                    $('html, body').animate({scrollTop: Math.ceil(scrollto)}, 800, function() {\n                        nav_mouseenter.apply(__this, [true]);\n                    });\n                }\n                return false;\n            });\n\n\n            $('nav#home-nav a.up').click(function() {\n                var __this = this;\n                var $next_page_item = find_prev_page_menu_item();\n                var scrollto;\n\n                if ($next_page_item) {\n                    scrollto = $next_page_item.offset().top - $('#main-header').outerHeight(true);\n\n\n                    $('html, body').animate({scrollTop: Math.ceil(scrollto)}, 800, function() {\n                        nav_mouseenter.apply(__this, [true]);\n                    });\n                } else {\n                    $('body').animate({scrollTop: 0}, 800, function() {\n                        nav_mouseenter.apply(__this, [true]);\n                    });\n                }\n                return false;\n            });\n\n            $('nav#home-nav a').not('.up').not('.down').click(function() {\n                var $target = $($(this).attr('href'));\n                scrollto = $target.offset().top - $('#main-header').outerHeight(true);\n                if (scrollto > $('body').scrollTop())\n                    scrollto += $('#main-header').outerHeight(true);\n                $('html, body').animate({scrollTop: Math.ceil(scrollto)});\n                return false;\n            });\n\n            // Copiado do Ski Brasil, essa parte aqui debaixo não sei se está sendo usada\n            var nav_mouseenter = function(skip_show) {\n\n                if ($(\"#page-menu\").is(':visible'))\n                    return;\n\n                var $page_item = $(this).hasClass('up') ? find_prev_page_menu_item() : find_next_page_menu_item();\n                if ($page_item) {\n                    if (skip_show !== true)\n                        $(this).find('.balao').show();\n\n                    $(this).find('.balao').find('.balao-text').html($page_item.data('menu-label'));\n\n                } else {\n                    $(this).find('.balao').hide().find('.balao-text').html('');\n                }\n\n            };\n\n            $('nav#home-nav a.up, nav#home-nav a.down').mouseenter(nav_mouseenter).mouseleave(function() {\n                $(this).find('.balao').hide().find('.balao-text').html('');\n            });\n        } else {\n            $('nav#home-nav').hide();\n        }\n\n\n        ////////// Menu da Home //////////\n\n        $('#home-nav ul span.nav-title').each(function() {\n            $(this).css('margin-left', ($(this).width() * -1) + 'px');\n            //$(this).css('margin-left', '40px');\n        })\n\n        $('#home-nav ul li a').hover(function() {\n            $(this).siblings('span.nav-title').animate({marginLeft: '40px'}, 'fast');\n        }, function() {\n            var $slider = $(this).siblings('span.nav-title');\n            $slider.animate({marginLeft: ($slider.width() * -1) + 'px'}, 'fast');\n        });\n\n    });\n\n    $(document).ready(function() {\n        hl.tip.init();\n    });\n\n    hl = {\n        /**\n         * modo de usar: <tag class=\".hltip\" title=\"Title: Content text\" >\n         */\n        tip: {\n            init: function() {\n\n                if(window.isTouchDevice) return false;\n\n                $(document.body).on('mouseenter click', \".hltip\", function(e) {\n                    var tip = $(this).data('tip');\n                    var $this = $(this);\n                    var _left = $(this).offset().left + $this.outerWidth(true) / 2 + $(document).scrollLeft();\n                    var _top = $(this).offset().top;\n                    var _height = $(this).height();\n\n                    //alterações para poder atualizar o hltip\n                    if (!tip || $(this).hasClass('hltip-auto-update')) {\n                        var content = $(this).attr('title') ? $(this).attr('title') : $(this).attr('hltitle');\n\n                        if (content.indexOf(':') > 0) {\n                            content = '<div class=\"hltip-title\">' + (content.substr(0, content.indexOf(':'))) + '</div>' + (content.substr(content.indexOf(':') + 1));\n                        }\n                        tip = $('<div class=\"hltip-box\"><div class=\"hltip-arrow-top\"></div><div class=\"hltip-text\">' + content + '</div><div class=\"hltip-arrow-bottom\"></div></div><').hide();\n                        tip.css({\n                            position: 'absolute',\n                            zIndex: 9999\n                        });\n                        $(document.body).append(tip);\n                        tip.css('width', tip.width());\n                        $(this).data('tip', tip);\n                        $(this).attr('hltitle', content);\n                        $(this).attr('title', '');\n                        if ($(this).data('hltip-classes'))\n                            tip.attr('class', $(this).data('hltip-classes') + ' hltip-box');\n                    }\n\n                    _left -= tip.width() / 2;\n\n                    if (_left + tip.width() - $(document).scrollLeft() > $(window).width() - 11)\n                        tip.css('left', $(window).width() - 11 - tip.width() + $(document).scrollLeft());\n                    else if (_left - $(document).scrollLeft() < 6)\n                        tip.css('left', $(document).scrollLeft() + 6);\n                    else\n                        tip.css('left', _left);\n\n                    var diff = $(this).offset().left + $this.outerWidth(true) / 2 + $(document).scrollLeft() - parseInt(tip.css('left'));\n\n                    if (diff < 1)\n                        diff = 1;\n                    else if (diff > parseInt(tip.outerWidth()) - 11)\n                        diff = parseInt(tip.outerWidth()) - 11;\n\n                    if ($(window).height() + $(document).scrollTop() - 11 < _top + _height + tip.height()) {\n                        tip.find('.hltip-arrow-top').hide();\n                        tip.find('.hltip-arrow-bottom').show();\n                        tip.css('top', _top - tip.height() - 6);\n\n                        tip.find('.hltip-arrow-bottom').css('margin-left', diff - tip.find('.hltip-arrow-bottom').outerWidth() / 2);\n                    } else {\n                        tip.find('.hltip-arrow-top').show();\n                        tip.find('.hltip-arrow-bottom').hide();\n                        tip.find('.hltip-arrow-top').css('margin-left', diff - tip.find('.hltip-arrow-top').outerWidth() / 2);\n                        tip.css('top', _top + _height + 6);\n                    }\n\n                    if (!tip.is(':visible')) {\n                        tip.fadeIn('fast');\n                    }\n                });\n\n                $(document.body).on('mouseleave mouseup', \".hltip\", function(e) {\n                    if ($(this).data('tip'))\n                        $(this).data('tip').fadeOut('fast');\n\n                });\n            }\n\n        }\n    };\n})(jQuery);\n","MapasCulturais = MapasCulturais || {};\n\n$(function(){\n//    $.fn.select2.defaults.separator = '; ';\n//    $.fn.editabletypes.select2.defaults.viewseparator = '; ';\n    MapasCulturais.TemplateManager.init();\n    MapasCulturais.Modal.initKeyboard('.js-dialog');\n    MapasCulturais.Modal.initDialogs('.js-dialog');\n    MapasCulturais.Modal.initButtons('.js-open-dialog');\n\n    MapasCulturais.EditBox.initBoxes('.js-editbox');\n    MapasCulturais.EditBox.initButtons('.js-open-editbox');\n\n\n    MapasCulturais.Video.setupVideoGallery('.js-videogallery');\n    MapasCulturais.Search.init(\".js-search\");\n\n    // bind alert close buttons\n    $('.alert .close').click(function(){\n        $(this).parent().slideUp('fast');\n    }).css('cursor', 'pointer');\n    \n    if(MapasCulturais.request.controller === 'app'){\n        MapasCulturais.App.init();\n    }\n\n    // dropdown\n\n    if(MapasCulturais.request.controller === 'project') {\n        var $els = $('#tab-inscricoes,#tab-inscritos').parent();\n        if(!MapasCulturais.entity.useRegistrations){\n            $els.hide();\n        }\n        $('#editable-use-registrations').on('hidden', function(e, reason) {\n            if($(this).editable('getValue', true) == '1'){\n                $els.fadeIn('fast');\n            }else{\n                $els.fadeOut('fast');\n            }\n        });\n    }\n\n    //main nav submenus toggle on click\n    $('body').on('click', '.js-submenu-toggle', function(){\n        var $self = $(this),\n            $target = eval($self.data('submenu-target'));\n        //hides by clicking outside\n        $('body').one('click', function(event){\n            if($self.find(event.target).length == 0){\n                $target.fadeOut(0);\n            }\n        });\n        $target.fadeToggle(100);\n    });\n\n    $('body').on('click', '.dropdown .placeholder', function(){\n        var $dropdown = $(this).parents('.dropdown'),\n            $submenu = $dropdown.find('.submenu-dropdown');\n\n        if($submenu.is(':visible')){\n            $submenu.hide();\n        }else{\n            $submenu.show();\n        }\n\n        if(!$dropdown.data('init')){\n            $dropdown.data('init', true);\n\n            if($dropdown.data('closeonclick')){\n                $submenu.click(function(){\n                    $submenu.hide();\n                });\n            }\n            //mouse leave disabled\n            // var $timeout;\n            // $submenu.on('mouseleave', function(){\n            //     $timeout = setTimeout(function(){\n            //         $submenu.hide();\n            //     }, 100);\n            // });\n            // $submenu.on('mouseenter', function(){\n            //     clearTimeout($timeout);\n            // });\n            // $dropdown.on('mouseenter', function(){\n            //     clearTimeout($timeout);\n            // });\n            $('body').on('click', function(event){\n                if($submenu.find(event.target).length == 0 && $dropdown.find(event.target).length == 0){\n                    $submenu.hide();\n                }\n            });\n        }\n    });\n\n     if($('#funcao-do-agente').length){\n        $('#funcao-do-agente .js-options li').click(function(){\n            var roleToRemove = $('#funcao-do-agente .js-selected span').data('role');\n            var roleToAdd = $(this).data('role');\n            var label = $(this).find('span').html();\n\n            var change = function(){\n                $('#funcao-do-agente .js-selected span').html(label);\n                $('#funcao-do-agente .js-selected span').data('role', roleToAdd);\n            };\n\n            if(roleToRemove)\n                $.post(MapasCulturais.baseURL + 'agent/removeRole/' + MapasCulturais.entity.id, {role: roleToRemove}, function(r){ if(r && !r.error) change(); });\n\n            if(roleToAdd)\n                $.post(MapasCulturais.baseURL + 'agent/addRole/' + MapasCulturais.entity.id, {role: roleToAdd}, function(r){ if(r && !r.error) change(); });\n\n\n        });\n    }\n\n    MapasCulturais.spinnerURL = MapasCulturais.assetURL + '/img/spinner.gif';\n\n\n    // identify Internet Explorer\n    if(navigator.appName != 'Microsoft Internet Explorer' && !(navigator.appName == 'Netscape' && navigator.userAgent.indexOf('Trident') !== -1)){\n        //not IE\n    }else{\n        // is IE\n        $('body').addClass('ie');\n        //identify version\n        var ua = navigator.userAgent.toLowerCase();\n        if(!isNaN(version = parseInt(ua.split('msie')[1]))){ // 7, 8, 9, 10\n            $('body').addClass('ie'+version);\n        }else if( parseInt(ua.split('rv:')[1]) === 11) { // 11\n            $('body').addClass('ie11');\n        }\n    }\n\n    if(MapasCulturais.entity){\n        MapasCulturais.entity.getTypeName = function(){\n            switch(MapasCulturais.request.controller){\n                case 'agent' : return 'agente'; break;\n                case 'space' : return 'espaço'; break;\n                case 'event' : return 'evento'; break;\n                case 'project' : return 'projeto'; break;\n            }\n        };\n    }\n\n});\n\nMapasCulturais.utils = {\n    getObjectProperties: function (obj) {\n        var keys = [];\n        for (var key in obj) {\n            keys.push(key);\n        }\n        return keys;\n    },\n    sortOjectProperties: function(obj){\n        var newObj = {};\n\n        this.getObjectProperties(obj).sort().forEach(function(e){\n            newObj[e] = obj[e];\n        });\n\n        return newObj;\n    },\n\n    isObjectEquals: function(obj1, obj2){\n//        console.log(JSON.stringify(this.sortOjectProperties(obj1)), JSON.stringify(this.sortOjectProperties(obj2)));\n        return JSON.stringify(this.sortOjectProperties(obj1)) === JSON.stringify(this.sortOjectProperties(obj2));\n    },\n\n    inArray: function(array, obj){\n        for(var i in array){\n            if(this.isObjectEquals(array[i], obj)){\n                return true;\n            }\n        }\n        return false;\n    },\n\n    arraySearch: function(array, obj){\n        for(var i in array){\n            if(this.isObjectEquals(array[i], obj)){\n                return i;\n            }\n        }\n        return false;\n    }\n};\n\nMapasCulturais.createUrl = function(controller_id, action_name, args){\n    var shortcuts = this.routes.shortcuts,\n        actions = this.routes.actions,\n        controllers = this.routes.controllers,\n\n        u = MapasCulturais.utils,\n        route = '';\n\n    action_name = action_name || this.routes.default_action_name;\n\n    if(args){\n        args = u.sortOjectProperties(args);\n    }\n\n    if(args && u.inArray(shortcuts, [controller_id, action_name, args])){\n        route = u.arraySearch(shortcuts, [controller_id, action_name, args]) + '/';\n        args = null;\n    }else if(u.inArray(shortcuts, [controller_id, action_name])){\n        route = u.arraySearch(shortcuts, [controller_id, action_name]) + '/';\n    }else{\n        if(u.inArray(controllers, controller_id)){\n            route = u.arraySearch(controllers, controller_id) + '/';\n        }else{\n            route = controller_id + '/';\n        }\n\n        if(action_name !== this.routes.default_action_name){\n            if(u.inArray(actions, action_name)){\n                route += u.arraySearch(actions, action_name) + '/';\n            }else{\n                route += action_name + '/';\n            }\n        }\n    }\n\n    if(args){\n        for(var key in args){\n            var val = args[key];\n            if(key == parseInt(key)){ // is integer\n                route += val + '/';\n            }else{\n                route += key + ':' + val + '/';\n            }\n        }\n    }\n\n    return MapasCulturais.baseURL + route;\n};\n\nMapasCulturais.auth = {\n    cb: null,\n    require: function(cb){\n        MapasCulturais.auth.cb = cb;\n            $('#require-authentication').attr('src',MapasCulturais.baseURL + 'panel/requireAuth').fadeIn();\n    },\n\n    finish: function(){\n        if(MapasCulturais.auth.cb){\n            MapasCulturais.auth.cb();\n        }\n\n        MapasCulturais.auth.cb = null;\n        $('#require-authentication').fadeOut();\n    }\n}\n\nMapasCulturais.TemplateManager = {\n    templates: {},\n    init: function(){\n        var $templates = $('.js-mustache-template');\n        var $this = this;\n        $templates.each(function(){\n            $this.templates[$(this).attr('id')] = $(this).text();\n            $(this).remove();\n        });\n    },\n\n    getTemplate: function(id){\n        if(this.templates[id])\n            return this.templates[id];\n        else\n            return null;\n    }\n};\n\nMapasCulturais.App = {\n    init: function(){\n        $('.js-select-on-click').on('click', function(){\n            var selector = $(this).data('selectTarget');\n            $(selector).trigger('doubleClick');\n        });\n        \n        if($('.js-input--app-key').length && $('.js-input--app-key--toggle').length){\n            $('.js-input--app-key--toggle').on('click', function(){\n                if($('.js-input--app-key').attr('type') === 'password'){\n                    $('.js-input--app-key').attr('type', 'text');\n                }else{\n                    $('.js-input--app-key').attr('type', 'password');\n                }\n                \n                return false;\n            });\n        }\n    }\n};\n\nMapasCulturais.defaultAvatarURL = MapasCulturais.assets.avatarAgent;\n\nfunction editableEntityAddHash(){\n    $('#editable-entity').find('.js-toggle-edit').each(function(){\n        var href = $(this).attr('href'),\n            cleanHref = href.indexOf('#') !== -1 ? href.split('#')[0] : href;\n        $(this).attr('href', cleanHref+location.hash);\n    });\n}\njQuery(document).ready(function(){\n    editableEntityAddHash();\n    $(window).on('hashchange', function(){\n        editableEntityAddHash();\n    });\n});\n\n\nMapasCulturais.Messages = {\n    delayToFadeOut: 5000,\n    fadeOutSpeed: 'slow',\n    showMessage: function(type, message) {\n        var $container = $('#editable-entity');\n        var $message = $('<div class=\"alert ' + type + '\">\"').html(message);\n        var $mainSection = $('#main-section');\n        var delayToFadeOut = this.delayToFadeOut;\n        $container.append($message);\n\n        if($container.hasClass('js-not-editable')){\n            $container.slideDown('fast');\n            $mainSection.animate({marginTop: parseInt($mainSection.css('margin-top')) + 42}, 'fast', function(){\n                $message.css('display', 'inline-block').css('display', 'inline-block').delay(delayToFadeOut).fadeOut(this.fadeOutSpeed, function() {\n                    $(this).remove();\n                    if($container.find('>').length === 0){\n                        $container.slideUp('fast');\n                        $mainSection.animate({marginTop: parseInt($mainSection.css('margin-top')) - 42}, 'fast');\n                    }\n                });\n            });\n        }else{\n            $message.css('display', 'inline-block').css('display', 'inline-block').delay(delayToFadeOut).fadeOut(this.fadeOutSpeed, function() {\n                $(this).remove();\n            });\n        }\n\n    },\n    success: function(message) {\n        this.showMessage('success', message);\n    },\n    error: function(message) {\n        this.showMessage('danger', message);\n    },\n    help: function(message) {\n        this.showMessage('info', message);\n    },\n    alert: function(message) {\n        this.showMessage('warning', message);\n    }\n\n}\n\nMapasCulturais.confirm = function (message, cb){\n    if(confirm(message))\n        cb();\n};\n\nMapasCulturais.Modal = {\n    time: 'fast',\n    initKeyboard: function (selector){\n        $(document.body).keyup(function (e){\n            if(e.keyCode == 27){\n                $(selector).each(function(){\n                   if($(this).is(':visible')) {\n                       $(this).find('.js-close').click();\n                   }\n                });\n            }\n        });\n    },\n\n    initDialogs: function(selector){\n        $(selector).each(function(){\n            $('body').append($(this));\n            if($(this).find('.js-dialog-disabled').length)\n                return;\n\n            if($(this).data('dialog-init'))\n                return;\n\n            var $dialog = $(this);\n            /*$dialog.hide();  Moved to style.css */\n\n            $dialog.data('dialog-init', 1);\n            $dialog.prepend('<h2>' + $(this).attr('title') + '</h2>');\n            $dialog.prepend('<a href=\"#\" class=\"js-close icon icon-close\"></a>');\n\n            // close button\n            $dialog.find('.js-close').click(function (){\n                MapasCulturais.Modal.close(selector);\n                return false;\n            });\n        });\n    },\n\n    initButtons: function(selector){\n\n        if($(selector).data('button-initialized')) return false;\n        else $(selector).data('button-initialized', true);\n        $(selector).each(function(){\n            var dialog_selector = $(this).data('dialog');\n            var $dialog = $(dialog_selector);\n            if($dialog.find('.js-dialog-disabled').length)\n                $(this).addClass('inactive').addClass('hltip').attr('title', $dialog.find('.js-dialog-disabled').data('message'));\n\n        });\n        $(selector).click(function(){\n            if($(this).hasClass('inactive'))\n                return false;\n\n            var dialog_selector = $(this).data('dialog');\n            MapasCulturais.Modal.open(dialog_selector);\n            if( $(this).data('dialog-callback') )\n                eval( $(this).data('dialog-callback'))($(this));\n            return false;\n        });\n    },\n\n    close: function(selector){\n        $('body').css('overflow','auto');\n        var $dialog = $(selector);\n        //alert('closing');\n        $dialog.find('.editable').editable('hide');\n        $dialog.hide();\n        return;\n    },\n\n    open: function(selector){\n        var $dialog = $(selector);\n\n        $dialog.find('div.alert.danger').html('').hide();\n        $dialog.find('.js-ajax-upload-progress').hide();\n        $dialog.css('opacity',0).show();\n        setTimeout(function(){\n           var top = $dialog.height() + 100 > $(window).height() ? $(window).scrollTop() + 100 : $(window).scrollTop() + ( $(window).height() - $dialog.height()) / 2 - 50;\n\n           $dialog.css({\n                top: top,\n                left: '50%',\n                marginLeft: -$dialog.width() / 2,\n                opacity: 1\n            });\n        },25);\n\n\n        return;\n    }\n};\n\n\nMapasCulturais.EditBox = {\n    time: 'fast',\n\n    setPosition: function($box, target){\n        if($box.hasClass('mc-left')){\n            $box.position({\n                my: 'right-10 center',\n                at: 'left center',\n                of: target\n            });\n\n        }else if($box.hasClass('mc-right')){\n            $box.position({\n                my: 'left+10 center',\n                at: 'right center',\n                of: target\n            });\n\n        }else if($box.hasClass('mc-top')){\n            $box.position({\n                my: 'center bottom-10',\n                at: 'center top',\n                of: target\n            });\n\n        }else if($box.hasClass('mc-bottom')){\n            $box.position({\n                my: 'center top+10',\n                at: 'center bottom',\n                of: target\n            });\n        }\n    },\n\n    initKeyboard: function (selector){\n        $(document.body).keyup(function (e){\n            if(e.keyCode == 27){\n                $(selector).each(function(){\n                   if($(this).is(':visible')) {\n                       $(this).find('.js-close').click();\n                   }\n                });\n            }\n        });\n    },\n\n    initBoxes: function(selector){\n\n        $(selector).each(function(){\n            var $dialog = $(this);\n\n            if($dialog.find('.js-dialog-disabled').length)\n                return;\n\n            if($dialog.data('dialog-init'))\n                return;\n\n            if($dialog.data('init'))\n                return;\n\n            $dialog.data('init', true);\n\n            /*$dialog.hide();  Moved to style.css */\n\n            $dialog.addClass('edit-box');\n\n            $dialog.data('dialog-init', 1);\n            if($dialog.attr('title')){\n                $dialog.prepend('<header><h1>' + $(this).attr('title') + '</h1></header>');\n            }\n            var submit_label = $dialog.data('submit-label') ? $dialog.data('submit-label') : 'Enviar';\n            var cancel_label = $dialog.data('cancel-label') ? $dialog.data('cancel-label') : 'Cancelar';\n\n            $dialog.append('<footer><button class=\"mc-cancel btn btn-default\">' + cancel_label + '</button> <button type=\"submit\" class=\"mc-submit\">' + submit_label + '</button> </footer><div class=\"mc-arrow\"></div>');\n\n            // close button\n            $dialog.find('.mc-cancel').click(function (){\n                MapasCulturais.EditBox.close($dialog);\n                return false;\n            });\n\n            // submit form\n            $dialog.find('footer button.mc-submit').click(function(){\n                $dialog.find('form').submit();\n            });\n        });\n    },\n\n    initButtons: function(selector){\n        $(selector).each(function(){\n            var $button = $(this);\n            var dialog_selector = $(this).data('target');\n            var $dialog = $(dialog_selector);\n            if($dialog.find('.js-dialog-disabled').length)\n                $(this).addClass('inactive').addClass('hltip').attr('title', $dialog.find('.js-dialog-disabled').data('message'));\n\n        });\n        $(selector).click(function(){\n            var $button = $(this);\n            if($button.hasClass('inactive'))\n                return false;\n\n            var dialog_selector = $button.data('target');\n\n            MapasCulturais.EditBox.open(dialog_selector, $button);\n\n            if($button.data('dialog-title'))\n                $(dialog_selector).find('header h1').html($button.data('dialog-title'));\n\n            if( $button.data('dialog-callback') )\n                eval( $button.data('dialog-callback'))($button);\n\n            return false;\n        });\n    },\n\n    close: function(selector){\n        $('body').css('overflow','auto');\n        var $dialog = $(selector);\n        //alert('closing');\n        $dialog.find('.editable').editable('hide');\n        $dialog.hide();\n        return;\n    },\n\n    open: function(selector, $button){\n        var $dialog = $(selector);\n        $dialog.find('div.alert.danger').html('').hide();\n\n        MapasCulturais.AjaxUploader.resetProgressBar(selector);\n\n        $dialog.show();\n        $dialog.find('input,textarea').not(':hidden').first().focus();\n        $dialog.css('opacity',0);\n        MapasCulturais.EditBox.setPosition($dialog, $button);\n        setTimeout(function(){\n            MapasCulturais.EditBox.setPosition($dialog, $button);\n            $dialog.css('opacity',1);\n        },25);\n\n        return;\n    }\n};\n\n\nMapasCulturais.Video = {\n    collection : {},\n    parseURL : function(url){\n        return purl(url);\n    },\n    isYoutube : function(parsedURL){\n            return parsedURL.attr('host').indexOf('youtube') != -1;\n    },\n    getYoutubeData : function(youtubeVideoID){\n        return {\n            thumbnalURL : 'http://img.youtube.com/vi/'+videoID+'/0.jpg',\n            playerURL : '//www.youtube.com/embed/'+videoID+'?html5=1'\n        }\n    },\n    getVideoBasicData : function(url){\n        var parsedURL = this.parseURL(url);\n        var host = parsedURL.attr('host');\n        var provider = '';\n        var videoID = '';\n        if(parsedURL.attr('host').indexOf('youtube') != -1 ){\n            provider = 'youtube';\n            videoID = parsedURL.param('v');\n        }else if(parsedURL.attr('host').indexOf('vimeo') != -1){\n            provider = 'vimeo';\n            videoID = parsedURL.attr('path').split('/')[1];\n        }\n        return {\n            'parsedURL' : parsedURL,\n            'provider' : provider,\n            'videoID' : videoID\n        }\n    },\n    setupVideoGallery : function(gallerySelector){\n\n        if($(gallerySelector).length == 0)\n            return false;\n\n        $( gallerySelector + ' .js-metalist-item-display').each(function(){\n            MapasCulturais.Video.getAndSetVideoData($(this).data('videolink'), $(this).parent(), MapasCulturais.Video.setupVideoGalleryItem);\n        });\n        var $firstItem = $( gallerySelector + ' .js-metalist-item-display:first').parent();\n        if(!$firstItem.length) {\n            $('#video-player').hide();\n            return false;\n        }\n        $('iframe#video_display').attr('src', $firstItem.data('player-url'));\n        $firstItem.addClass('active');\n    },\n    setupVideoGalleryItem : function(videoData, $element){\n        //$Element should be a.js-metalist-item-display\n        $element.attr('href', '#video');\n        $element.data('player-url', videoData.playerURL);\n        $element.find('img').attr('src', videoData.thumbnailURL);\n\n        var video_id = $element.attr('id');\n\n        $element.on('click', function(){\n            $('iframe#video_display').attr('src', videoData.playerURL);\n            $('iframe#video_display').data('open-video', $(this).attr('id'));\n            $(this).parent().find('.active').removeClass('active');\n            $(this).addClass('active');\n        });\n\n        var $container = $element.parent();\n        if($element.find('.js-remove-item').length){\n            $element.find('.js-remove-item').data('remove-callback', function(){\n                if($('iframe#video_display').data('open-video') == video_id)\n                    $('iframe#video_display').attr('src', '');\n\n                if($container.find('>li').length == 0)\n                    $('#video-player').hide();\n            });\n        }\n\n        if($container.find('>li').length == 1){\n            $element.addClass('active');\n            $('iframe#video_display').attr('src', videoData.playerURL);\n        }\n\n    },\n    setTitle : function(videoData, $element){\n        $element.val(videoData.videoTitle);\n    },\n    getAndSetVideoData : function (videoURL, $element, callback){\n        videoURL = videoURL.trim();\n        var videoData = {\n            parsedURL : purl(videoURL),\n            provider : '',\n            videoID : '',\n            thumbnailURL : '',\n            playerURL : '',\n            details : {}\n        };\n\n        if(videoData.parsedURL.attr('host').indexOf('youtube') != -1){\n            videoData.provider = 'youtube';\n            videoData.videoID = videoData.parsedURL.param('v');\n            videoData.thumbnailURL = 'http://img.youtube.com/vi/'+videoData.videoID+'/0.jpg';\n            videoData.playerURL = '//www.youtube.com/embed/'+videoData.videoID+'?html5=1';\n            callback(videoData, $element);\n            $.getJSON('https://gdata.youtube.com/feeds/api/videos/'+videoData.videoID+'?v=2&alt=json', function(data) {\n                videoData.details = data;\n                videoData.videoTitle = data.entry.title.$t;\n                MapasCulturais.Video.collection[videoURL] = videoData;\n                callback(videoData, $element);\n                return videoData;\n            });\n        }else if(videoData.parsedURL.attr('host').indexOf('vimeo') != -1){\n            videoData.provider = 'vimeo';\n            var tmpArray = videoData.parsedURL.attr('path').split('/');\n            videoData.videoID = tmpArray[tmpArray.length-1];\n            $.getJSON('http://www.vimeo.com/api/v2/video/'+videoData.videoID+'.json?callback=?', {format: \"json\"}, function(data) {\n                videoData.details = data[0];\n                videoData.thumbnailURL = data[0].thumbnail_small;\n                videoData.playerURL = '//player.vimeo.com/video/'+videoData.videoID+'';\n                videoData.videoTitle = data[0].title;\n                callback(videoData, $element);\n                MapasCulturais.Video.collection[videoURL] = videoData;\n                return videoData;\n            });\n        }else{\n            //no valid provider\n            videoData.thumbnailURL = 'http://www.bizreport.com/images/shutterstock/2013/04/onlinevideo_135877229-thumb-380xauto-2057.jpg';\n            callback(videoData, $element);\n            return videoData;\n        }\n\n        var withDetails = function(){\n            // get details from youtube api\n            if(!videoData.details) {\n                $.getJSON('https://gdata.youtube.com/feeds/api/videos/'+videoData.videoID+'?v=2&alt=json', {format: \"json\"}, function(data) {\n                    videoData.details = data;\n                    functionName(videoData, $element);\n                    return videoData;\n                });\n            }\n        };\n    }\n};\n\nMapasCulturais.Search = {\n    limit: 10,\n\n    init : function(selector){\n        if( $(selector).length === 0 || $(selector).hasClass('select2-offscreen')) return false;\n\n        $(selector).each(function(){\n            var $selector = $(this);\n\n            $selector.editable({\n                type:'select2',\n                name: $selector.data('field-name') ? $selector.data('field-name') : null,\n                select2:{\n//                    multiple: $selector.data('multiple'),\n//                    tokenSeparators: [\";\",\";\"],\n//                    separator:'; ',\n//                    viewseparator: '; ',\n                    width: $selector.data('search-box-width'),\n                    placeholder: $selector.data('search-box-placeholder'),\n                    minimumInputLength: 0,\n                    allowClear: $selector.data('allow-clear'),\n                    initSelection: function(e,cb){\n                        cb({id: $selector.data('value'), name: $selector.data('editable').$element.html()});\n                    },\n                    ajax: {\n                        url: function(){\n                            var format = $selector.data('selection-format');\n                            var apiMethod = 'find';\n                            if(MapasCulturais.Search.formats[format] && MapasCulturais.Search.formats[format].apiMethod)\n                                apiMethod =  MapasCulturais.Search.formats[format].apiMethod;\n                            return MapasCulturais.baseURL + 'api/' + $selector.data('entity-controller') + '/' + apiMethod;\n                        },\n                        dataType: 'json',\n                        quietMillis: 350,\n                        data: function (term, page) { // page is the one-based page number tracked by Select2\n                            var searchParams = MapasCulturais.Search.getEntityController(term, page, $selector);\n\n                            var format = $selector.data('selection-format');\n\n                            if(MapasCulturais.Search.formats[format] && MapasCulturais.Search.formats[format].ajaxData)\n                                searchParams = MapasCulturais.Search.formats[format].ajaxData(searchParams, $selector);\n                            else\n                                searchParams = MapasCulturais.Search.ajaxData(searchParams, $selector);\n\n                            return searchParams;\n                        },\n                        results: function (data, page) {\n                            var more = data.length == MapasCulturais.Search.limit;\n                            // notice we return the value of more so Select2 knows if more results can be loaded\n\n                            return {results: data, more: more};\n                        }\n                    },\n                    formatResult: function(entity){\n                        var format = $selector.data('selection-format');\n                        if(MapasCulturais.Search.formats[format] && MapasCulturais.Search.formats[format].result)\n                            return MapasCulturais.Search.formats[format].result(entity, $selector);\n                        else\n                            return MapasCulturais.Search.formatResult(entity, $selector);\n                    }, // omitted for brevity, see the source of this page\n\n                    formatSelection: function(entity){\n                        var format = $selector.data('selection-format');\n                        return MapasCulturais.Search.formats[format].selection(entity, $selector);\n                    }, // omitted for brevity, see the source of this page\n\n                    formatNoMatches: function(term){\n                        var format = $selector.data('selection-format');\n                        return MapasCulturais.Search.formats[format].noMatches(term, $selector);\n                    },\n                    escapeMarkup: function (m) { return m; }, // we do not want to escape markup since we are displaying html in results\n                }\n            });\n            if($selector.data('disable-buttons') ){\n                $selector.on('shown', function(e, editable) {\n                    var format = $selector.data('selection-format');\n\n                    /*Hide editable buttons because the option showbuttons:false autosubmitts the form adding two agents...\n                    Also Auto-open select2 on editable.shown and auto-close editable popup on select2-close*/\n\n                    e.stopPropagation();\n                    if (arguments.length == 2) {\n                        setTimeout(function() {\n                            editable.input.$input.parents('.control-group').addClass('editable-popup-botoes-escondidos');\n                        }, 0);\n                        setTimeout(function() {\n                            editable.input.$input.select2(\"open\");\n                        }, 200);\n                        editable.input.$input.on('select2-close', function(){\n                            setTimeout(function() {\n                                $selector.editable('hide');\n                            }, 200);\n                        });\n                    }\n                });\n            }\n            if($selector.data('auto-open') ){\n                $selector.on('shown', function(e, editable) {\n                    setTimeout(function() {\n                        editable.input.$input.select2(\"open\");\n                    }, 200);\n                });\n            }\n            var format = $selector.data('selection-format');\n            $selector.on('save',function(){\n                try{\n                    MapasCulturais.Search.formats[format].onSave($selector);\n                }catch(e){\n                    console.log(\"EXECEPTION: \", e.message);\n                }\n            });\n            $selector.on('hidden',function(){\n                try{\n                    MapasCulturais.Search.formats[format].onHidden($selector);\n                }catch(e){\n                    console.log(\"EXECEPTION: \", e.message);\n                }\n            });\n\n        });\n    },\n\n\n\n    getEntityController : function(term, page, $selector){\n\n        var entitiyControllers = {\n            'default':{\n                name: 'ilike(*'+term.replace(' ', '*')+'*)', //search term\n                '@select': 'id,name,terms,type',\n                '@limit': MapasCulturais.Search.limit, // page size\n                '@page': page,\n                '@order':'name ASC', // page number\n                '@files':'(avatar.avatarSmall):url'\n            },\n            'agent':{ //apenas adicionei a shortDescription\n                name: 'ilike(*'+term.replace(' ', '*')+'*)', //search term,\n                '@select': 'id,name,terms,type',\n                '@limit': MapasCulturais.Search.limit, // page size\n                '@page': page,\n                '@order':'name ASC', // page number\n                '@files':'(avatar.avatarSmall):url'\n            }\n        };\n\n        if(entitiyControllers[$selector.data('entity-controller')]){\n            return entitiyControllers[$selector.data('entity-controller')];\n        }else{\n            return entitiyControllers['default'];\n        }\n    },\n\n    processEntity: function(entity, $selector){\n        entity.areas = function(){\n            if(this.terms && this.terms.area)\n                return this.terms.area.join(', ');\n            else\n                return '';\n        };\n\n        entity.linguagens = function(){\n            if(this.terms && this.terms.linguagem)\n                return this.terms.linguagem.join(', ');\n            else\n                return '';\n        };\n\n        entity.tags = function(){\n            if(this.terms && this.terms.tags)\n                return this.terms.tags.join(', ');\n            else\n                return '';\n        };\n\n        entity.thumbnail = function(){\n            var entityDefaultAvatar = MapasCulturais.assets['avatar'+$selector.data('entity-controller')[0].toUpperCase() + $selector.data('entity-controller').slice(1)];\n            if(this['@files:avatar.avatarSmall'])\n                return this['@files:avatar.avatarSmall'].url;\n            else\n                return entityDefaultAvatar;\n        };\n\n    },\n\n    renderTemplate : function(template, entity, $selector){\n        this.processEntity(entity, $selector);\n        return Mustache.render(template, entity);\n    },\n\n    getEntityThumbnail : function (entity, thumbName){\n        if(!entity.files || entity.files.length == 0 || !entity.files[thumbName] || entity.files[thumbName].length == 0)\n            return '';\n        else{\n            if(entity.files[thumbName].files['avatarSmall'])\n                return entity.files[thumbName].files['avatarSmall'].url;\n        }\n    },\n\n    formatResult : function (entity, $selector) {\n        var searchResultTemplate = $($selector.data('search-result-template')).text();\n        return this.renderTemplate(searchResultTemplate, entity, $selector);\n    },\n\n    ajaxData: function(searchParams, $selector){\n        var excludedIds = MapasCulturais.request.controller === $selector.data('entity-controller') && MapasCulturais.entity.id ? [MapasCulturais.entity.id] : [];\n\n        if(excludedIds.length > 0)\n            searchParams.id = '!in(' + excludedIds.toString() + ')';\n\n        return searchParams;\n    },\n\n    formats: {\n        chooseProject:{\n            //apiMethod : 'findByUserApprovedRegistration',\n            onSave: function($selector){\n                var entity = $selector.data('entity');\n                $selector.data('value', entity.id);\n                $selector.data('value-name', entity.name);\n            },\n            selection: function(entity, $selector){\n                $selector.data('entity', entity);\n                return entity.name;\n            },\n\n            noMatches: function(term, $selector){\n                return 'Nenhum projeto encontrado.';\n            },\n\n            onClear: function($selector){\n            },\n\n            ajaxData: function(searchParams){\n                searchParams['@permissions'] = 'requestEventRelation';\n                return searchParams;\n            }\n        },\n\n        chooseSpace: {\n            onSave: function($selector){\n                var entity = $selector.data('entity'),\n                    avatarUrl = MapasCulturais.defaultAvatarURL,\n                    shortDescription = entity.shortDescription ? entity.shortDescription.replace(\"\\n\",'<br/>') : '';\n\n                $selector.data('value', entity.id);\n\n                try{\n                    avatarUrl = entity.files.avatar.files.avatarSmall.url;\n                }catch(e){};\n\n                $selector.parents('.js-space').find('.js-space-avatar').attr('src', avatarUrl);\n                $selector.parents('.js-space').find('.js-space-description').html(shortDescription);\n\n                $selector.parents('form').find('input[name=\"spaceId\"]').val(entity.id);\n            },\n            onHidden : function ($selector) {\n                $selector.removeClass('editable-unsaved');\n            },\n\n            selection: function(entity, $selector){\n                $selector.data('entity', entity);\n                return entity.name;\n            },\n\n            noMatches: function(term, $selector){\n                return 'Nenhum espaço encontrado.';\n            },\n\n            onClear: function($selector){ },\n\n            ajaxData: function(searchParams, $selector){\n\n                if($selector.data('value')){\n                    searchParams.id = '!in('+$selector.data('value')+')';\n                }\n\n                //if(!MapasCulturais.cookies.get('mapasculturais.adm'))\n                //    searchParams.owner = 'in(@me.spaces)';\n\n                searchParams['@select'] += ',shortDescription';\n//                searchParams['@permissions'] += '@control';\n                return searchParams;\n            }\n        },\n\n        createAgentRelation: {\n            selection: function (entity, $selector) {\n                var $selectionTarget =   $($selector.data('selection-target'));\n                var targetAction =      $selector.data('target-action');\n                var selectionTemplate = $($selector.data('selection-template')).text();\n\n                var groupname = $selector.parents('.js-related-group').find('.js-related-group-name').text();\n\n                $.post(\n                    MapasCulturais.baseURL + MapasCulturais.request.controller + '/createAgentRelation/id:' + MapasCulturais.entity.id,\n                    {agentId: entity.id, group:groupname, has_control: '0'}\n                );\n\n\n                if(targetAction == 'append'){\n                    MapasCulturais.RelatedAgents.addAgentToGroup(groupname, entity);\n                    return $selector.data('search-box-placeholder');\n                }else{\n                    $selectionTarget.html(markup);\n                    return entity.name;\n                }\n            },\n\n            noMatches: function (term, $selector){\n                var noResultTemplate = $($selector.data('no-result-template')).text();\n                $('#dialog-adicionar-integrante').data('group-element', $selector.parents('.js-related-group').find('.js-relatedAgentsContainer'));\n                //return term + ' HAHAHA!';\n                return noResultTemplate.replace('{{group}}', $selector.parents('.js-related-group').find('.js-related-group-name').text());\n            },\n\n            ajaxData: function(searchParams, $selector){\n                var group = $selector.parents('.js-related-group').find('.js-related-group-name').text();\n\n                var excludedIds = MapasCulturais.request.controller === 'agent' && MapasCulturais.entity.id? [MapasCulturais.entity.id] : [];\n                try{\n                    if(MapasCulturais.agentRelationGroupExludeIds[group])\n                        excludedIds = excludedIds.concat(MapasCulturais.agentRelationGroupExludeIds[group]);\n                }catch(e){}\n\n                excludedIds = excludedIds.concat (\n                    $selector.parents('.js-related-group').find('.agentes .avatar').map(\n                        function(){ return $(this).data('id'); }\n                ).toArray());\n\n\n                if ( excludedIds.length > 0)\n                    searchParams.id = '!in('+excludedIds.toString()+')';\n\n                return searchParams;\n            }\n        },\n\n        parentSpace:{\n            selection: function(entity, $selector){\n                return entity.name;\n            },\n\n            noMatches: function(term, $selector){\n                return 'Nenhum espaço encontrado.';\n            },\n\n            onClear: function($selector){\n            },\n\n            ajaxData: function(searchParams, $selector){\n                if(MapasCulturais.entity.id){\n                    var excludeIds = [MapasCulturais.entity.id].concat(MapasCulturais.entity.childrenIds);\n                    if(excludeIds){\n                        searchParams['id'] = '!IN(' + excludeIds + ')';\n                    }\n\n                }\n                return searchParams;\n            }\n        },\n\n        parentProject:{\n            selection: function(entity, $selector){\n                return entity.name;\n            },\n\n            noMatches: function(term, $selector){\n                return 'Nenhum projeto encontrado.';\n            },\n\n            onClear: function($selector){\n            },\n\n            ajaxData: function(searchParams, $selector){\n                if(MapasCulturais.entity.id){\n                    var excludeIds = [MapasCulturais.entity.id].concat(MapasCulturais.entity.childrenIds);\n                    if(excludeIds){\n                        searchParams['id'] = '!IN(' + excludeIds + ')';\n                    }\n\n                }\n\n                return searchParams;\n            }\n        },\n\n        projectRegistration: {\n            onSave: function($selector){\n                var entity = $selector.data('entity'),\n                    avatarUrl = MapasCulturais.defaultAvatarURL,\n                    shortDescription = entity.shortDescription.replace(\"\\n\",'<br/>');\n\n                $('#registration-agent-id').val(entity.id);\n\n            },\n\n            onHidden : function ($selector) {\n                $selector.removeClass('editable-unsaved');\n            },\n\n            selection: function(entity, $selector){\n                $selector.data('entity', entity);\n                return entity.name;\n            },\n\n            noMatches: function(term, $selector){\n                return 'Nenhum agente encontrado.';\n            },\n\n            onClear: function($selector){ },\n\n            ajaxData: function(searchParams, $selector){\n                var excludedIds = MapasCulturais.request.controller === 'agent' && MapasCulturais.entity.id? [MapasCulturais.entity.id] : [];\n\n                excludedIds.push($selector.data('value'));\n\n                if ( excludedIds.length > 0)\n                    searchParams.id = '!in('+excludedIds.toString()+')';\n\n                if(!MapasCulturais.cookies.get('mapasculturais.adm'))\n                    searchParams.user = 'eq(@me)';\n\n                if($selector.data('profiles-only'))\n                    searchParams.isUserProfile = 'eq(true)';\n\n                searchParams['@select'] += ',shortDescription,';\n                return searchParams;\n            }\n\n        },\n\n        changeOwner:{\n            onSave: function($selector){\n                var entity = $selector.data('entity'),\n                    avatarUrl = MapasCulturais.defaultAvatarURL,\n                    shortDescription = entity.shortDescription.replace(\"\\n\",'<br/>');\n\n                $selector.data('value', entity.id);\n\n                try{\n                    avatarUrl = entity.files.avatar.files.avatarSmall.url;\n                }catch(e){};\n\n                $selector.parents('.js-owner').find('.js-owner-avatar').attr('src', avatarUrl);\n                $selector.parents('.js-owner').find('.js-owner-description').html(shortDescription);\n\n            },\n\n            selection: function(entity, $selector){\n                $selector.data('entity', entity);\n                return entity.name;\n            },\n\n            noMatches: function(term, $selector){\n                return 'Nenhum agente encontrado.';\n            },\n\n            onClear: function($selector){ },\n\n            ajaxData: function(searchParams, $selector){\n                var excludedIds = [$selector.editable('getValue').ownerId];\n\n                if(MapasCulturais.request.controller === 'agent' && MapasCulturais.entity.id){\n                    excludedIds.push(MapasCulturais.entity.id);\n                    if(MapasCulturais.entity.childrenIds){\n                        excludedIds = excludedIds.concat(MapasCulturais.entity.childrenIds);\n                    }\n                }\n\n                if ( excludedIds.length > 0)\n                    searchParams.id = '!in('+excludedIds.toString()+')';\n\n                searchParams['@select'] += ',shortDescription';\n                searchParams['@permissions'] = '@control';\n                return searchParams;\n            }\n        }\n    }\n};\n\n\nMapasCulturais.cookies = {\n    get: function(name) {\n        var nameEQ = name + \"=\";\n        var ca = document.cookie.split(';');\n        for(var i=0;i < ca.length;i++) {\n            var c = ca[i];\n            while (c.charAt(0)==' ') c = c.substring(1,c.length);\n            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);\n        }\n        return null;\n    },\n\n    set: function(key, value, options){\n        options = $.extend({}, options);\n\n        if (value == null) {\n            options.expires = -1;\n        }\n\n        if (typeof options.expires === 'number') {\n            var days = options.expires, t = options.expires = new Date();\n            t.setDate(t.getDate() + days);\n            options.expires = options.expires.toUTCString();\n        }else{\n            options.expires = 'Session';\n        }\n\n        value = String(value);\n\n        return (document.cookie = [\n            encodeURIComponent(key), '=', options.raw ? value : encodeURIComponent(value),\n            options.expires ? '; expires=' + options.expires : '', // use expires attribute, max-age is not supported by IE\n            options.path    ? '; path=' + options.path : '',\n            options.domain  ? '; domain=' + options.domain : '',\n            options.secure  ? '; secure' : ''\n            ].join(''));\n    }\n};\n","//Inicia o mapa para a busca e configura o timeout do scroll\njQuery(document).ready(function() {\n\n    if ($('body').hasClass('action-search')) {\n        MapasCulturais.Map.initialize({mapSelector: '.js-map', locateMeControl: false, exportToGlobalScope: true, mapCenter: MapasCulturais.mapCenter});\n    }\n\n});\n\n\n(function(angular) {\n    var app = angular.module('ng-mapasculturais', []);\n    app.config([\"$httpProvider\", function($httpProvider) {\n\n            $httpProvider.responseInterceptors.push(['$q', '$rootScope', function($q, $rootScope) {\n\n                return function(promise) {\n                    $rootScope.$broadcast(\"event:startProgress\");\n                    return promise\n                        .then(\n                            function(response) {\n                                $rootScope.$broadcast(\"event:endProgress\");\n                                return response;\n                            },\n                            function(response) { //on error\n                                $rootScope.$broadcast(\"event:endProgress\");\n                                return $q.reject(response);\n                            }\n                        );\n\n                };\n            }]);\n        }]);\n})(angular);\n\n","(function(angular){\n    \"use strict\";\n\n    var module = angular.module('mc.module.notifications', []);\n\n    module.factory('NotificationService', ['$log','$http', '$q', '$rootScope', function($log, $http, $q, $rootScope){\n\n        var service = {};\n\n        service.url = MapasCulturais.baseURL + 'notification/';\n\n        service.get = function (){\n            var deferred = $q.defer();\n            $http.get(\n                MapasCulturais.baseURL+'api/notification/find/?&@select=id,status,isRequest,createTimestamp,message,approveUrl,request.permissionTo.approve,request.permissionTo.reject,request.requesterUser.id&user=eq(@me)&@ORDER=createTimestamp%20DESC'\n            ).success(function(data){\n                deferred.resolve(data);\n            }).error(function(){\n                deferred.reject('There was an error');\n            });\n            return deferred.promise;\n        };\n        service.updateOne = function(id, action){\n            var deferred = $q.defer();\n            $http.get(\n                service.url+action+'/'+id)\n            .success(function(data){\n                deferred.resolve(data);\n            }).error(function(){\n                deferred.reject('There was an error');\n            });\n            return deferred.promise;\n        };\n        return service;\n    }]);\n\n    module.controller('NotificationController', ['$log', '$sce', '$scope', '$rootScope', '$interval', 'NotificationService', function($log, $sce, $scope, $rootScope, $interval, NotificationService){\n\n        $scope.panelURI = MapasCulturais.baseURL+'panel';\n        $scope.MapasCulturais = MapasCulturais;\n\n        MapasCulturais.notifications.forEach(function(value,index){\n            MapasCulturais.notifications[index].message = $sce.trustAsHtml(value.message);\n        });\n        $scope.data = MapasCulturais.notifications;\n\n        var getNotifications = function (){\n            NotificationService.get().then(function(data){\n                if(data){\n                    data.forEach(function(value,index){\n                        data[index].message = $sce.trustAsHtml(value.message);\n                    });\n                    $scope.data = data;\n                }\n            });\n        };\n\n        $interval(function(){\n            getNotifications();\n        }, 60*1000);\n\n        $scope.approve = function(id){\n            NotificationService.updateOne(id,'approve').then(getNotifications);\n        };\n        $scope.reject = function(id){\n            NotificationService.updateOne(id,'reject').then(getNotifications);\n        };\n        $scope.delete = function(id){\n            NotificationService.updateOne(id,'delete').then(getNotifications);\n        };\n\n        $scope.adjustScroll = function(){\n            jQuery('.notifications .submenu ul').slimScroll({\n                position: 'right',\n                distance: '0px',\n                color: '#000',\n                height: '316px',\n                alwaysVisible: true,\n                railVisible: true\n            });\n        };\n    }]);\n\n    module.directive('onLastRepeat', function() {\n        return function(scope, element, attrs) {\n            if (scope.$last) { // all are rendered\n                scope.$evalAsync(attrs.onLastRepeat);\n            }\n        };\n    });\n\n    angular.element(document).ready(function(){\n        var app = null;\n        //checks existence of default search and Entity (singles') angular modules\n        ['search.app', 'entity.app'].forEach(function(moduleName){\n            if(!app){\n                try{\n                    app = angular.module(moduleName);\n                }catch(e){}\n            }\n        });\n        //can't find expected app\n        if(!app) {\n            var ctrl = document.querySelector('[ng-controller=NotificationController]');\n\n            // let's search again\n            if(ctrl && !angular.element(ctrl.parentElement).scope()) {\n                angular.bootstrap(ctrl.parentElement, ['mc.module.notifications']);\n            }\n        }\n        app = angular.module('mc.module.notifications');\n    });\n\n})(angular);\n\n\n","MapasCulturais = MapasCulturais || {};\ntabIndex = function() { window.tabEnabled = true };\njQuery(function(){\n    $.fn.editableform.buttons = '<button type=\"button\" class=\"editable-cancel btn btn-default\">cancelar</button> <button type=\"submit\" class=\"editable-submit\">ok</button>';\n    $.fn.select2.defaults.separator = '; ';\n    $.fn.editabletypes.select2.defaults.viewseparator = '; ';\n    MapasCulturais.Editables.init('#editable-entity');\n    MapasCulturais.AjaxUploader.init();\n    MapasCulturais.MetalistManager.init();\n\n\n    MapasCulturais.Remove.init();\n\n\n    $('.js-registration-action').click(function(){\n        if($(this).hasClass('selected'))\n            return false;\n\n        var href = $(this).data('href');\n        var data = {agentId: $(this).data('agent-id')};\n        var $this = $(this);\n\n        $.post(href, data, function(response){\n            $this.parent().find('.js-registration-action').removeClass('selected');\n            $this.addClass('selected');\n\n            // status = 1 (aprovado)\n            // status = -6 (rejeitado)\n\n        });\n        return false;\n    });\n\n    //Máscaras de telefone, CEP e hora\n\n    $('.js-editable').on('shown', function(e, editable) {\n        if ($(this).hasClass('js-mask-phone')) {\n            var masks = ['(00) 00000-0000', '(00) 0000-00009'];\n            editable.input.$input.mask(masks[1], {onKeyPress:\n               function(val, e, field, options) {\n                   field.mask(val.length > 14 ? masks[0] : masks[1], options) ;\n               }\n            });\n        }\n\n        if ($(this).hasClass('js-mask-cep')) {\n            var masks = ['00000-000'];\n            editable.input.$input.mask(masks[0], {onKeyPress:\n               function(val, e, field, options) {\n                   field.mask(masks[0], options) ;\n               }\n            });\n        }\n\n        if ($(this).hasClass('js-mask-time')) {\n            //Mask\n            var masks = ['00:00'];\n            editable.input.$input.mask(masks[0], {onKeyPress:\n               function(val, e, field, options) {\n                   field.mask(masks[0], options) ;\n               }\n            });\n        }\n\n        // Fixes editable input size based on placeholder length\n        var placeholder = editable.input.$input.attr('placeholder'),\n        possibleSize = placeholder ? Math.max(placeholder.length, editable.value.length + 5) : 0;\n        if (possibleSize > 20) {\n            editable.input.$input.attr('size', possibleSize);\n        }\n            \n\n        // Fixes padding right hardcoded on 24px, now 0;\n        //editable.input.$input.css('padding-right', 10);\n    });\n\n    //Display Default Shortcuts on Editable Buttons and Focus on select2 input\n    $('.editable').on('shown', function(e, editable) {\n        editable.container.$form.find('.editable-cancel').attr('title', 'Cancelar Alteração (Esc)');\n        //textarea display default Ctrl+Enter and Esc shortcuts\n        switch (editable.input.type.trim()) {\n            case 'text|select':\n                editable.container.$form.find('.editable-submit').attr('title', 'Confirmar Alteração (Enter)');\n                break;\n            case 'textarea':\n                editable.container.$form.find('.editable-submit').attr('title', 'Confirmar Alteração (Ctrl+Enter)');\n                break;\n            case 'select2':\n                editable.container.$form.find('.editable-submit').attr('title', 'Confirmar Alteração (Ctrl+Enter)');\n                setTimeout(function() {\n                    editable.container.$form.find('.select2-input')\n                        .focus()\n                        .on('keydown', function(e){\n                            if(e.which == 13 && e.ctrlKey) {\n                                editable.container.$form.find('.editable-submit').click();\n                            }\n                        });\n                }, 100);\n                break;\n        }\n\n        //Experimental Tab Index\n        if(window.tabEnabled) {\n            var $el = editable.$element;\n            editable.input.$input.on('keydown', function(e) {\n                if(e.which == 9) {                                                      // when tab key is pressed\n                    e.preventDefault();\n                    if(e.shiftKey) {                                                    // shift + tab\n                        $(this) .blur();\n                        $el.parents().prevAll(\":has(.editable):first\") // find the parent of the editable before this one in the markup\n                        .find(\".js-editable:last\").editable('show');                    // grab the editable and display it\n                    } else {                                                            // just tab\n                        $(this) .blur();\n                        $el.parents().nextAll(\":has(.editable):first\") // find the parent of the editable after this one in the markup\n                        .find(\".js-editable:first\").editable('show');                   // grab the editable and display it\n                    }\n                }\n            });\n            editable.$element.on('hidden', function(e, reason) {\n                if(reason == 'save' || reason == 'nochange')\n                    $el.parents().nextAll(\":has(.editable):first\").find(\".editable:first\").editable('show');\n            });\n        }\n    });\n\n    if($('.js-verified').length){\n        $('.js-verified').click(function(){\n            var $this = $(this);\n            if($this.hasClass('active')){\n                $this.removeClass('active');\n                $('#is-verified-input').editable('setValue', 0);\n            }else{\n                $this.addClass('active');\n                $('#is-verified-input').editable('setValue', 1);\n            }\n            return false;\n        });\n    }\n});\n\n$(window).on('beforeunload', function(){\n    if($('.editable-unsaved').length){\n        return 'Há alterações não salvas nesta página.';\n    }\n});\n\nMapasCulturais.Remove = {\n    init: function(){\n        $('body').on('click','.js-remove-item', function(e){\n            e.stopPropagation();\n            var $this = $(this);\n            MapasCulturais.confirm('Deseja remover este item?', function(){\n                var $target = $($this.data('target'));\n                var href = $this.data('href');\n\n                $.getJSON(href,function(r){\n                    if(r.error){\n                        MapasCulturais.Messages.error(r.data);\n                    }else{\n                        var cb = function(){};\n                        if($this.data('remove-callback'))\n                            cb = $this.data('remove-callback');\n                        $target.remove();\n                        if(typeof cb === 'string')\n                            eval(cb);\n                        else\n                            cb();\n                    }\n                });\n            });\n\n            return false;\n        });\n    }\n}\n\nMapasCulturais.Editables = {\n\n    dataSelector: 'edit',\n    baseTarget : '',\n\n    init : function(editableEntitySelector) {\n        this.baseTarget = MapasCulturais.baseURL+$(editableEntitySelector).data('entity');\n        this.createAll();\n\n        if(MapasCulturais.isEditable){\n            this.setButton(editableEntitySelector);\n            this.initTaxonomies();\n            this.initTypes();\n\n            if(MapasCulturais.request.controller === 'registration')\n                this.initRegistrationCategories();\n\n            if(MapasCulturais.request.controller === 'space')\n                this.initSpacePublicEditable();\n        }\n    },\n\n    initSpacePublicEditable: function(){\n        $('#editable-space-status').on('hidden', function(e, reason) {\n            if($(this).editable('getValue', true) == '1'){\n                $('#editable-space-status').html('<div class=\"venue-status\"><div class=\"icon icon-publication-status-open\"></div>Publicação livre</div><p class=\"venue-status-definition\">Qualquer pessoa pode criar eventos.</p>');\n            }else{\n                $('#editable-space-status').html('<div class=\"venue-status\"><div class=\"icon icon-publication-status-locked\"></div>Publicação restrita</div><p class=\"venue-status-definition\">Requer autorização para criar eventos.</p>');\n            }\n        });\n    },\n\n    initTaxonomies: function (){\n        $('.js-editable-taxonomy').each(function(){\n            var taxonomy = $(this).data('taxonomy');\n\n            var select2_option = {\n                tags: [],\n                tokenSeparators: [\";\",\";\"],\n                separator:'; '\n            };\n\n\n            if(MapasCulturais.taxonomyTerms[taxonomy])\n                select2_option.tags = MapasCulturais.taxonomyTerms[taxonomy];\n\n            if($(this).data('restrict'))\n                select2_option.createSearchChoice = function() { return null; };\n\n\n            var config = {\n                name: 'terms[' + taxonomy + ']',\n                type: 'select2',\n                select2: select2_option\n            };\n\n            //change the default poshytip animation speed both from 300ms to:\n            $.fn.poshytip.defaults.showAniDuration = 80;\n            $.fn.poshytip.defaults.hideAniDuration = 40;\n\n            $(this).editable(config);\n        });\n    },\n\n    initRegistrationCategories: function(){\n        $('.js-editable-registrationCategory').each(function(){\n            var config = {\n                name: 'category',\n                type: 'select',\n                source: MapasCulturais.entity.registrationCategories\n            };\n            $(this).editable(config);\n        });\n    },\n\n    initTypes: function(){\n        $('.js-editable-type').each(function(){\n            var entity = $(this).data('entity');\n            $.each(MapasCulturais.entityTypes[entity], function(i, obj){\n                obj.text = obj.name;\n                obj.value = obj.id;\n            });\n            var config = {\n                name: 'type',\n                type: 'select',\n                source: MapasCulturais.entityTypes[entity]\n            };\n            $(this).editable(config);\n        });\n    },\n\n    getEditableElements : function(){\n        if(MapasCulturais.isEditable)\n            return $('.js-editable, .js-editable-taxonomy, .js-editable-type, .js-editable-registrationCategory');\n        else\n            return $('.js-xedit');\n    },\n\n    createAll : function (){\n        var entity = MapasCulturais.entity.definition;\n        MapasCulturais.Editables.getEditableElements().each(function(){\n\n            var field_name = $(this).data(MapasCulturais.Editables.dataSelector);\n\n            var input_type;\n\n            if(!entity[field_name])\n                return;\n\n            var config = {\n                name: field_name,\n                type: 'text',\n                emptytext: entity[field_name].label,\n                placeholder: entity[field_name].label\n            };\n\n            var select_value = null;\n\n            switch (entity[field_name].type){\n                case 'text':\n                    config.type = 'textarea';\n                    break;\n\n                case 'select':\n                    config.type = 'select';\n                    config.source = [];\n                    for(var k in entity[field_name].options){\n                        var obj = {value: k, text: entity[field_name].options[k]};\n\n                        config.source.push(obj);\n                    }\n\n                    break;\n\n                case 'date':\n                case 'datetime':\n                    config.type = 'date';\n                    config.format = 'yyyy-mm-dd';\n                    config.viewformat = 'dd/mm/yyyy';\n                    config.datepicker = { weekStart: 1, yearRange: $(this).data('yearrange') ? $(this).data('yearrange') : \"1900:+0\"};\n                    delete config.placeholder;\n                    config.clear = 'Limpar';\n\n                    break;\n\n                case 'boolean':\n                    config.type = 'checklist';\n                    config.source = [{value : 0, text: 'false' }, { value: 1, text: 'true' }];\n                    config.emptytext = 'Não';\n            }\n\n            if(config.type !== 'date'){\n                $(this).editable(config);\n            }\n\n            if(config.type === 'select'){\n                var $e = $(this);\n                var v = $e.html();\n                config.source.forEach(function(e){\n                    if(e.value === v){\n                        $e.editable('setValue', v);\n                    }\n                });\n            }\n\n            if($(this).data('notext')){\n                $(this).text('');\n                var that = this;\n                $(this).on('hidden', function(){\n                    $(that).text('');\n                });\n            }\n\n            if(config.type === 'date'){\n\n                var $datepicker = $(this);\n\n                if(!$(this).data('timepicker')){ //normal datepicker\n\n                    $datepicker.editable(config);\n                    $datepicker.on('hidden', function(e, editable) {\n                        if($(this).editable('getValue', true) == null){\n                            $(this).editable('setValue', '');\n                        }\n                    });\n\n                }else{ //datepicker with related timepicker field\n\n                    var $timepicker = $($datepicker.data('timepicker'));\n                    var $hidden = $('<input class=\"js-include-editable\" type=\"hidden\">').insertAfter($timepicker);\n\n                    $datepicker.attr('data-edit', $datepicker.data('edit') + '_datepicker');\n\n                    $timepicker.editable();\n                    $hidden.editable({name: $datepicker.data('edit')});\n                    $datepicker.editable(config);\n\n                    if($timepicker.data('datetime-value'))\n                        $hidden.editable('setValue', $timepicker.data('datetime-value'));\n                    else\n                        $hidden.editable('setValue', '');\n\n                    $timepicker.on('save', function(e, params) {\n\n                        if(!params.newValue){\n                            params.newValue = '23:59';\n                            $timepicker.editable('setValue', '23:59');\n                        }\n                        $hidden.editable('setValue',\n                            moment($datepicker.editable('getValue', true)).format('YYYY-M-D') + ' ' + params.newValue\n                        );\n                    });\n\n                    $datepicker.on('save', function(e, params) {\n\n                        if(params.newValue){\n                            if(!$timepicker.editable('getValue', true)){\n                                $timepicker.editable('setValue', '23:59');\n                            }\n                            $hidden.editable('setValue',\n                                moment(params.newValue).format('YYYY-M-D') + ' ' + $timepicker.editable('getValue', true)\n                            );\n                        }else{\n                            $hidden.editable('setValue', '');\n                            $timepicker.editable('setValue', '');\n                        }\n                    });\n\n                    $timepicker.on('shown', function(e, editable) {\n                        var $input = editable.input.$input;\n                        $input.mask('00:00', {\n                            onComplete: function(time) {\n\n                        }});\n                    });\n\n                }\n\n            }\n\n\n        });\n\n    },\n\n\n    setButton : function (editableEntitySelector){\n        var $submitButton = $('.js-submit-button');\n\n        //Ctrl+S:save\n        $(document.body).on('keydown', function(event){\n            if(event.ctrlKey && event.keyCode === 83){\n                event.preventDefault();\n                event.stopPropagation();\n                $submitButton.each(function(){\n                    if($(this).data('status') == MapasCulturais.entity.status){\n                        $(this).trigger('click');\n                    }\n                });\n            }\n        });\n\n        $submitButton.click(function(){\n\n            var target;\n            var $button = $(this);\n            var controller = MapasCulturais.request.controller;\n            var action = $(editableEntitySelector).data('action');\n            var $editables = MapasCulturais.Editables.getEditableElements().add('.js-include-editable');\n\n            if(action === 'create'){\n                target = MapasCulturais.createUrl(controller, 'index');\n\n            }else{\n                target = MapasCulturais.createUrl(controller, 'single', [$(editableEntitySelector).data('id')]);\n\n                if(MapasCulturais.entity.status == 0 && $button.data('status') == 1){\n                    var message = MapasCulturais.request.controller === 'event' ?\n                        'Você tem certeza que deseja publicar este ' + MapasCulturais.entity.getTypeName(MapasCulturais.request.controller) + '? ' :\n                        'Você tem certeza que deseja publicar este ' + MapasCulturais.entity.getTypeName(MapasCulturais.request.controller) + '? Isto não poderá ser desfeito.';\n\n                    if(!confirm(message)){\n                        return;\n                    }\n                }\n            }\n\n            if($submitButton.data('clicked'))\n                return false;\n\n            $submitButton.data('clicked', 'sim');\n\n\n\n            if($editables.length === 1){\n                $('body').append('<input type=\"hidden\" id=\"fixeditable\"/>');\n                $editables = $editables.add($('#fixeditable'));\n            }\n\n            $editables.editable('submit', {\n                url: target,\n                data: { status: $button.data('status') },\n                ajaxOptions: {\n                    dataType: 'json', //assuming json response\n                    type: action === 'create' ? 'post' : 'put',\n                    statusCode: {\n                        202: function(response, statusText, r) {\n                            var createdRequests = JSON.parse(r.getResponseHeader('CreatedRequests')),\n                                typeName = MapasCulturais.entity.getTypeName(),\n                                name = '';\n\n                            if(createdRequests && createdRequests.indexOf('ChildEntity') >= 0){\n                                name = $('[data-field-name=\"parentId\"]').text();\n                                $('.js-pending-parent').show();\n                                MapasCulturais.Messages.alert('Sua requisição para fazer deste '+typeName+' filho de <strong>'+name+'</strong> foi enviada.');\n                            }\n\n                            if(createdRequests && createdRequests.indexOf('EventProject') >= 0){\n                                name = $('[data-field-name=\"projectId\"]').text();\n                                $('.js-pending-project').show();\n                                MapasCulturais.Messages.alert('Sua requisição para associar este evento ao projeto <strong>'+name+'</strong> foi enviada.');\n                            }\n                        }\n                    }\n                },\n                success: function(response){\n                    $('.js-pending-project, .js-pending-parent').hide();\n                    $('.js-response-error').remove();\n                    if(response.error){\n                        var $field = null;\n                        var errors = '';\n                        var unknow_errors = [];\n                        var field_found = false;\n                        var firstShown = false;\n                        for(var p in response.data){\n                            if(MapasCulturais.request.controller === 'event' && p === 'project'){\n                                $field = $('.editable[data-field-name=\"projectId\"');\n                            }else if(p.substr(0,5) == 'term-'){\n                                $field = $('#' + p);\n                            }else if(p == 'type'){\n                                $field = $('.js-editable-type');\n                            }else if(MapasCulturais.request.controller === 'registration' && p === 'owner'){\n                                firstShown = true; // don't show editable\n                                $field = $('#registration-agent-owner').parent().find('.registration-label span');\n                            }else{\n                                $field = $('.js-editable[data-edit=\"' + p + '\"]');\n                            }\n                            for(var k in response.data[p]){\n                                if($field.length){\n                                    field_found = true;\n                                    var errorHtml = '<span title=\"' + response.data[p][k] + '\" class=\"danger hltip js-response-error\" data-hltip-classes=\"hltip-danger\"></span>';\n                                    $field.parent().append(errorHtml);\n                                }else{\n                                    unknow_errors.push(response.data[p][k]);\n                                }\n                            }\n                            if(!firstShown) {\n                                firstShown = true;\n                                $field.editable('show');\n                            }\n                            $field.on('save', function(){\n                                $(this).parent().find('.danger.hltip').remove();\n                            });\n                        }\n\n                        if(field_found)\n                            MapasCulturais.Messages.error('Corrija os erros indicados abaixo.');\n\n                        if(unknow_errors){\n                            for(var i in unknow_errors){\n                                MapasCulturais.Messages.error(unknow_errors[i]);\n                            }\n                        }\n\n                    }else{\n\n                        $('body').trigger('entity-saved', response);\n\n                        $('.js-geo-division-address').each(function(){\n                            var r = response[$(this).data('metakey')];\n                            $(this).html(r ? r : '');\n                            $(this).parent().css('display', r ? 'block' : 'none');\n                        });\n\n                        MapasCulturais.Messages.success('Edições salvas.');\n\n                        $('.editable-unsaved').\n                                css('background-color','').\n                                removeClass('editable-unsaved').\n                                parent().\n                                removeClass('danger');\n\n\n                        if(MapasCulturais.request.controller != 'registration' && (action === 'create' || response.status != MapasCulturais.entity.status)){\n                            document.location = MapasCulturais.createUrl(controller, 'edit', [response.id]);\n                        }\n                    }\n                    $submitButton.data('clicked',false);\n                },\n                error : function(response){\n                    $submitButton.data('clicked',false);\n                    if(response.status === 401)\n                        MapasCulturais.auth.require(function(){\n                            $submitButton.click();\n                        });\n                    else{\n                        MapasCulturais.Messages.error('Um erro inesperado aconteceu.');\n                    }\n                }\n            });\n        });\n\n    }\n};\n\nMapasCulturais.AjaxUploader = {\n    resetProgressBar: function(containerSelector, acivate){\n        var bar = $(containerSelector).find('.js-ajax-upload-progress .bar');\n        var percent = $(containerSelector).find('.js-ajax-upload-progress .percent');\n        var percentVal = '0%';\n        bar.stop().width(percentVal);\n        percent.html(percentVal);\n        if(!acivate)\n            $(containerSelector).find('.js-ajax-upload-progress .progress').addClass('inactive');\n        else\n            $(containerSelector).find('.js-ajax-upload-progress .progress').removeClass('inactive');\n\n    },\n    animationTime: 100,\n    init: function(selector) {\n        selector = selector || '.js-ajax-upload';\n        $(selector).each(function(){\n\n            if($(this).data('initialized'))\n                return;\n\n            $(this).show();\n            $(this).data('initialized', true);\n\n            var bar = $(this).parent().find('.js-ajax-upload-progress .bar');\n            var percent = $(this).parent().find('.js-ajax-upload-progress .percent');\n\n            MapasCulturais.AjaxUploader.resetProgressBar($(this).parent(), false);\n            var $this = $(this);\n            // bind form using 'ajaxForm'\n            $(this).ajaxForm({\n                beforeSend: function(xhr){\n                    $this.data('xhr', xhr);\n                    //@TODO validate size and type before upload\n                },\n                //target:        '#output1',   // target element(s) to be updated with server response\n                beforeSubmit: function(arr, $form, options) {\n                    MapasCulturais.AjaxUploader.resetProgressBar($form.parent(), true);\n                },\n                uploadProgress: function(event, position, total, percentComplete) {\n                    var percentVal = percentComplete + '%';\n                    bar.animate({'width':percentVal});\n                    percent.html(percentVal);\n                },\n                success: function (response, statusText, xhr, $form)  {\n\n                    var percentVal = '100%';\n                    bar.width(percentVal);\n                    percent.html(percentVal);\n\n                    if(response.error){\n                        MapasCulturais.AjaxUploader.resetProgressBar($form.parent(), false);\n                        var group = $form.data('group');\n                        var error_message = typeof response.data == 'string' ? response.data : response.data[group];\n                        $form.find('div.alert.danger').html(error_message).fadeIn(this.animationTime).delay(5000).fadeOut(this.animationTime);\n                        return;\n                    }\n\n                    var $target = $($form.data('target'));\n                    var group = $form.find('input:file').attr('name');\n\n                    var template = $form.find('script').text();\n                    if($form.data('action')){\n                        switch($form.data('action').toString()){\n                            case 'replace':\n                                var html = Mustache.render(template, response[group]);\n                                $target.replaceWith($(html));\n                            break;\n                            case 'set-content':\n\n                                var html = Mustache.render(template, response[group]);\n                                $target.html(html);\n                            break;\n                            case 'a-href':\n                                try{\n                                    $target.attr('href', response[group].url);\n                                }catch (e){}\n\n                            break;\n                            case 'image-src':\n                                try{\n                                    if($form.data('transform'))\n                                        $target.attr('src', response[group].files[$form.data('transform')].url);\n                                    else\n                                        $target.attr('src', response[group].url);\n                                }catch (e){}\n\n                            break;\n                            case 'background-image':\n                                $target.each(function(){\n                                    try{\n                                        if($form.data('transform'))\n                                            $(this).css('background-image', 'url(' + response[group].files[$form.data('transform')].url + ')');\n                                        else\n                                            $(this).css('background-image', 'url(' + response[group].url + ')');\n                                    }catch (e){}\n                                });\n                            break;\n\n                            case 'append':\n                                for(var i in response[group]){\n\n                                    if(!response[group][i].description)\n                                       response[group][i].description = response[group][i].name;\n\n                                   var html = Mustache.render(template, response[group][i]);\n                                   $target.append(html);\n                               }\n                            break;\n\n                        }\n                    }\n                    $form.trigger('ajaxForm.success', [response]);\n\n                    $form.get(0).reset();\n                    if($form.parents('.js-editbox').data('success-callback'))\n                        eval($form.parents('.js-editbox').data('success-callback'));\n\n                    $form.parents('.js-editbox').find('.mc-cancel').click();\n                },\n\n                // other available options:\n                //url:       url         // override for form's 'action' attribute\n                //type:      type        // 'get' or 'post', override for form's 'method' attribute\n                dataType:  'json'        // 'xml', 'script', or 'json' (expected server response type)\n                //clearForm: true        // clear all form fields after successful submit\n                //resetForm: true        // reset the form after successful submit\n\n                // $.ajax options can be used here too, for example:\n                //timeout:   3000\n            });\n        });\n\n\n    }\n};\n\nMapasCulturais.MetalistManager = {\n    init : function() {\n        // bind form using 'ajaxForm'\n        $('.js-metalist-form').ajaxForm({\n            //target:        '#output1',   // target element(s) to be updated with server response\n            //beforeSubmit:  showRequest,  // pre-submit callback\n\n            beforeSubmit:function(arr, $form, options){\n                //por enquanto validando apenas o vídeo contendo vimeo ou youtube e o link contendo algum protocolo...\n                var group = $form.parents('.js-editbox').data('metalist-group');\n                var $linkField = $form.find('input.js-metalist-value');\n                var $errorTag = $form.find('.alert.danger');\n                $errorTag.html('');\n\n                if(group === 'videos'){\n                    if($.trim($form.find('input.js-metalist-title').val()) === ''){\n                        $errorTag.html('Insira um título para seu vídeo.').show();\n                        return false;\n                    }\n\n                    var parsedURL = purl($linkField.val());\n                    if (parsedURL.attr('host').indexOf('youtube') === -1 && parsedURL.attr('host').indexOf('vimeo')  === -1){\n                        $errorTag.html('Insira uma url de um vídeo do YouTube ou do Vimeo.').show();\n\n                        return false;\n                    }\n                }else if (group === 'links'){\n\n                    if($.trim($form.find('input.js-metalist-title').val()) === ''){\n                        $errorTag.html('Insira um título para seu link.').show();\n                        return false;\n                    }\n\n                    var pattern = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/;\n                    if (!pattern.test($linkField.val())){\n                        $errorTag.html('A url do link é inválida, insira uma url completa como http://www.google.com/.').show();\n                        return false;\n                    }\n                }\n            },\n            success: function (response, statusText, xhr, $form)  {\n                if(response.error){\n                    return;\n                }\n\n                var $target = $($form.data('response-target'));\n                var group = $form.data('metalist-group');\n                var action = $form.data('metalist-action');\n                var template = $form.find('script.js-response-template').text();\n                var $editBtn;\n\n                var $html = $(Mustache.render(template, response));\n\n                $editBtn = $html.find('.js-open-editbox');\n                $editBtn.data('item', response);\n\n                switch(action){\n\n                    case 'edit':\n                        $target.replaceWith($html);\n                        $target = $html;\n                        MapasCulturais.EditBox.initButtons($editBtn);\n                        //if this metalist is of videos, update the new displayed item passing the video url\n                        if(group === 'videos'){\n                            MapasCulturais.Video.getAndSetVideoData(response.value, $target.find('.js-metalist-item-display'), MapasCulturais.Video.setupVideoGalleryItem);\n                        }\n                        break;\n\n                    default: //append (insert)\n                        $target.append($html);\n                        MapasCulturais.EditBox.initButtons($editBtn);\n\n                        //if this metalist is of videos, update the new displayed item passing the video url\n                        if(group === 'videos'){\n                            MapasCulturais.Video.getAndSetVideoData(response.value, $('#video-'+response.id), MapasCulturais.Video.setupVideoGalleryItem);\n\n                            $('#video-player:hidden').show();\n\n                        }\n\n                }\n                $form.parents('.js-editbox').find('.mc-cancel').click();\n                //$form.get(0).reset();\n            },\n\n            // other available options:\n            //url:       url         // override for form's 'action' attribute\n            //type:      type        // 'get' or 'post', override for form's 'method' attribute\n            dataType:  'json'        // 'xml', 'script', or 'json' (expected server response type)\n            //clearForm: true        // clear all form fields after successful submit\n            //resetForm: true        // reset the form after successful submit\n\n            // $.ajax options can be used here too, for example:\n            //timeout:   3000\n        });\n\n        // Delete Button\n        $('.js-metalist-form .js-metalist-item-delete').on('click', function(){\n            if(confirm('Tem Certeza de que deseja excluir este item?')){\n                $form = $(this).parent();\n                $form.find('input:hidden[name=\"metalist_action\"]').val('delete');\n                $form.find('input:submit').click();\n                $form.parent().hide();\n            }\n        });\n    },\n\n    updateDialog: function ($caller){\n        var $dialog = $($caller.data('target'));\n        var $form = $dialog.find('.js-metalist-form');\n        var group = $dialog.data('metalist-group');\n\n        var item = $caller.data('item') || {};\n\n        if(typeof item === 'string')\n            item = JSON.parse(item);\n\n        $form.data('metalist-action', $caller.data('metalist-action'));\n        $form.data('metalist-group', group);\n\n        if($caller.data('metalist-action') === 'edit'){\n            if(group === 'videos')\n                $dialog.removeClass('mc-top').addClass('mc-bottom');\n\n            $form.find('input.js-metalist-group').attr('name', '').val('');\n            $form.attr('action', MapasCulturais.baseURL + 'metalist/single/' + item.id);\n        }else{\n            if(group === 'videos')\n                $dialog.removeClass('mc-bottom').addClass('mc-top');\n            $form.find('input.js-metalist-group').attr('name', 'group').val(group);\n            $form.attr('action', $dialog.data('action-url'));\n        }\n\n        $form.data('response-target', $caller.data('response-target'));\n\n        // define os labels do form\n        $form.find('input.js-metalist-title').attr('placeholder', $dialog.data('metalist-title-label'));\n        $form.find('input.js-metalist-value').attr('placeholder', $dialog.data('metalist-value-label'));\n\n        // define os valores dos inputs do form\n\n        $form.find('input.js-metalist-title').val(item.title);\n        $form.find('input.js-metalist-value').val(item.value);\n\n\n\n        var responseTemplate = '';\n        //If Edit or insert:\n        if($caller.data('metalist-action') === 'edit'){\n            responseTemplate = $dialog.data('response-template');\n        }else{\n            $dialog.find('h2').html($caller.data('dialog-title'));\n            responseTemplate = $caller.data('response-template');\n        }\n\n        $form.find('script.js-response-template').text(responseTemplate);\n\n        //if this metalist is of videos,changing a video url results in getting its title from its provider's api and set it to its title field\n        if(group === 'videos') {\n            $form.find('input.js-metalist-value').on('change', function(){\n                MapasCulturais.Video.getAndSetVideoData($(this).val(), $form.find('input.js-metalist-title'), MapasCulturais.Video.setTitle);\n            });\n        }\n    }\n};\n\n\n$(function(){\n    function concatena_enderco(){\n        var nome_logradouro = $('#En_Nome_Logradouro').editable('getValue', true);\n        var cep = $('#En_CEP').editable('getValue', true);\n        var numero = $('#En_Num').editable('getValue', true);\n        var complemento = $('#En_Complemento').editable('getValue', true);\n        var bairro = $('#En_Bairro').editable('getValue', true);\n        var municipio = $('#En_Municipio').editable('getValue', true);\n        var estado = $('#En_Estado').editable('getValue', true);\n        if(cep && nome_logradouro && numero && bairro && municipio && estado){\n            var endereco =  nome_logradouro + \", \" + numero + (complemento ? \", \" + complemento : \" \") + \", \" + bairro + \", \" + cep  + \", \" + municipio + \", \" + estado;\n            $('#endereco').editable('setValue', endereco);\n            $('#endereco').trigger('changeAddress', endereco);\n            $('.js-endereco').html(endereco);\n        }\n\n\n    };\n\n    $('#En_Nome_Logradouro, #En_CEP, #En_Num, #En_Complemento, #En_Bairro, #En_Municipio,  #En_Estado').on('hidden', function(e, params) {\n        concatena_enderco();\n    });\n\n    $('#En_CEP').on('hidden', function(e, params){\n        var cep = $('#En_CEP').editable('getValue', true);\n        cep = cep.replace('-','');\n        $.getJSON('http://cep.correiocontrol.com.br/'+cep+'.json',function(r){\n            $('#En_Nome_Logradouro').editable('setValue', r.logradouro);\n            $('#En_Bairro').editable('setValue', r.bairro);\n            $('#En_Municipio').editable('setValue', r.localidade);\n            $('#En_Estado').editable('setValue', r.uf);\n            concatena_enderco();\n        });\n\n    });\n});","$(function(){\n    MapasCulturais.EventOccurrenceManager.initMapTogglers('.toggle-mapa');\n});\n\nMapasCulturais.eventOccurrenceUpdateDialog = function ($caller){\n    var $dialog = $($caller.data('dialog'));\n    $dialog.find('h2').html($caller.data('dialog-title'));\n    var template = MapasCulturais.TemplateManager.getTemplate('event-occurrence-form');\n    var item = $caller.data('item') || {};\n\n    if($caller.data('form-action') == 'edit'){\n        item.formAction = item.editUrl;\n        item.rule['freq_'+item.rule.frequency] = true;\n        item.rule['monthly_'+item.rule.monthly] = true;\n\n    }else{\n        item.formAction = MapasCulturais.baseURL + 'eventOccurrence/create';\n    }\n    $dialog.find('.js-dialog-content').html(Mustache.render(template, item));\n\n    MapasCulturais.EventOccurrenceManager.init($dialog.find('form'));\n    MapasCulturais.EventHumanReadableManager.init($dialog.find('form'));\n\n\n    $dialog.find('form').data('action', $caller.data('form-action'));\n\n    MapasCulturais.Search.init('.js-search-occurrence-space');\n\n    MapasCulturais.EventDates.init('.js-event-dates');\n\n    var $startsAt = $dialog.find('form').find('.js-event-time');\n    var $duration = $dialog.find('form').find('.js-event-duration');\n    var $endsAt = $dialog.find('form').find('.js-event-end-time');\n\n    $startsAt.mask('00:00', {\n      onComplete: function(time) {\n        var mtime = moment(time, 'HH:mm');\n        var duration = $duration.val();\n\n        if(mtime.isValid() && $.isNumeric(duration)) {\n            $endsAt.val(mtime.add(duration, 'minutes').format('HH:mm'));\n        }\n      }});\n\n    $duration.mask('99999999')\n    $duration.change(function(event) {\n        var mtime = moment($startsAt.val(), 'HH:mm');\n        var duration = $(this).val();\n\n        if(mtime.isValid() && $.isNumeric(duration)) {\n            $endsAt.val(mtime.add(duration, 'minutes').format('HH:mm'));\n        }\n    });\n\n    $endsAt.mask('00:00', {\n      onComplete: function(time) {\n        var mendtime = moment(time, 'HH:mm');\n        var mtime = moment($startsAt.val(), 'HH:mm');\n\n        if(mtime.isValid() && mendtime.isValid()) {\n            $duration.val(Math.abs(mendtime.diff(mtime, 'minutes')));\n        }\n      }});\n};\n\n\nMapasCulturais.EventOccurrenceManager = {\n    localeDateOptions : {\n        locale : 'pt-BR',\n        dateOptions : {\n            //weekday: 'long',\n            day: '2-digit', month:'2-digit', year:'numeric'\n        }\n    },\n    formatDate : function (value){\n        if(!value)\n            return '';\n        else\n            return new Date(value + ' 12:00:00 GMT')\n                .toLocaleDateString(this.localeDateOptions.locale, this.localeDateOptions.dateOptions);\n    },\n    init : function(selector) {\n        $(selector).ajaxForm({\n            success: function (response, statusText, xhr, $form)  {\n\n                $form.find('.danger').not('.alert').remove();\n                if(response.error){\n                    var $element = null,\n                        message;\n                    for(i in response.data) {\n                        message = response.data[i].join(', ').toLowerCase();\n\n                        if(i == 'space') $element = $form.find('.js-space');\n                        else $element = $form.find('[name=\"'+i+'\"]').parents('.grupo-de-campos').find('label');\n                        $element.append('<span class=\"danger hltip\" data-hltip-classes=\"hltip-danger\" title=\"Erro:'+message+'\"/>');\n                        //$form.find('[name=\"'+i+'\"]')\n                    }\n                    $form.parent().scrollTop(0);\n                    $form.find('div.alert.danger').html('Corrija os erros indicados abaixo.')\n                        .fadeIn(MapasCulturais.Messages.fadeOutSpeed)\n                        .delay(MapasCulturais.Messages.delayToFadeOut)\n                        .fadeOut(MapasCulturais.Messages.fadeOutSpeed);\n\n                    return;\n\n                }\n\n                response.pending = xhr.status === 202;\n\n                var isEditing = $form.data('action') == 'edit';\n                var template = MapasCulturais.TemplateManager.getTemplate('event-occurrence-item');\n\n                response.rule.screen_startsOn = MapasCulturais.EventOccurrenceManager.formatDate(response.rule.startsOn);\n                response.rule.screen_until = MapasCulturais.EventOccurrenceManager.formatDate(response.rule.until);\n                response.rule.screen_frequency = MapasCulturais.frequencies[response.rule.frequency];\n\n                var $renderedData = $(Mustache.render(template, response));\n                var $editBtn = $renderedData.find('.js-open-dialog');\n                $editBtn.data('item', response);\n                if(isEditing){\n                    $('#event-occurrence-'+response.id).replaceWith($renderedData);\n                }else{\n                    $('.js-event-occurrence').append($renderedData);\n                }\n                MapasCulturais.Modal.initButtons($editBtn);\n                $form.parents('.js-dialog').find('.js-close').click();\n\n                //Por enquanto sempre inicializa o mapa\n                //console.log('#occurrence-map-'+response.id, $('#occurrence-map-'+response.id), $('#occurrence-map-'+response.id).find('.toggle-mapa'));\n                MapasCulturais.Map.initialize({mapSelector:'#occurrence-map-'+response.id,locateMeControl:false});\n                MapasCulturais.EventOccurrenceManager.initMapTogglers($('#event-occurrence-'+response.id).find('.toggle-mapa'));\n\n\n                if(xhr.status === 202){\n                    MapasCulturais.Messages.alert('Sua requisição para criar a ocorrência do evento no espaço <strong>' + response.space.name + '</strong> foi enviada.');\n                }\n\n            },\n            error: function(xhr, textStatus, errorThrown, $form) {\n                $form.parent().scrollTop(0);\n\n                if(xhr.status === 403){\n                    $form.find('div.alert.danger').html('Você não tem permissão para criar eventos nesse espaço.')\n                        .fadeIn(MapasCulturais.Messages.fadeOutSpeed)\n                        .delay(MapasCulturais.Messages.delayToFadeOut)\n                        .fadeOut(MapasCulturais.Messages.fadeOutSpeed);\n                }else{\n                    $form.find('div.alert.danger').html('Erro inesperado.')\n                        .fadeIn(MapasCulturais.Messages.fadeOutSpeed)\n                        .delay(MapasCulturais.Messages.delayToFadeOut)\n                        .fadeOut(MapasCulturais.Messages.fadeOutSpeed);\n                }\n            },\n            dataType:  'json',\n            beforeSubmit: function(arr, $form, options) {\n\n                if ($form.find('input[name=\"description\"]').data('synced') != 1)\n                    return confirm('As datas foram alteradas mas a descrição não. Tem certeza que deseja salvar?');\n\n                return true;\n\n            }\n        });\n\n        $(selector).find('.js-select-frequency').change(function(){\n            $(selector).find('.js-freq-hide').not('.js-' + $(this).val())\n                .hide()\n                .find('input').not('[type=checkbox]').val('');\n            $(selector).find('.js-freq-hide.js-' + $(this).val()).show();\n            $(selector).find('.js-freq-hide').not('.js-' + $(this).val()).find('input[type=checkbox]').attr('checked', false);\n        });\n        $(selector).find('.js-select-frequency').change();\n    },\n    initMapTogglers : function(selector){\n        $(selector).click(function() {\n            var $map = $(this).closest('.regra').find('.mapa');\n            MapasCulturais.reenableScrollWheelZoom = false;\n            if($map.is(':visible')){\n                $map.slideUp('fast');\n                $(this).parent().find('.ver-mapa').show();\n                $(this).parent().find('.ocultar-mapa').hide();\n\n            }else{\n                $map.slideDown('fast', function(){\n                    $map.data('leaflet-map').invalidateSize();\n                    $map.data('leaflet-map').scrollWheelZoom.disable();\n                });\n                $(this).parent().find('.ver-mapa').hide();\n                $(this).parent().find('.ocultar-mapa').show();\n            }\n\n            return false;\n        });\n    }\n};\n\nMapasCulturais.EventDates = {\n    init : function (selector) {\n        $(selector).each(function(){\n            var fieldSelector = '#'+$(this).attr('id');\n            var altFieldSelector = $(this).data('alt-field') ? $(this).data('alt-field') : fieldSelector.replace('-visible', '');\n            if($(altFieldSelector).length == 0){\n                return;\n            }\n            $(this).datepicker({\n                dateFormat: $(this).data('date-format') ? $(this).data('date-format') : 'dd/mm/yy',\n                altFormat: $(this).data('alt-format') ? $(this).data('alt-format') : 'yy-mm-dd',\n                altField: altFieldSelector\n            });\n        });\n    }\n};\n\nMapasCulturais.EventHumanReadableManager = {\n\n    init : function(selector) {\n\n        var $form = $(selector);\n\n        // Add onChange events to the fields\n        $(selector).find('input[type=\"checkbox\"], select[name=\"frequency\"], #horario-de-inicio, .js-start-date, .js-end-date').change(function() {\n            MapasCulturais.EventHumanReadableManager.updateSuggestion($form);\n        });\n\n        // If there are values, run it at init\n        var date_s = $(selector).find('.js-start-date').val();\n        var hour = $(selector).find('#horario-de-inicio').val();\n        if (date_s && hour)\n            MapasCulturais.EventHumanReadableManager.updateSuggestion($form);\n\n        $(selector).find('.grupo-descricao-automatica > a').click(function() {\n            $(selector).find('input[name=\"description\"]').val( $(selector).find('#descricao-automatica').html() ).data('synced', 1);\n        });\n\n        //On init, we assume we are allways synced, even if the values are different, because the could have been manually edited\n        $(selector).find('input[name=\"description\"]').data('synced', 1);\n    },\n    updateSuggestion: function(selector) {\n        var human = MapasCulturais.EventHumanReadableManager.getSuggestion(selector);\n        $(selector).find('#descricao-automatica').html(human);\n        if (human == $(selector).find('input[name=\"description\"]').val())\n            $(selector).find('input[name=\"description\"]').data('synced', 1);\n        else\n            $(selector).find('input[name=\"description\"]').data('synced', 0);\n    },\n    getSuggestion: function(selector) {\n\n        var human = '';\n\n        var date_s = $(selector).find('.js-start-date').val();\n        var hour = $(selector).find('#horario-de-inicio').val();\n        var frequency = $(selector).find('select[name=\"frequency\"]').val();\n        var date_e = $(selector).find('.js-end-date').val();\n        var weekDays = [];\n        $(selector).find('input[type=\"checkbox\"]:checked').each(function() { if ($(this).is(':checked')) weekDays.push($(this).attr('name').replace(/[^\\d]/g, '')) });\n\n        //console.log( date_s);\n        //console.log( hour);\n        //console.log( frequency);\n        //console.log( date_e);\n        //console.log( weekDays);\n\n        var mdate_s = false;\n        var mdate_e = false;\n\n        if (date_s) mdate_s = moment(date_s, 'DD/MM/YYYY');\n        if (date_e) mdate_e = moment(date_e, 'DD/MM/YYYY');\n\n        if (frequency == 'once') {\n            if (!mdate_s) return '...';\n            human += 'Dia ' + mdate_s.format('D [de] MMMM [de] YYYY');\n        } else {\n\n            if (!mdate_s || !mdate_e) return '...';\n\n            if (frequency == 'daily') {\n                human += 'Diariamente';\n            } else if (frequency == 'weekly') {\n\n\n                if (weekDays.length > 0) {\n\n                    if (weekDays[0] == '0' || weekDays[0] == '6') {\n                        human += 'Todo ';\n                    } else {\n                        human += 'Toda ';\n                    }\n\n                    var count = 1;\n                    $.each(weekDays, function(i, v) {\n                        var wformat = weekDays.length > 1 ? 'ddd' : 'dddd';\n                        human += moment().day(v).format(wformat);\n                        count ++;\n                        if (count == weekDays.length)\n                            human += ' e ';\n                        else if (count < weekDays.length)\n                            human += ', '\n                    });\n                }\n            }\n\n            if (mdate_s.year() != mdate_e.year()) {\n                human += ' de ' + mdate_s.format('D [de] MMMM [de] YYYY') + ' a ' + mdate_e.format('D [de] MMMM [de] YYYY');\n            } else {\n                if (mdate_s.month() != mdate_e.month()) {\n                    human += ' de ' + mdate_s.format('D [de] MMMM') + ' a ' + mdate_e.format('D [de] MMMM [de] YYYY');\n                } else {\n                    human += ' de ' + mdate_s.format('D') + ' a ' + mdate_e.format('D [de] MMMM [de] YYYY');\n                }\n            }\n\n\n        }\n\n        if (hour) {\n            if (hour.substring(0,2) == '01')\n                human += ' à ' + hour;\n            else\n                human += ' às ' + hour;\n        }\n\n        return human;\n\n    }\n};\n","(function (angular) {\n    \"use strict\";\n    angular.module('mc.directive.multiselect', [])\n        .directive('multiselect', function () {\n            return {\n                restrict: 'E',\n                templateUrl: MapasCulturais.templateUrl.multiselect,\n                scope: {\n                    'allowOther': '@',\n                    'allowOtherText': '@',\n                    'terms': '=',\n                    'values': '='\n                },\n                link: function ($scope, element, attribute) {\n                    \n                    $scope.cfg = {\n                        show: false,\n                        allowOtherText: $scope.allowOtherText,\n                        outros: ''\n                    };\n                    \n                    function sanitize(term) {\n                        return term;\n                    }\n                    \n                    var terms = $scope.terms.map(function (term) {\n                        return sanitize(term);\n                    });\n\n\n                    // define a variavel de escopo \"outros\", model do input outros\n                    function setOutros(virgula) {\n                        var _outros = [];\n                        $scope.values.forEach(function (term) {\n                            var has = true;\n                            terms.forEach(function(t){\n                                if(t.value === term){\n                                    has = false;\n                                }\n                            });\n                            if (has) {\n                                _outros.push(term);\n                            }\n                        });\n\n                        $scope.cfg.outros = _outros.join('; ');\n\n                        if (virgula && $scope.cfg.outros.trim().length > 0) {\n                            $scope.cfg.outros += ';';\n                        }\n                    }\n\n\n                    // verifica se um checkbox deve estar checkado ou não\n                    $scope.checked = function (term) {\n                        term = sanitize(term);\n                        return $scope.values.indexOf(term) >= 0;\n                    };\n\n                    // função chamada no click do checkbox\n                    $scope.toggleTerm = function (term) {\n                        term = sanitize(term);\n\n                        if (!angular.isArray($scope.values)) {\n                            $scope.values = [term];\n                        } else {\n                            var idx = $scope.values.indexOf(term);\n\n                            if (idx < 0) {\n                                $scope.values.push(term);\n                            } else {\n                                $scope.values.splice(idx, 1);\n                            }\n                        }\n                    };\n\n                    // função chamada pelo input text \"outros\"\n                    $scope.update = function (e) {\n                        if (!e || e && e.keyCode === 191 && !e.shiftKey) {\n                            var _outros = $scope.cfg.outros.split(';').map(function (term) {\n                                return term.trim();\n                            });\n\n\n                            _outros.forEach(function (term, i) {\n                                term = _outros[i] = term.trim();\n\n                                if (term.length && $scope.values.indexOf(term) === -1) {\n                                    $scope.values.push(term);\n                                }\n                            });\n                            $scope.values.forEach(function (term, i) {\n                                if (terms.indexOf(term) === -1 && _outros.indexOf(term) === -1) {\n                                    $scope.values.splice(i, 1);\n                                }\n                            });\n                            setOutros(e && e.keyCode === 191);\n                        }\n                    };\n                    \n                    \n                    setOutros();\n                    $scope.cfg.show = $scope.cfg.outros.length > 0;\n                }\n            };\n        });\n})(angular);","(function (angular) {\n    \"use strict\";\n    angular.module('mc.directive.singleselect', [])\n        .directive('singleselect', function () {\n            return {\n                restrict: 'E',\n                templateUrl: MapasCulturais.templateUrl.singleselect,\n                scope: {\n                    'name': '@',\n                    'value': '=',\n                    'terms': '=',\n                    'allowOther': '@',\n                    'allowOtherText': '@',\n                },\n                link: function ($scope, element, attribute) {\n                    function sanitize(term){\n                        if(!term){\n                            term = '';\n                        }\n                        return term.trim();\n                    }\n\n                    $scope.data = {\n                        name: $scope.name,\n                        value: $scope.value,\n                        terms: $scope.terms,\n                        allowOther: $scope.allowOther,\n                        allowOtherText: $scope.allowOtherText\n                    };\n\n                    $scope.clickOther = function(){\n                        if(sanitize($scope.data.value) === '' || $scope.terms[sanitize($scope.data.value)]){\n                            $scope.data.value = '';\n                            $scope.data.showOther = true;\n                        }\n                    };\n\n                    if($scope.data.value && !$scope.terms[sanitize($scope.data.value)]){\n                        $scope.data.showOther = true;\n                    }\n\n                    $scope.notOther = function(){\n                        $scope.data.showOther = false;\n                    };\n\n                    $scope.$watch('data.value', function(a,b){ \n                        $scope.value = $scope.data.value;\n                    });\n                }\n            };\n        });\n})(angular);","(function (angular) {\n    \"use strict\";\n\n    angular.module('mc.directive.editBox', [])\n        .factory('EditBox', function () {\n            function setPosition($box, target) {\n                if ($box.hasClass('mc-left')) {\n                    $box.position({\n                        my: 'right-20 center',\n                        at: 'left center',\n                        of: target\n                    });\n\n                } else if ($box.hasClass('mc-right')) {\n                    $box.position({\n                        my: 'left+20 center',\n                        at: 'right center',\n                        of: target\n                    });\n\n                } else if ($box.hasClass('mc-top')) {\n                    $box.position({\n                        my: 'center bottom-20',\n                        at: 'center top',\n                        of: target\n                    });\n\n                } else if ($box.hasClass('mc-bottom')) {\n                    $box.position({\n                        my: 'center top+20',\n                        at: 'center bottom',\n                        of: target\n                    });\n                }\n            }\n            ;\n\n\n            var editBox = {\n                openEditboxes: {},\n                register: function (editboxId) {\n                    if (this.openEditboxes[editboxId] && document.getElementById(editboxId))\n                        throw new Error('EditBox with id ' + editboxId + ' already exists');\n\n                    this.openEditboxes[editboxId] = false;\n\n                    var $box = jQuery('#' + editboxId);\n                    var $submitInput = $box.find('input:text');\n                    $submitInput.on('keyup', function (event) {\n                        if (event.keyCode === 13) {\n                            $box.find('button[type=\"submit\"]').click();\n                        }\n                    });\n                },\n                open: function (editboxId, $event) {\n                    if (typeof this.openEditboxes[editboxId] === 'undefined')\n                        throw new Error('EditBox with id ' + editboxId + ' does not exists');\n\n                    // close all\n                    for (var id in this.openEditboxes) {\n                        this.close(id);\n                    }\n\n                    this.openEditboxes[editboxId] = true;\n\n                    var $box = jQuery('#' + editboxId).find('>div.edit-box');\n                    $box.show();\n\n                    jQuery('#' + editboxId).trigger('open');\n\n                    var $firstInput = $($box.find('input,select,textarea').get(0));\n                    $firstInput.focus();\n\n\n                    setTimeout(function () {\n                        setPosition($box, $event.target);\n                    });\n                },\n                close: function (editboxId) {\n                    if (typeof this.openEditboxes[editboxId] === 'undefined')\n                        throw new Error('EditBox with id ' + editboxId + ' does not exists');\n\n                    this.openEditboxes[editboxId] = false;\n\n                    var $box = jQuery('#' + editboxId).find('>div.edit-box');\n                    $box.hide();\n\n                    jQuery('#' + editboxId).trigger('close');\n                }\n            };\n\n            jQuery('body').on('keyup', 'edit-box', function (event) {\n                if (event.keyCode === 27) {\n                    editBox.close(this.id);\n                }\n            });\n\n            return editBox;\n        })\n\n\n        .directive('editBox', ['EditBox', function (EditBox) {\n                return {\n                    restrict: 'E',\n                    templateUrl: MapasCulturais.templateUrl.editBox,\n                    transclude: true,\n                    scope: {\n                        spinnerCondition: '=',\n                        onOpen: '=',\n                        onSubmit: '=',\n                        onCancel: '='\n                    },\n                    link: function ($scope, el, attrs) {\n                        if (!attrs.id)\n                            throw new Error('EditBox id is required');\n\n                        $scope.editbox = EditBox;\n                        $scope.cancelLabel = attrs.cancelLabel;\n\n                        EditBox.register(attrs.id);\n\n                        $scope.args = attrs;\n\n                        $scope.spinnerUrl = MapasCulturais.spinnerUrl;\n\n                        $scope.classes = {\n                            'mc-bottom': attrs.position === 'bottom' || !attrs.position,\n                            'mc-top': attrs.position === 'top',\n                            'mc-left': attrs.position === 'left',\n                            'mc-right': attrs.position === 'right'\n                        };\n\n                        $scope.submit = function () {\n                            if (angular.isFunction($scope.onSubmit)) {\n                                $scope.onSubmit(attrs);\n                            }\n                        };\n\n                        $scope.cancel = function () {\n                            if (attrs.closeOnCancel)\n                                EditBox.close(attrs.id);\n\n                            if (angular.isFunction($scope.onCancel)) {\n                                $scope.onCancel(attrs);\n                            }\n                            jQuery('#' + attrs.id).trigger('cancel');\n                        };\n\n                        if (angular.isFunction($scope.onOpen)) {\n                            jQuery('#' + attrs.id).on('open', function () {\n                                $scope.onOpen();\n                            });\n                        }\n                    }\n                };\n            }]);\n})(angular);","(function (angular) {\n    \"use strict\";\n\n    angular.module('mc.directive.mcSelect', [])\n        .directive('mcSelect', [function () {\n                return {\n                    restrict: 'E',\n                    templateUrl: MapasCulturais.templateUrl.MCSelect,\n                    transclude: true,\n                    scope: {\n                        data: '=',\n                        model: '=',\n                        placeholder: '@',\n                        setter: '=',\n                        getter: '='\n                    },\n                    link: function ($scope, el, attrs) {\n                        $scope.classes = attrs.classes;\n\n                        $scope.selectItem = function (item, $event) {\n                            if (angular.isFunction($scope.setter)) {\n                                $scope.setter($scope.model, item);\n                            } else {\n                                $scope.model = item.value;\n                            }\n                        },\n                            $scope.getSelectedValue = function () {\n                                if ($scope.model && angular.isFunction($scope.getter)) {\n                                    return $scope.getter($scope.model);\n                                } else {\n                                    return $scope.model;\n                                }\n                            };\n\n                        $scope.getSelectedItem = function () {\n                            var item = null,\n                                selectedValue = $scope.getSelectedValue();\n\n                            $scope.data.forEach(function (e) {\n                                if (e.value == selectedValue)\n                                    item = e;\n                            });\n                            return item;\n                        };\n\n                        $scope.getSelectedLabel = function () {\n                            var item = $scope.getSelectedItem();\n\n                            if (item) {\n                                return item.label;\n                            } else {\n                                return $scope.placeholder;\n                            }\n                        };\n\n                        $scope.isSelected = function (item) {\n                            return item.value == $scope.getSelectedValue();\n                        }\n                    }\n                };\n            }]);\n})(angular);","(function (angular) {\n    \"use strict\";\n\n    angular.module('mc.module.findEntity', [])\n        .factory('FindService', ['$rootScope', '$http', '$q', function ($rootScope, $http, $q) {\n                var baseUrl = MapasCulturais.baseURL + '/api/';\n                var canceller;\n\n                function extend(query) {\n                    return angular.extend(query, {\n                        \"@select\": 'id,name,type,shortDescription,terms',\n                        \"@files\": '(avatar.avatarSmall):url',\n                        \"@order\": 'name'\n                    });\n                }\n                ;\n\n                function request(url, query, success_cb, error_cb) {\n                    cancelRequest();\n\n                    query = extend(query);\n\n\n                    canceller = $q.defer();\n\n                    var p = $http({\n                        url: url,\n                        method: \"GET\",\n                        timeout: canceller.promise,\n                        cache: true,\n                        params: query\n                    });\n\n                    if (angular.isFunction(success_cb)) {\n                        p.success(success_cb);\n                    }\n\n                    if (angular.isFunction(error_cb)) {\n                        p.error(error_cb);\n                    }\n                }\n                ;\n\n                function cancelRequest() {\n                    if (canceller) {\n                        canceller.resolve();\n                    }\n                }\n\n                return {\n                    cancel: function () {\n                        cancelRequest();\n                    },\n                    find: function (entity, query, success_cb, error_cb) {\n                        var url = baseUrl + entity + '/find';\n\n                        request(url, query, success_cb, error_cb);\n                    },\n                    findOne: function (entity, query, success_cb, error_cb) {\n                        var url = baseUrl + entity + '/find';\n\n                        request(url, query, success_cb, error_cb);\n                    },\n                    pagination: function (entity, resultsPerPage, query, success_cb, error_cb) {\n                        var url = baseUrl + entity + '/find',\n                            page = 0, executing = false;\n\n                        var pagination = this;\n\n                        function success() {\n                            success_cb.call(pagination, arguments);\n                            executing = false;\n                        }\n\n                        function error() {\n                            error_cb.call(pagination, arguments);\n                            executing = false;\n                        }\n\n                        return {\n                            reset: function () {\n                                page = 0;\n                            },\n                            nextPage: function () {\n                                if (!executing) {\n                                    executing = true;\n\n                                    page++;\n\n                                    query['@page'] = page;\n                                    query['@limit'] = resultsPerPage;\n\n                                    request(url, query, success, error);\n                                }\n                            },\n                            currentPage: function () {\n                                if (this._page > 0 && !executing) {\n                                    executing = true;\n\n                                    query['@page'] = page;\n                                    query['@limit'] = resultsPerPage;\n\n                                    request(url, query, success, error);\n                                }\n                            },\n                            previousPage: function () {\n                                if (this._page > 0 && !executing) {\n                                    executing = true;\n\n                                    page--;\n\n                                    query['@page'] = page;\n                                    query['@limit'] = resultsPerPage;\n\n                                    request(url, query, success, error);\n                                }\n                            }\n                        };\n                    }\n                };\n            }])\n\n\n        .directive('findEntity', ['$timeout', 'FindService', function ($timeout, FindService) {\n                var timeouts = {};\n\n                return {\n                    restrict: 'E',\n                    templateUrl: MapasCulturais.templateUrl.findEntity,\n                    scope: {\n                        spinnerCondition: '=',\n                        entity: '@',\n                        noResultsText: '@',\n                        filter: '=',\n                        select: '=',\n                        onRepeatDone: '=',\n                        apiQuery: '='\n                    },\n                    link: function ($scope, el, attrs) {\n                        $scope.attrs = attrs;\n\n                        $scope.result = [];\n\n                        $scope.searchText = '';\n\n                        $scope.noEntityFound = false;\n\n                        $scope.noMoreResults = false;\n\n                        // pagination at the end of container scroll\n                        var $el = jQuery(el[0]);\n                        var $container = $el.find('.result-container');\n\n                        $container.scroll(function () {\n                            var containerInnerHeight = this.scrollHeight;\n                            var containerScroll = jQuery(this).scrollTop();\n                            var containerHeight = jQuery(this).height();\n                            var bottomY = containerInnerHeight - containerHeight - containerScroll;\n                            if (bottomY < containerHeight && !$scope.noMoreResults && !$scope.paginating) {\n                                $scope.paginating = true;\n                                $scope.find(10);\n                            }\n                        }).bind('mousewheel DOMMouseScroll', function (e) {\n                            var e0 = e.originalEvent,\n                                delta = e0.wheelDelta || -e0.detail;\n\n                            this.scrollTop += (delta < 0 ? 1 : -1) * 30;\n                            e.preventDefault();\n                        });\n\n                        $scope.avatarUrl = function (entity) {\n                            if (entity['@files:avatar.avatarSmall'])\n                                return entity['@files:avatar.avatarSmall'].url;\n                            else\n                                return MapasCulturais.defaultAvatarURL;\n                        };\n\n                        $scope.find = function (time) {\n                            if (timeouts.find)\n                                $timeout.cancel(timeouts.find);\n\n                            time = time || 1000;\n\n                            FindService.cancel();\n\n                            var s = $scope.searchText.trim().replace(' ', '*');\n\n                            if (parseInt(s) != s && s.length < 2) {\n                                return;\n                            }\n\n                            var query = angular.isObject($scope.apiQuery) ? $scope.apiQuery : {};\n\n                            if ($scope.lastS != s) {\n                                $scope.lastS = s;\n                                $scope.result = [];\n                                $scope.noMoreResults = false;\n                                $scope.pagination = FindService.pagination($scope.entity, 20, query, function (data, status) {\n                                    $scope.processResult(data, status);\n                                    $scope.spinnerCondition = false;\n                                    $scope.paginating = false;\n                                });\n                            }\n\n\n                            query.name = 'ILIKE(*' + s + '*)';\n                            timeouts.find = $timeout(function () {\n                                $scope.spinnerCondition = true;\n                                $scope.pagination.nextPage();\n                            }, time);\n                        };\n\n                        $scope.processResult = function (data, status) {\n                            data = data[0];\n                            if (angular.isFunction($scope.filter))\n                                data = $scope.filter(data, status);\n\n                            if (data.length > 0) {\n                                $scope.result = $scope.result.concat(data);\n                            } else if ($scope.result.length === 0) {\n                                $scope.noEntityFound = true;\n\n                                $timeout(function () {\n                                    $scope.noEntityFound = false;\n                                }, 3000);\n                            } else {\n                                // final dos resultados\n                                $scope.noMoreResults = true;\n                            }\n\n                        };\n\n                        jQuery(el).on('find', function () {\n                            $scope.find();\n                        });\n                    }\n                };\n            }]);\n})(angular);","(function(angular){\n    \"use strict\";\n    \n    var module = angular.module('entity.module.relatedAgents', ['ngSanitize']);\n\n    module.config(['$httpProvider',function($httpProvider){\n        $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';\n        $httpProvider.defaults.transformRequest = function(data) {\n            var result = angular.isObject(data) && String(data) !== '[object File]' ? $.param(data) : data;\n            \n            return result;\n        };\n    }]);\n    \n    module.factory('RelatedAgentsService', ['$http', '$rootScope', function($http, $rootScope){\n        var controllerId = null, \n            entityId = null,\n            baseUrl = MapasCulturais.baseURL.substr(-1) === '/' ?  MapasCulturais.baseURL : MapasCulturais.baseURL + '/';\n    \n        try{ controllerId = MapasCulturais.request.controller; }catch (e){};\n        try{ entityId = MapasCulturais.entity.id; }catch (e){};\n        \n        return {\n            controllerId: controllerId,\n            \n            entityId: entityId,\n            \n            getUrl: function(action){\n                return baseUrl + controllerId + '/' + action + '/' + entityId;\n            },\n            \n            create: function(group, agentId){\n                return $http.post(this.getUrl('createAgentRelation'), {group: group, agentId: agentId}).\n                        success(function(data, status){\n                            if(status === 202){\n                                MapasCulturais.Messages.alert('Sua requisição para relacionar o agente <strong>' + data.agent.name + '</strong> foi enviada.');\n                            }\n                            $rootScope.$emit('relatedAgent.created', data);\n                        }).\n                        error(function(data, status){\n                            $rootScope.$emit('error', { message: \"Cannot create related agent\", data: data, status: status });\n                        });\n            },\n            \n            remove: function(group, agentId){\n                return $http.post(this.getUrl('removeAgentRelation'), {group: group, agentId: agentId}).\n                    success(function(data, status){\n                        $rootScope.$emit('relatedAgent.removed', data);\n                    }).\n                    error(function(data, status){\n                        $rootScope.$emit('error', { message: \"Cannot remove related agent\", data: data, status: status });\n                    }); \n            },\n            \n            giveControl: function(agentId){\n                return this.setControl(agentId, true);\n            },\n            \n            removeControl: function(agentId){\n                return this.setControl(agentId, false);\n            },\n            \n            setControl: function(agentId, hasControl){\n                return $http({\n                    method: 'POST',\n                    url: this.getUrl('setRelatedAgentControl'),\n                    data: {agentId: agentId, hasControl: hasControl}\n                }).success(function(data, status){\n                    $rootScope.$emit(hasControl ? 'relatedAgent.controlGiven' : 'relatedAgent.controlRemoved', data);\n                }).error(function(data, status){\n                    $rootScope.$emit('error', { \n                        message: hasControl ? \"Cannot give control to related agent\" : \"Cannot remove control of related agent\", \n                        data: data, \n                        status: status \n                    });\n                });\n            }\n        };\n    }]);\n    \n    module.controller('RelatedAgentsController', ['$scope', '$rootScope', 'RelatedAgentsService', 'EditBox', function($scope, $rootScope, RelatedAgentsService, EditBox) {\n        $scope.editbox = EditBox;\n        \n        $scope.groups = [];\n        \n        for(var i in MapasCulturais.entity.agentRelations)\n            $scope.groups.push({name: i, relations: MapasCulturais.entity.agentRelations[i]});\n        \n        $scope.showCreateDialog = {};\n        \n        $scope.spinners = {};\n        \n        $scope.isEditable = MapasCulturais.isEditable;\n        $scope.canChangeControl = MapasCulturais.entity.canUserCreateRelatedAgentsWithControl;\n        \n        $scope.data = {};\n        \n        $scope.agentRelationDisabledCD = MapasCulturais.agentRelationDisabledCD || [];\n        \n        $scope.disabledCD = function(groupName){\n            return $scope.agentRelationDisabledCD.indexOf(groupName) >= 0;\n        };\n        \n        \n        function getGroup(groupName){\n            var result = null;\n            $scope.groups.forEach(function(group){\n                if(group.name === groupName)\n                    result = group;\n            });\n            \n            return result;\n        }\n        \n        function groupExists(groupName){\n            if(getGroup(groupName))\n                return true;\n            else\n                return false;\n        }\n        \n        $scope.avatarUrl = function(entity){\n            if(entity.avatar.avatarSmall)\n                return entity.avatar.avatarSmall.url;\n            else\n                return MapasCulturais.defaultAvatarURL;\n        };\n        \n        $scope.closeNewGroupEditBox = function(){\n            EditBox.close('new-related-agent-group');\n        };\n        \n        $scope.data.newGroupName = '';\n        \n        $scope.getCreateAgentRelationEditBoxId = function(groupName){\n            return 'add-related-agent-' + groupName.replace(/[^a-z0-9_]/gi,'');\n        };\n        \n        $scope.createGroup = function(){\n            if($scope.data.newGroupName.trim() && !groupExists( $scope.data.newGroupName && $scope.data.newGroupName.toLowerCase().trim() !== 'registration') ){\n                var newGroup = {name: $scope.data.newGroupName, relations: []};\n                \n                $scope.groups = [newGroup].concat($scope.groups);\n                \n                $scope.data.newGroupName = '';\n                EditBox.close('new-related-agent-group');\n            }\n        };\n        \n        $scope.createRelation = function(entity){\n            var _scope = this.$parent;\n            var groupName = _scope.attrs.group;\n            \n            RelatedAgentsService.create(groupName, entity.id).\n                    success(function(data){\n                        var group = getGroup(groupName);\n                        group.relations.push(data);\n                        $scope.showCreateDialog[groupName] = false;\n                        _scope.$parent.searchText = '';\n                        _scope.$parent.result = [];\n                        EditBox.close($scope.getCreateAgentRelationEditBoxId(groupName));\n                    });\n        };\n        \n        $scope.deleteRelation = function(relation){\n            var group = getGroup(relation.group);\n            var oldRelations = group.relations.slice();\n            var i = group.relations.indexOf(relation);\n            \n            group.relations.splice(i,1);\n            \n            RelatedAgentsService.remove(relation.group, relation.agent.id).\n                    error(function(){\n                        group.relations = oldRelations;\n                    });\n        };\n        \n        $scope.toggleControl = function(relation){\n            relation.hasControl = !relation.hasControl;\n            \n            if(relation.hasControl){\n                RelatedAgentsService.giveControl(relation.agent.id).\n                        error(function(){\n                            relation.hasControl = false;\n                        });\n            }else{\n                RelatedAgentsService.removeControl(relation.agent.id).\n                        error(function(){\n                            relation.hasControl = true;\n                        });\n            }\n        };\n        \n        $scope.filterResult = function( data, status ){\n            var group = getGroup( this.attrs.group );\n            \n            if(group && group.relations.length > 0){\n                var ids = group.relations.map( function( el ){ return el.agent.id; } );\n\n                data = data.filter( function( e ){ \n                    if( ids.indexOf( e.id ) === -1 ) \n                        return e;\n                } );\n            }\n            return data;\n        };\n    }]);\n})(angular);","(function(angular){\n    \"use strict\";\n\n    var module = angular.module('entity.module.changeOwner', ['ngSanitize']);\n\n    module.config(['$httpProvider',function($httpProvider){\n        $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';\n        $httpProvider.defaults.transformRequest = function(data) {\n            var result = angular.isObject(data) && String(data) !== '[object File]' ? $.param(data) : data;\n\n            return result;\n        };\n    }]);\n\n    module.factory('ChangeOwnerService', ['$http', '$rootScope', function($http, $rootScope){\n        var controllerId = null,\n            entityId = null,\n            baseUrl = MapasCulturais.baseURL.substr(-1) === '/' ?  MapasCulturais.baseURL : MapasCulturais.baseURL + '/';\n\n        try{ controllerId = MapasCulturais.request.controller; }catch (e){};\n        try{ entityId = MapasCulturais.entity.id; }catch (e){};\n\n        return {\n            controllerId: controllerId,\n\n            entityId: entityId,\n\n            getUrl: function(){\n                return baseUrl + controllerId + '/changeOwner/' + entityId;\n            },\n\n\n        setOwnerTo: function(agentId){\n                return $http.post(this.getUrl(), {ownerId: agentId}).\n                    success(function(data, status){\n                        $rootScope.$emit('changedOwner', { message: \"The entity owner was changed\", data: data, status: status });\n                    }).\n                    error(function(data, status){\n                        $rootScope.$emit('error', { message: \"Cannot change the owner\", data: data, status: status });\n                    });\n            }\n        };\n    }]);\n\n    module.controller('ChangeOwnerController', ['$scope', '$rootScope', '$timeout', 'ChangeOwnerService', 'EditBox', function($scope, $rootScope, $timeout, ChangeOwnerService, EditBox) {\n        var adjustingBoxPosition = false;\n        $scope.editbox = EditBox;\n        $scope.data = {\n            spinner: false,\n            apiQuery: { }\n        };\n        \n        if(!MapasCulturais.entity.userHasControl){\n            $scope.data.apiQuery['@permissions'] = '@control';\n        }\n        \n        var adjustBoxPosition = function(){\n            setTimeout(function(){\n                adjustingBoxPosition = true;\n                $('#change-owner-button').click();\n                adjustingBoxPosition = false;\n            });\n        };\n\n        $rootScope.$on('repeatDone:findEntity:find-entity-change-owner', adjustBoxPosition);\n\n        $scope.$watch('data.spinner', function(ov, nv){\n            if(ov && !nv)\n                adjustBoxPosition();\n        });\n\n        $scope.requestEntity = function(e){\n            ChangeOwnerService.setOwnerTo(e.id).success(function(data, status){\n                if(status === 202){\n                    MapasCulturais.Messages.alert('Sua requisição foi para mudança de propriedade deste ' + MapasCulturais.entity.getTypeName() + ' para o agente <strong>'+e.name+'</strong> foi enviada.');\n                }else{\n                    $('.js-owner-name').html('<a href=\"' + e.singleUrl + '\">' + e.name + '</a>');\n                    $('.js-owner-description').html(e.shortDescription);\n                    try{\n                        $('.js-owner-avatar').attr('src', e['@files:avatar.avatarSmall'].url);\n                    }catch(e){\n                        $('.js-owner-avatar').attr('src', MapasCulturais.defaultAvatarURL);\n                    }\n                }\n            });\n\n            EditBox.close('editbox-change-owner');\n        };\n\n        $('#editbox-change-owner').on('open', function(){\n            if(!adjustingBoxPosition)\n                $('#find-entity-change-owner').trigger('find');\n        });\n\n    }]);\n})(angular);","(function (angular) {\n    \"use strict\";\n    angular.module('entity.directive.editableMultiselect', [])\n        .directive('editableMultiselect', ['EditBox', '$log', function (EditBox, $log) {\n            return {\n                restrict: 'E',\n                templateUrl: MapasCulturais.templateUrl.editableMultiselect,\n                scope: {\n                    entityProperty: '@',\n                    emptyLabel: '@',\n                    boxTitle: '@',\n                    helpText: '@'\n                },\n                link: function ($scope, el, attrs) {\n                    var def = MapasCulturais.entity.definition[attrs.entityProperty];\n                    var entity = MapasCulturais.entity.object;\n                    var originalValue = MapasCulturais.entity.object;\n                    \n                    function resetValues(){\n                        if(entity[$scope.entityProperty]){\n                            $scope.values = entity[$scope.entityProperty].split(';');\n                        }else{\n                            entity[$scope.entityProperty] = '';\n                            $scope.values = [];\n                        }\n                    }\n                    \n                    $scope.inputVal = entity[$scope.entityProperty];\n                    \n                    $scope.editBox = EditBox;\n\n                    $scope.terms = [];\n                    \n                    def.optionsOrder.forEach(function(e){\n                        $scope.terms.push({\n                            label: def.options[e],\n                            value: e\n                        });\n                    });\n                    \n                    $scope.allowOther = def.allowOther;\n                    $scope.allowOtherText = def.allowOtherText;\n\n//                    $scope.boxTitle = ;\n\n                    $log.log($scope.title);\n\n                    $scope.editBoxId = 'editable-multiselect-' + $scope.entityProperty;\n\n                    $scope.cfg = {\n                        isEditable: MapasCulturais.isEditable\n                    };\n\n                    $scope.openEditBox = function($event){\n                        if(MapasCulturais.isEditable){\n                            EditBox.open($scope.editBoxId, $event);\n                        }\n                    };\n                    \n                    resetValues();\n                    \n                    $scope.submit = function(){\n                        entity[$scope.entityProperty] = $scope.values.join(';');\n                        $scope.inputVal = entity[$scope.entityProperty];\n                        var $input = jQuery('#' + $scope.entityProperty);\n                        $input.editable('setValue', $scope.inputVal);\n                        EditBox.close($scope.editBoxId);\n                    };\n                    \n                    $scope.cancel = function(){\n                        resetValues();\n                    };\n                    \n                    $scope.valuesText = function(){\n                        if(entity[$scope.entityProperty]){\n                            return entity[$scope.entityProperty].split(';').join('; ');\n                        }else{\n                            return $scope.emptyLabel;\n                        }\n                    }\n                }\n            };\n        }]);\n})(angular);","(function (angular) {\n    \"use strict\";\n    angular.module('entity.directive.editableSingleselect', [])\n        .directive('editableSingleselect', ['EditBox', '$log', function (EditBox, $log) {\n            return {\n                restrict: 'E',\n                templateUrl: MapasCulturais.templateUrl.editableSingleselect,\n                scope: {\n                    entityProperty: '@',\n                    emptyLabel: '@',\n                    boxTitle: '@',\n                    helpText: '@'\n                },\n                link: function ($scope, el, attrs) {\n                    var def = MapasCulturais.entity.definition[attrs.entityProperty];\n                    var entity = MapasCulturais.entity.object;\n\n                    $scope.editBox = EditBox;\n                    \n                    $scope.terms = [];\n                    \n                    def.optionsOrder.forEach(function(e){\n                        $scope.terms.push({\n                            label: def.options[e],\n                            value: e\n                        });\n                    });\n\n                    $scope.data = {\n                        inputVal: entity[$scope.entityProperty],\n                        isEditable: MapasCulturais.isEditable,\n                        allowOther: def.allowOther,\n                        allowOtherText: def.allowOtherText,\n                        editBoxId: 'editable-singleselect-' + $scope.entityProperty,\n                        value: entity[$scope.entityProperty],\n                        boxTitle: $scope.boxTitle\n                    };\n\n                    function resetValue(){\n                        if(entity[$scope.entityProperty]){\n                            $scope.data.value = entity[$scope.entityProperty];\n                            $scope.data.displayValue = entity[$scope.entityProperty];\n                            $scope.data.inputValue = entity[$scope.entityProperty];\n                        }else{\n                            entity[$scope.entityProperty] = '';\n                            $scope.data.value = '';\n                            $scope.data.displayValue = $scope.emptyLabel;\n                        }\n                    }\n\n                    resetValue();\n\n                    $scope.displayValue = function(){\n                        if($scope.terms[$scope.data.inputVal]){\n                           return $scope.terms[$scope.data.inputVal];\n                        } else {\n                            return $scope.data.inputVal || $scope.emptyLabel;\n                        }\n                    };\n\n\n                    $scope.openEditBox = function($event){\n                        if(MapasCulturais.isEditable){\n                            EditBox.open($scope.data.editBoxId, $event);\n                        }\n                    };\n                    \n                    $scope.submit = function(){\n                        var $input = jQuery('#' + $scope.entityProperty);\n                        \n                        entity[$scope.entityProperty] = $scope.data.value;\n\n                        $scope.data.inputVal = entity[$scope.entityProperty];\n\n                        $scope.data.displayValue = $scope.inputVal ? $scope.inputVal : $scope.emptyLabel;\n\n                        $input.editable('setValue', $scope.data.inputVal);\n\n                        EditBox.close($scope.data.editBoxId);\n                    };\n                    \n                    $scope.cancel = function(){\n                        resetValue();\n                    };\n                }\n            };\n        }]);\n})(angular);","(function(angular){\n    \"use strict\";\n\n    var app = angular.module('entity.app', MapasCulturais.angularAppDependencies);\n\n    app.factory('UrlService', [function(){\n        return function(controller){\n            this.create = function(action, params){\n                if(params == parseInt(params)){ // params is an integer, so it is an id\n                    return MapasCulturais.createUrl(controller, action, [params]);\n                }else{\n                    return MapasCulturais.createUrl(controller, action, params);\n                }\n            };\n        };\n    }]);\n\n    app.controller('EntityController',['$scope', '$timeout', function($scope, $timeout){\n        $scope.data = {\n            teste: 'ALALALALALALA'\n        }\n    }]);\n\n\n    app.directive('onRepeatDone', ['$rootScope', function($rootScope) {\n        return function($scope, element, attrs) {\n            if ($scope.$last) {\n                $rootScope.$emit('repeatDone:' + attrs.onRepeatDone);\n            }\n        };\n    }]);\n\n\n})(angular);","(function (angular) {\n    \"use strict\";\n\n    var module = angular.module('entity.module.project', ['ngSanitize']);\n\n    module.config(['$httpProvider', function ($httpProvider) {\n            $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';\n            $httpProvider.defaults.headers.common[\"X-Requested-With\"] = 'XMLHttpRequest';\n            $httpProvider.defaults.transformRequest = function (data) {\n                var result = angular.isObject(data) && String(data) !== '[object File]' ? $.param(data) : data;\n\n                return result;\n            };\n        }]);\n\n    module.factory('ProjectEventsService', ['$http', '$rootScope', 'UrlService', function ($http, $rootScope, UrlService) {\n            var url = new UrlService('project');\n\n            return {\n                getUrl: function(action){\n                    return url.create(action, MapasCulturais.entity.id);\n                },\n\n                publish: function(ids){\n                   var url = this.getUrl('publishEvents');\n\n                    return $http.post(url, {ids: ids}).\n                            success(function (data, status) {\n                                $rootScope.$emit('project.publishEvents', {message: \"Project events was published\", data: data, status: status});\n                            }).\n                            error(function (data, status) {\n                                $rootScope.$emit('error', {message: \"Cannot publish project events\", data: data, status: status});\n                            });\n\n\n                },\n\n                unpublish: function(ids){\n                    var url = this.getUrl('unpublishEvents');\n\n                    return $http.post(url, {ids: ids}).\n                            success(function (data, status) {\n                                $rootScope.$emit('project.unpublishEvents', {message: \"Project events was unpublished\", data: data, status: status});\n                            }).\n                            error(function (data, status) {\n                                $rootScope.$emit('error', {message: \"Cannot unpublish project events\", data: data, status: status});\n                            });\n                }\n            };\n        }]);\n\n\n\n    module.factory('RegistrationService', ['$http', '$rootScope', 'UrlService', function ($http, $rootScope, UrlService) {\n            var url = new UrlService('registration');\n\n            return {\n                getUrl: function(action, registrationId){\n                    return url.create(action, registrationId);\n                },\n\n                register: function (params) {\n                    var data = {\n                        projectId: MapasCulturais.entity.id,\n                        ownerId: params.owner.id,\n                        category: params.category\n                    };\n                    return $http.post(this.getUrl(), data).\n                            success(function (data, status) {\n                                $rootScope.$emit('registration.create', {message: \"Project registration was created\", data: data, status: status});\n                            }).\n                            error(function (data, status) {\n                                $rootScope.$emit('error', {message: \"Cannot create project registration\", data: data, status: status});\n                            });\n                },\n\n                setStatusTo: function(registration, registrationStatus){\n                    return $http.post(this.getUrl('setStatusTo', registration.id), {status: registrationStatus}).\n                            success(function (data, status) {\n                                registration.status = data.status;\n                                $rootScope.$emit('registration.' + registrationStatus, {message: \"Project registration status was setted to \" + registrationStatus, data: data, status: status});\n                            }).\n                            error(function (data, status) {\n                                $rootScope.$emit('error', {message: \"Cannot \" + registrationStatus + \" project registration\", data: data, status: status});\n                            });\n\n                },\n\n                send: function(registrationId){\n                    return $http.post(this.getUrl('send', registrationId)).\n                            success(function(data, status){\n                                $rootScope.$emit('registration.send', {message: \"Project registration was send \", data: data, status: status});\n                            }).\n                            error(function(data, status){\n                                $rootScope.$emit('error', {message: \"Cannot send project registration\", data: data, status: status});\n                            });\n                }\n\n            };\n        }]);\n\n    module.factory('RegistrationFileConfigurationService', ['$rootScope', '$q', '$http', '$log', 'UrlService', function($rootScope, $q, $http, $log, UrlService) {\n        var url = new UrlService('registrationfileconfiguration');\n        return {\n            getUrl: function(action, id){\n                return url.create(action, id);\n            },\n            create: function(data){\n                var deferred = $q.defer();\n\n                $http.post(this.getUrl(), data)\n                    .success(\n                        function(response){\n                            deferred.resolve(response);\n                        }\n                    );\n                return deferred.promise;\n            },\n            edit: function(data){\n                var deferred = $q.defer();\n\n                $http.post(url.create('single', data.id), data)\n                    .success(\n                        function(response){\n                            deferred.resolve(response);\n                        }\n                    );\n                return deferred.promise;\n            },\n            delete: function(id){\n                var deferred = $q.defer();\n                $http.get(url.create('delete', id))\n                    .success(\n                        function(response){\n                            deferred.resolve(response);\n                        }\n                    );\n                return deferred.promise;\n            }\n        };\n\n    }]);\n    module.controller('RegistrationFileConfigurationsController', ['$scope', '$rootScope', '$timeout', 'RegistrationFileConfigurationService', 'EditBox', '$http', function ($scope, $rootScope, $timeout, RegistrationFileConfigurationService, EditBox, $http) {\n        $scope.isEditable = MapasCulturais.isEditable;\n        $scope.maxUploadSize = MapasCulturais.maxUploadSize;\n        $scope.maxUploadSizeFormatted = MapasCulturais.maxUploadSizeFormatted;\n        $scope.uploadFileGroup = 'registrationFileTemplate';\n        $scope.getUploadUrl = function (ownerId){\n            return RegistrationFileConfigurationService.getUrl('upload', ownerId);\n        };\n\n        var fileConfigurationSkeleton = {\n            ownerId: MapasCulturais.entity.id,\n            title: null,\n            description: null,\n            required: false\n        };\n\n        $scope.data = {\n            fileConfigurations: MapasCulturais.entity.registrationFileConfigurations,\n            newFileConfiguration: angular.copy(fileConfigurationSkeleton),\n            entity: $scope.$parent.data.entity\n        };\n\n        function sortFiles(){\n            $scope.data.fileConfigurations.sort(function(a,b){\n                if(a.title > b.title){\n                    return 1;\n                } else if(a.title < b.title){\n                    return -1;\n                }else {\n                    return 0;\n                }\n            });\n        }\n\n        $scope.fileConfigurationBackups = [];\n\n        $scope.createFileConfiguration = function(){\n            RegistrationFileConfigurationService.create($scope.data.newFileConfiguration).then(function(response){\n                if(!response.error){\n                    $scope.data.fileConfigurations.push(response);\n                    sortFiles();\n                    EditBox.close('editbox-registration-files');\n                    $scope.data.newFileConfiguration = angular.copy(fileConfigurationSkeleton);\n                    MapasCulturais.Messages.success('Anexo criado.');\n                }\n            });\n        };\n\n        $scope.removeFileConfiguration = function (id, $index) {\n            if(confirm('Deseja remover este anexo?')){\n                RegistrationFileConfigurationService.delete(id).then(function(response){\n                    if(!response.error){\n                        $scope.data.fileConfigurations.splice($index, 1);\n                        MapasCulturais.Messages.alert('Anexo removido.');\n                    }\n                });\n            }\n        };\n\n        $scope.editFileConfiguration = function(attrs) {\n            var model = $scope.data.fileConfigurations[attrs.index],\n                data = {\n                    id: model.id,\n                    title: model.title,\n                    description: model.description,\n                    required: model.required,\n                    template: model.template\n                };\n            RegistrationFileConfigurationService.edit(data).then(function(response){\n                if(!response.error){\n                    sortFiles();\n                    EditBox.close('editbox-registration-files-'+data.id);\n                    MapasCulturais.Messages.success('Alterações Salvas.');\n                }\n            });\n        };\n\n        $scope.sendFile = function(attrs){\n            $('#' + attrs.id + ' form').submit();\n        };\n\n        $scope.cancelFileConfigurationEditBox = function(attrs){\n            $scope.data.fileConfigurations[attrs.index] = $scope.fileConfigurationBackups[attrs.index];\n            delete $scope.fileConfigurationBackups[attrs.index];\n        };\n\n        $scope.openFileConfigurationEditBox = function(id, index, event){\n            $scope.fileConfigurationBackups[index] = angular.copy($scope.data.fileConfigurations[index]);\n            EditBox.open('editbox-registration-files-'+id, event);\n        };\n\n        $scope.openFileConfigurationTemplateEditBox = function(id, index, event){\n            EditBox.open('editbox-registration-files-template-'+id, event);\n            initAjaxUploader(id, index);\n\n        };\n\n        $scope.removeFileConfigurationTemplate = function (id, $index) {\n            if(confirm('Deseja remover este modelo?')){\n                $http.get($scope.data.fileConfigurations[$index].template.deleteUrl).success(function(response){\n                    delete $scope.data.fileConfigurations[$index].template;\n                    MapasCulturais.Messages.alert('Modelo removido.');\n                });\n            }\n        };\n\n        var initAjaxUploader = function(id, index){\n            var $form = $('#editbox-registration-files-template-' + id + ' form');\n            MapasCulturais.AjaxUploader.resetProgressBar($form);\n\n            if($form.data('initialized'))\n                return;\n            MapasCulturais.AjaxUploader.init($form);\n\n            $('#editbox-registration-files-template-'+id).on('cancel', function(){\n                if($form.data('xhr')) $form.data('xhr').abort();\n                $form.get(0).reset();\n                MapasCulturais.AjaxUploader.resetProgressBar($form);\n            });\n\n            $form.on('ajaxForm.success', function(evt, response){\n                $scope.data.fileConfigurations[index].template = response[$scope.uploadFileGroup];\n                $scope.$apply();\n                setTimeout(function(){\n                    EditBox.close('editbox-registration-files-template-'+id, event);\n                }, 700);\n           });\n        };\n\n    }]);\n\n    module.controller('ProjectEventsController', ['$scope', '$rootScope', '$timeout', 'ProjectEventsService', 'EditBox', '$http', 'UrlService', function ($scope, $rootScope, $timeout, ProjectEventsService, EditBox, $http, UrlService) {\n        $scope.events = $scope.data.entity.events.slice();\n        $scope.numSelectedEvents = 0;\n\n        $scope.events.forEach(function(evt){\n            evt.statusText = '';\n\n            if(evt.status == 1){\n                evt.statusText = 'publicado';\n            } else if(evt.status == 0){\n                evt.statusText = 'rascunho';\n            }\n        });\n\n        $scope.$watch('events', function(){\n            var num = 0;\n            $scope.events.forEach(function(e){\n                if(e.selected){\n                    num++;\n                }\n            });\n\n            $scope.numSelectedEvents = num;\n        }, true);\n\n        $scope.selectAll = function(){\n            $scope.events.forEach(function(e){\n                if(!e.hidden){\n                    e.selected = true;\n                }\n            });\n        };\n\n        $scope.deselectAll = function(){\n            $scope.events.forEach(function(e){\n                if(!e.hidden){\n                    e.selected = false;\n                }\n            });\n        };\n\n\n\n        $scope.eventFilterTimeout = null;\n\n        $scope.filterEvents = function(){\n            $timeout.cancel($scope.eventFilterTimeout);\n            $scope.eventFilterTimeout = $timeout(function() {\n                var keywords = $scope.data.eventFilter.toLowerCase().split(' ');\n\n                $scope.events.forEach(function(evt,i){\n                    var show = true;\n                    keywords.forEach(function(keyword){\n                        keyword = keyword.trim();\n                        var match = false;\n                        if(evt.name.toLowerCase().indexOf(keyword) >= 0){\n                            match = true;\n                        }else if(evt.owner.name.toLowerCase().indexOf($scope.data.eventFilter.toLowerCase()) >= 0){\n                            match = true;\n                        }else if(evt.statusText.indexOf(keyword) >= 0){\n                            match = true;\n                        }else if(evt.classificacaoEtaria.toLowerCase().indexOf(keyword) >= 0){\n                            match = true;\n                        }else{\n                            evt.occurrences.forEach(function(o){\n                                if(o.space.name.toLowerCase().indexOf($scope.data.eventFilter.toLowerCase()) >= 0){\n                                    match = true;\n                                }\n                            });\n\n                            evt.terms.linguagem.forEach(function(term){\n                                if(term.toLowerCase().indexOf(keyword) >= 0){\n                                    match = true;\n                                }\n                            });\n                        }\n\n                        show = show && match;\n\n                    });\n                    evt.hidden = !show;\n\n                });\n            },500);\n\n        };\n\n        $scope.processing = false;\n\n        $scope.publishSelectedEvents = function(){\n            var ids = [],\n                events = [];\n\n            if($scope.data.processing){\n                return;\n            }\n\n            $scope.events.forEach(function(e,i){\n                if(e.selected){\n                    ids.push(e.id);\n                    events.push(e);\n                }\n            });\n\n            if(!ids.length){\n                return;\n            }\n\n            $scope.data.processingText = 'Publicando...';\n\n            $scope.data.processing = true;\n\n            ProjectEventsService.publish(ids.toString()).success(function(){\n                MapasCulturais.Messages.success('Eventos publicados.');\n                events.forEach(function(e){\n                    e.status = 1;\n                    e.statusText = 'publicado';\n                });\n\n                $scope.data.processing = false;\n            });\n        };\n\n        $scope.unpublishSelectedEvents = function(){\n            var ids = [],\n                events = [];\n\n            if($scope.data.processing){\n                return;\n            }\n\n            $scope.events.forEach(function(e,i){\n                if(e.selected){\n                    ids.push(e.id);\n                    events.push(e);\n                }\n            });\n\n            if(!ids.length){\n                return;\n            }\n\n            $scope.data.processingText = 'Tornando rascunho...';\n\n            $scope.data.processing = true;\n\n            ProjectEventsService.unpublish(ids.toString()).success(function(){\n                MapasCulturais.Messages.success('Eventos transformados em rascunho.');\n                events.forEach(function(e){\n                    e.status = 0;\n                    e.statusText = 'rascunho';\n                });\n\n                $scope.data.processing = false;\n            });\n        };\n\n\n        $scope.toggle = false;\n    }]);\n\n\n    module.controller('RegistrationFilesController', ['$scope', '$rootScope', '$timeout', 'RegistrationFileConfigurationService', 'EditBox', '$http', 'UrlService', function ($scope, $rootScope, $timeout, RegistrationFileConfigurationService, EditBox, $http, UrlService) {\n        var registrationsUrl = new UrlService('registration');\n\n        $scope.uploadUrl = registrationsUrl.create('upload', MapasCulturais.entity.id);\n\n        $scope.maxUploadSizeFormatted = MapasCulturais.maxUploadSizeFormatted;\n\n        $scope.data = {\n            fileConfigurations: MapasCulturais.entity.registrationFileConfigurations\n        };\n\n        $scope.data.fileConfigurations.forEach(function(item){\n            item.file = MapasCulturais.entity.registrationFiles[item.groupName];\n        });\n\n        $scope.sendFile = function(attrs){\n            var $form = $('#' + attrs.id + ' form');\n            $form.submit();\n            if(!$form.data('onSuccess')){\n                $form.data('onSuccess', true);\n                $form.on('ajaxForm.success', function(){\n                    MapasCulturais.Messages.success('Alterações salvas.');\n                });\n            }\n        };\n\n        $scope.openFileEditBox = function(id, index, event){\n            EditBox.open('editbox-file-'+id, event);\n            initAjaxUploader(id, index);\n        };\n\n        $scope.removeFile = function (id, $index) {\n            if(confirm('Deseja remover este anexo?')){\n                $http.get($scope.data.fileConfigurations[$index].file.deleteUrl).success(function(response){\n                    delete $scope.data.fileConfigurations[$index].file;\n                });\n            }\n        };\n\n        var initAjaxUploader = function(id, index){\n            var $form = $('#editbox-file-' + id + ' form');\n            if($form.data('initialized'))\n                return;\n            MapasCulturais.AjaxUploader.init($form);\n\n            $('#editbox-file-'+id).on('cancel', function(){\n                if($form.data('xhr')) $form.data('xhr').abort();\n                $form.get(0).reset();\n                MapasCulturais.AjaxUploader.resetProgressBar($form);\n            });\n\n            $form.on('ajaxForm.success', function(evt, response){\n                $scope.data.fileConfigurations[index].file = response[$scope.data.fileConfigurations[index].groupName];\n                $scope.$apply();\n                setTimeout(function(){\n                    EditBox.close('editbox-file-'+id, event);\n                }, 700);\n           });\n        };\n\n    }]);\n\n    module.controller('ProjectController', ['$scope', '$rootScope', '$timeout', 'RegistrationService', 'EditBox', 'RelatedAgentsService', '$http', 'UrlService', function ($scope, $rootScope, $timeout, RegistrationService, EditBox, RelatedAgentsService, $http, UrlService) {\n            var adjustingBoxPosition = false,\n                categories = MapasCulturais.entity.registrationCategories.length ? MapasCulturais.entity.registrationCategories.map(function(e){\n                    return { value: e, label: e };\n                }) : [];\n\n            $scope.editbox = EditBox;\n            $scope.data = angular.extend({\n                uploadSpinner: false,\n                spinner: false,\n\n                registrationCategories: categories,\n                registrationCategoriesToFilter: [{value: null, label: 'Todas opções'}].concat(categories),\n\n                registration: {\n                    owner: null,\n                    category: null\n                },\n\n                registrationStatuses:[\n                    {value: null, label: 'Todas'},\n                    {value: 1, label: 'Pendente'},\n                    {value: 2, label: 'Inválida'},\n                    {value: 3, label: 'Não selecionada'},\n                    {value: 8, label: 'Suplente'},\n                    {value: 10, label: 'Selecionada'}\n                ],\n\n                registrationStatusesNames: [\n                    {value: 1, label: 'Pendente'},\n                    {value: 2, label: 'Inválida'},\n                    {value: 3, label: 'Não selecionada'},\n                    {value: 8, label: 'Suplente'},\n                    {value: 10, label: 'Selecionada'},\n                    {value: 0, label: 'Rascunho'}\n                ],\n\n                publishedRegistrationStatuses:[\n                    {value: null, label: 'Todas'},\n                    {value: 8, label: 'Suplente'},\n                    {value: 10, label: 'Selecionada'}\n                ],\n\n                publishedRegistrationStatusesNames: [\n                    {value: 8, label: 'Suplente'},\n                    {value: 10, label: 'Selecionada'}\n                ],\n\n                publishedRegistrationStatus: 10,\n\n                propLabels : [],\n\n                relationApiQuery: {}\n            }, MapasCulturais);\n\n            for(var name in MapasCulturais.labels.agent){\n                var label = MapasCulturais.labels.agent[name];\n                $scope.data.propLabels.push({\n                    name: name,\n                    label: label\n                });\n            }\n\n            if(MapasCulturais.entity.registrationAgents){\n                MapasCulturais.entity.registrationAgents.forEach(function(e){\n                    $scope.data.relationApiQuery[e.agentRelationGroupName] = {type: 'EQ(' + e.type + ')'};\n                    if(e.agentRelationGroupName === 'owner'){\n                        $scope.data.relationApiQuery[e.agentRelationGroupName]['@permissions'] = '@control';\n                    }\n                });\n            }else{\n                $scope.data.relationApiQuery.owner = {'@permissions': '@control', 'type': 'EQ(1)'};\n            }\n            $scope.fns = {};\n\n            $scope.hideStatusInfo = function(){\n                jQuery('#status-info').slideUp('fast');\n            };\n\n            $scope.openEditBox = function(id, e){\n                EditBox.open(id, e);\n            };\n\n            $scope.getStatusSlug = function(status){\n                /*\n                        const STATUS_SENT = self::STATUS_ENABLED;\n                        const STATUS_APPROVED = 10;\n                        const STATUS_WAITLIST = 8;\n                        const STATUS_NOTAPPROVED = 3;\n                        const STATUS_INVALID = 2;\n                 */\n                switch (status){\n                    case 0: return 'draft'; break;\n                    case 1: return 'sent'; break;\n                    case 2: return 'invalid'; break;\n                    case 3: return 'notapproved'; break;\n                    case 8: return 'waitlist'; break;\n                    case 10: return 'approved'; break;\n                }\n            };\n\n            $scope.getStatusNameById = function(id){\n                var statuses = $scope.data.registrationStatusesNames\n                for(var s in statuses){\n                    if(statuses[s].value == id)\n                        return statuses[s].label;\n                }\n            };\n\n            $scope.setRegistrationStatus = function(registration, status){\n                if(MapasCulturais.entity.userHasControl && (status.value !== 0 || confirm('Você tem certeza que deseja reabrir este formulário para edição? Ao fazer isso, ele sairá dessa lista.'))){\n                    RegistrationService.setStatusTo(registration, $scope.getStatusSlug(status.value)).success(function(entity){\n                        if(registration.status === 0){\n                            $scope.data.entity.registrations.splice($scope.data.entity.registrations.indexOf(registration),1);\n                        }\n                    });\n                }\n            };\n\n            $scope.getRegistrationStatus = function(registration){\n                return registration.status;\n            };\n\n            $scope.getReadableLocation = function(location){\n                if(angular.isString(location) && location){\n                    location = JSON.parse(location);\n                }\n\n                if(location){\n                    return location.latitude + ',' + location.longitude;\n                }\n            };\n\n\n            $scope.showRegistration = function(registration){\n                var status = !$scope.data.registrationStatus || $scope.data.registrationStatus === registration.status;\n                var category = !$scope.data.registrationCategory || $scope.data.registrationCategory === registration.category;\n\n                return status && category;\n            };\n\n            $scope.getFilteredRegistrations = function(){\n                return $scope.data.entity.registrations.filter(function(e){\n                    return $scope.showRegistration(e);\n                });\n            };\n\n            $scope.usingFilters = function(){\n                return $scope.data.registrationStatus || $scope.data.registrationCategory;\n            };\n\n            var adjustBoxPosition = function () {\n                setTimeout(function () {\n                    adjustingBoxPosition = true;\n                    $('#select-registration-owner-button').click();\n                    adjustingBoxPosition = false;\n                });\n            };\n\n            $rootScope.$on('repeatDone:findEntity:find-entity-registration-owner', adjustBoxPosition);\n\n            $scope.$watch('data.spinner', function (ov, nv) {\n                if (ov && !nv)\n                    adjustBoxPosition();\n            });\n\n            function replaceRegistrationAgentBy(groupName, agent, relationStatus){\n                for(var i in $scope.data.entity.registrationAgents){\n                    var def = $scope.data.entity.registrationAgents[i];\n                    if(def.agentRelationGroupName === groupName){\n                        def.agent = agent;\n                        if(typeof relationStatus !== 'undefined'){\n                            def.relationStatus = relationStatus;\n                        }\n                    }\n                }\n            }\n\n            $scope.setRegistrationOwner = function(agent){\n                $scope.data.registration.owner = agent;\n                replaceRegistrationAgentBy('owner', agent);\n                jQuery('#ownerId').editable('setValue', agent.id);\n                setTimeout(function(){\n                    $('#submitButton').trigger('click');\n                });\n                EditBox.close('editbox-select-registration-owner');\n            };\n\n            $scope.setRegistrationAgent = function(entity, attrs){\n                if(attrs.name === 'owner'){\n                    $scope.setRegistrationOwner(entity);\n                    return;\n                }\n                var editBoxId = 'editbox-select-registration-' + attrs.name;\n                RelatedAgentsService.create(attrs.name, entity.id).success(function(response){\n                    if(response.agent.avatar && response.agent.avatar.avatarSmall){\n                        response.agent.avatarUrl = response.agent.avatar.avatarSmall.url;\n                    }\n                    replaceRegistrationAgentBy(attrs.name, response.agent, response.status);\n                    EditBox.close(editBoxId);\n                    if(response.status > 0)\n                        MapasCulturais.Messages.success('Alterações salvas.');\n                });\n            };\n\n            $scope.unsetRegistrationAgent = function(entityId, groupName){\n                if(groupName === 'owner')\n                    return null;\n\n                var editBoxId = 'editbox-select-registration-' + groupName;\n                RelatedAgentsService.remove(groupName, entityId).success(function(){\n                    for(var i in $scope.data.entity.registrationAgents){\n                        var def = $scope.data.entity.registrationAgents[i];\n                        if(def.agentRelationGroupName === groupName)\n                            delete def.agent;\n                    }\n                    EditBox.close(editBoxId);\n                });\n            };\n\n            $('#editbox-select-registration-owner').on('open', function () {\n                if (!adjustingBoxPosition)\n                    $('#find-entity-registration-owner').trigger('find');\n            });\n\n            $scope.register = function(){\n                var registration = $scope.data.registration;\n\n                if(registration.owner){\n                    RegistrationService.register(registration).success(function(rs){\n                        document.location = rs.editUrl;\n                    });\n                }else{\n                    MapasCulturais.Messages.error('Para se inscrever neste projeto você deve selecionar um agente responsável.');\n                }\n            };\n\n            $scope.sendRegistrationRulesFile = function(){\n                $('#edibox-upload-rules form').submit();\n            };\n\n            $scope.openRulesUploadEditbox = function(event){\n                EditBox.open('edibox-upload-rules', event);\n                initAjaxUploader('edibox-upload-rules');\n            };\n\n\n            $scope.removeRegistrationRulesFile = function (id, $index) {\n                if(confirm('Deseja remover este anexo?')){\n                    $http.get($scope.data.entity.registrationRulesFile.deleteUrl).success(function(response){\n                        $scope.data.entity.registrationRulesFile = null;\n                    });\n                }\n            };\n\n            var initAjaxUploader = function(id){\n                var $form = $('#' + id + ' form');\n\n                if($form.data('initialized'))\n                    return;\n\n                MapasCulturais.AjaxUploader.init($form);\n\n                $('#'+id).on('cancel', function(){\n                    if($form.data('xhr')) $form.data('xhr').abort();\n                    $form.get(0).reset();\n                    MapasCulturais.AjaxUploader.resetProgressBar($form);\n                });\n\n                $form.on('ajaxForm.success', function(evt, response){\n                    $scope.data.entity.registrationRulesFile = response['rules'];\n                    $scope.$apply();\n                    setTimeout(function(){\n                        EditBox.close(id);\n                    }, 700);\n               });\n            };\n\n            if(MapasCulturais.request.controller === 'registration'){\n                //hide submit button and category submit on change\n                $('#submitButton').hide();\n                $('.js-editable-registrationCategory').on('save', function(){\n                    setTimeout(function(){\n                        $('#submitButton').trigger('click');\n                    });\n                });\n            }\n\n            $scope.sendRegistration = function(){\n                RegistrationService.send($scope.data.entity.id).success(function(response){\n                    $('.js-response-error').remove();\n                    if(response.error){\n                        var focused = false;\n                        Object.keys(response.data).forEach(function(field, index){\n                            var $el;\n                            if(field === 'category'){\n                                $el = $('.js-editable-registrationCategory').parent();\n                            }else if(field.indexOf('agent') !== -1){\n                                $el = $('#' + field).parent().find('.registration-label');\n                            }else {\n                                $el = $('#' + field).find('div:first');\n                            }\n                            var message = response.data[field] instanceof Array ? response.data[field].join(' ') : response.data[field];\n                            message = message.replace(/\"/g, '&quot;');\n                            $scope.data.propLabels.forEach(function(prop){\n                                message = message.replace('{{'+prop.name+'}}', prop.label);\n                            });\n                            $el.append('<span title=\"' + message + '\" class=\"danger hltip js-response-error\" data-hltip-classes=\"hltip-danger\"></span>');\n                            if(!focused){\n                                $('html,body').animate({scrollTop: $el.parents('li').get(0).offsetTop - 10}, 300);\n                                focused = true;\n                            }\n                        });\n                        MapasCulturais.Messages.error('Corrija os erros indicados abaixo.');\n                    }else{\n                        MapasCulturais.Messages.success('Inscrição enviada. Aguarde tela de sumário.');\n                        document.location = response.singleUrl;\n                    }\n                });\n            };\n\n            var url = new UrlService('project');\n\n            $scope.publish = function(){\n                $http.post(url.create('publish', $scope.data.entity.id)).\n                    success(function(r){\n                        alert('publicado');\n                    }).error(function(r){\n                        alert('erro');\n                    });\n            };\n        }]);\n})(angular);","(function($){\n    MapasCulturais.Map = {};\n    L.Icon.Default.imagePath = MapasCulturais.assetURL + 'img/';\n\n    MapasCulturais.Map.initialize = function(initializerOptions) {\n\n        var config = MapasCulturais.mapsDefaults,\n            mapSelector = initializerOptions.mapSelector,\n            defaultIconOptions = {\n                shadowUrl: MapasCulturais.assets.pinShadow,\n                iconSize: [35, 43], // size of the icon\n                shadowSize: [40, 16], // size of the shadow\n                iconAnchor: [20, 30], // point of the icon which will correspond to marker's location\n                shadowAnchor: [6, 3], // the same for the shadow\n                popupAnchor: [-3, -76] // point from which the popup should open relative to the iconAnchor\n            },\n            iconTypeMapping = {\n                agent: MapasCulturais.assets.pinAgent,\n                coletivo: MapasCulturais.assets.pinAgent,\n                space: MapasCulturais.assets.pinSpace,\n                event: MapasCulturais.assets.pinEvent,\n                location: MapasCulturais.assets.pinMarker\n            };\n\n        MapasCulturais.Map.iconOptions = {};\n\n        for(var iconType in iconTypeMapping){\n            var opts = (JSON.parse(JSON.stringify(defaultIconOptions)));\n            opts.iconUrl = iconTypeMapping[iconType];\n            MapasCulturais.Map.iconOptions[iconType] = {\n                icon: L.icon(opts)\n            };\n        }\n\n        if(initializerOptions.exportToGlobalScope){\n            window.leaflet = {};\n            window.leaflet.iconOptions = MapasCulturais.Map.iconOptions;\n        }\n\n        $(mapSelector).each(function() {\n            if($(this).data('init')){\n                return;\n            }\n            $(this).data('init',true);\n            var id = $(this).attr('id');\n            var isEditable = initializerOptions.isMapEditable===false ? false : MapasCulturais.isEditable;\n            if (!isEditable)\n                $('#' + id + ':active').css({'cursor': 'default'});\n            var $dataTarget = $('#map-target');\n            var isPositionDefined = $(this).data('lat') ? true : false;\n            var defaultZoom = isPositionDefined ? config.zoomPrecise : config.zoomDefault;\n            var defaultLocateMaxZoom = config.zoomPrecise;\n            var defaultAproximatePrecisionZoom = config.zoomApproximate;\n            var defaultMaxCircleRadius = 1000;\n            var mapCenter = isPositionDefined ? new L.LatLng($(this).data('lat'), $(this).data('lng')) : new L.LatLng(config.latitude, config.longitude);\n            var options = $(this).data('options') ? $(this).data('options') : {dragging: true, zoomControl: true, doubleClickZoom: true, scrollWheelZoom: true};\n\n            var locateMeControl = initializerOptions.locateMeControl ? true : false;\n\n            if(initializerOptions.mapCenter){\n                options.center = new L.LatLng( initializerOptions.mapCenter.lat, initializerOptions.mapCenter.lng);\n            }else{\n                options.center = mapCenter;\n            }\n\n            options.zoom = defaultZoom;\n            options.zoomControl = false;\n            options.minZoom = config.zoomMin;\n            var openStreetMap = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n                attribution: 'Dados e Imagens &copy; <a href=\"http://www.openstreetmap.org/copyright\">Contrib. OpenStreetMap</a>, ',\n                maxZoom: config.zoomMax\n            });\n\n            var map = new L.Map(id, options).addLayer(openStreetMap);\n            $(this).data('leaflet-map', map);\n            var timeout;\n            $(window).scroll(function() {\n                map.scrollWheelZoom.disable();\n                clearTimeout(timeout);\n                timeout = setTimeout(function() {\n                    if(!MapasCulturais.reenableScrollWheelZoom)\n                        map.scrollWheelZoom.enable();\n                }, 400);\n            });\n\n            var marker = new L.marker(map.getCenter(), {draggable: isEditable && MapasCulturais.request.controller !== 'event' });\n            var markerIcon = {};\n            if (MapasCulturais.request.controller == 'agent' || MapasCulturais.request.controller == 'space')\n                markerIcon = MapasCulturais.Map.iconOptions[MapasCulturais.request.controller].icon;\n            else if(MapasCulturais.request.controller == 'event')\n                markerIcon = MapasCulturais.Map.iconOptions['space'].icon;\n\n            if(Object.keys(markerIcon).length){\n                marker.setIcon(markerIcon);\n                map.addLayer(marker);\n            }\n\n            if (isPositionDefined) {\n                marker.setLatLng(mapCenter).addTo(map);\n            }\n\n            /* Events */\n            marker.on('move', function(e) {\n                if (isEditable) {\n                    $dataTarget.editable('setValue', [e.latlng.lng, e.latlng.lat]);\n                }\n            });\n\n            map.on('locationfound', function(e) {\n                var radius = e.accuracy / 2;\n                if (true || radius > defaultMaxCircleRadius)\n                    radius = defaultMaxCircleRadius;\n\n                marker.setLatLng(e.latlng);\n            });\n\n            map.on('locationerror', function(e) {\n                /** @TODO feedback pro usuario **/\n                // console.log(e.message);\n            });\n\n            map.on('click', function(e) {\n                if (isEditable && MapasCulturais.request.controller !== 'event')\n                    marker.setLatLng(e.latlng);\n            });\n\n            $('#locate-me').click(function() {\n                map.locate({setView: true, maxZoom: defaultLocateMaxZoom});\n            });\n\n            L.Polygon.prototype.getCenter = function() {\n                var pts = this._latlngs;\n                var off = pts[0];\n                var twicearea = 0;\n                var x = 0;\n                var y = 0;\n                var nPts = pts.length;\n                var p1, p2;\n                var f;\n                for (var i = 0, j = nPts - 1; i < nPts; j = i++) {\n                    p1 = pts[i];\n                    p2 = pts[j];\n                    f = (p1.lat - off.lat) * (p2.lng - off.lng) - (p2.lat - off.lat) * (p1.lng - off.lng);\n                    twicearea += f;\n                    x += (p1.lat + p2.lat - 2 * off.lat) * f;\n                    y += (p1.lng + p2.lng - 2 * off.lng) * f;\n                }\n                f = twicearea * 3;\n                return new L.LatLng(\n                    x / f + off.lat,\n                    y / f + off.lng\n                    );\n            };\n\n            // activate google service\n            var geocoder = null;\n            if(typeof google !== 'undefined')\n                geocoder =  new google.maps.Geocoder();\n\n            // callback to handle google geolocation result\n            function geocode_callback(results, status) {\n                if(typeof google === 'undefined'){\n                    return false;\n                }\n                if (status == google.maps.GeocoderStatus.OK) {\n                    var location = results[0].geometry.location;\n                    var foundLocation = new L.latLng(location.lat(), location.lng());\n                    map.setView(foundLocation, config.zoomPrecise);\n                    marker.setLatLng(foundLocation);\n                }\n            }\n\n            $('.js-editable').on('save', function(e, params) {\n                if ($(this).data('edit') == 'endereco') {\n                    $(this).trigger('changeAddress', params.newValue);\n                }\n            });\n\n            $('.js-editable[data-edit=\"endereco\"]').on('changeAddress', function(event, strAddress){\n                geocoder.geocode({'address': strAddress + ', Brasil'}, geocode_callback);\n            });\n\n            //Mais controles\n            if (isEditable) {\n                var locateMeControl = L.Control.extend({\n                    options: {\n                        position: 'topright'\n                    },\n                    onAdd: function(map) {\n                        var controlDiv = L.DomUtil.create('div', 'leaflet-control-command');\n                        L.DomEvent\n                            .addListener(controlDiv, 'click', L.DomEvent.stopPropagation)\n                            .addListener(controlDiv, 'click', L.DomEvent.preventDefault)\n                            .addListener(controlDiv, 'click', function() {\n                                map.locate({setView: true, maxZoom: defaultLocateMaxZoom});\n                            });\n\n                        var controlUI = L.DomUtil.create('div', 'leaflet-control-command-interior', controlDiv);\n                        controlUI.title = 'Localizar sua posição através do navegador';\n                        controlUI.innerHTML = '<span class=\"icon icon-show-map\"></span> Localize-me';\n                        return controlDiv;\n                    }\n                });\n\n                if (initializerOptions.locateMeControl)\n                    map.addControl(new locateMeControl({}));\n            }\n\n\n            var camadasBase = {};\n            camadasBase['OpenStreetMap'] = openStreetMap;\n\n            if(config.includeGoogleLayers && typeof google !== 'undefined') {\n                var googleSatelite = new L.Google();\n\n                var googleMapa = new L.Google();\n                googleMapa._type = 'ROADMAP';\n                googleMapa.options.maxZoom = 23;\n\n                var googleHibrido = new L.Google();\n                googleHibrido._type = 'HYBRID';\n\n                var googleRelevo = new L.Google();\n                googleRelevo._type = 'TERRAIN';\n                googleRelevo.options.maxZoom = 15;\n\n                /*Criação do Mapa*/\n                var camadasGoogle = {\n                    \"Google Satélite\": googleHibrido,\n                    \"Google Mapa\": googleMapa,\n                    \"Google Satélite Puro\": googleSatelite,\n                    \"Google Relevo\": googleRelevo\n                };\n\n                for ( var key in camadasGoogle) {\n                    camadasBase[key] = camadasGoogle[key];\n                };\n            }\n\n            var geoDivisions = new lvector.PRWSF({\n                url: MapasCulturais.vectorLayersURL,\n                geotable: '\"geo_division\"',\n                fields: \"id,name\",\n                //where: 'true',\n                geomFieldName: MapasCulturais.mapGeometryFieldQuery,\n                uniqueField: \"id\",\n                srid: 4326,\n                showAll: true,\n                mouseoverEvent: function(feature, event) {\n                    var labelText = feature.properties.name;\n                    var vector = event.target;\n                    vector.bindLabel('<b style=\"text-transform: capitalize;\">' + labelText.toLowerCase() + '</b>');\n                    map.showLabel(vector.label.setLatLng(vector.getCenter()));\n                },\n                singlePopup: true,\n                symbology: {\n                    type: \"single\",\n                    vectorOptions: {\n                        // @TODO: rename this class\n                        className : 'vetorial-sp'\n                    }\n                }\n            });\n\n            /*Controles*/\n            (new L.Control.FullScreen({position: 'bottomright', title: 'Tela Cheia'})).addTo(map);\n            (new L.Control.Zoom({position: 'bottomright'})).addTo(map);\n            var geoDivisionsObj = {};\n            for(var div_id in MapasCulturais.geoDivisionsHierarchy){\n                var div_label = MapasCulturais.geoDivisionsHierarchy[div_id];\n                geoDivisionsObj['<span class=\"js-geo-division\" data-type=\"' + div_id + '\">' + div_label + '</span>'] = {onAdd:function(map){return;}, onRemove:function(map){return;}};\n            };\n\n            var layersControl = new L.Control.Layers(camadasBase, geoDivisionsObj);\n\n            layersControl.addTo(map);\n            function setGeoChecboxes(type) {\n                $('.js-geo-division').each(function () {\n                    if ($(this).data('type') != type)\n                        $(this).parents('label').find('input:checkbox').prop('checked', false);\n                });\n            }\n\n            $('.js-geo-division').each(function(){\n                var $checkbox = $(this).parents('label').find('input:checkbox');\n                var type = $(this).data('type');\n\n                $checkbox.on('click', function(event){\n                    geoDivisions.setMap(null);\n\n                    if ($(this).prop('checked') === true) {\n                        setGeoChecboxes(type);\n\n                        geoDivisions.options.where = \"type='\" + type.toLowerCase() + \"'\";\n                        geoDivisions.options.geoDivisionType = type;\n                        geoDivisions.setMap(map);\n                    } else {\n                        geoDivisions.setMap(null);\n                    }\n                });\n            });\n\n            geoDivisions._makeJsonpRequest = function(url){\n                $('#resultados span[ng-if=\"!spinnerCount\"]').hide();\n                $('#resultados span[ng-show=\"spinnerCount > 0\"]').removeClass('ng-hide');\n                $.ajax({\n                    url: url,\n                    dataType: 'jsonp',\n                    //jsonpCallback: myCallback,\n                    cache: true,\n                    success: function(data) {\n                        geoDivisions._processFeatures(data);\n                        $('#resultados span[ng-if=\"!spinnerCount\"]').show();\n                        $('#resultados span[ng-show=\"spinnerCount > 0\"]').addClass('ng-hide');\n\n                        setGeoChecboxes(geoDivisions.options.geoDivisionType);\n                    }\n                });\n\n            };\n\n            if (initializerOptions.exportToGlobalScope) {\n                window.leaflet.map = map;\n                window.leaflet.marker = marker;\n            }\n        });\n\n        $('.js-leaflet-control').each(function(){\n            var $control = $(this);\n            $control.addClass('leaflet-control');\n            $('.leaflet-control-container').each(function(){\n                $(this).find($control.data('leaflet-target')).append($control);\n            });\n        });\n\n        $('.js-leaflet-control').on('click dblclick mousedown startdrag', function(e){\n            e.stopPropagation();\n        });\n    };\n\n    $(function(){\n\n        if($('body').hasClass('controller-agent')){\n            if(MapasCulturais.isEditable){\n                var publicLocation = $('[data-edit=\"publicLocation\"]').editable('getValue').publicLocation;\n                var empty = publicLocation === undefined;\n\n                if(!empty){\n                    MapasCulturais.Map.initialize({mapSelector: '.js-map', locateMeControl: false, exportToGlobalScope: true, mapCenter:MapasCulturais.mapCenter});\n                }else{\n                    $('.js-map').parent().hide();\n                }\n\n                $('[data-edit=\"publicLocation\"]').on('hidden', function(){\n                    var publicLocation = $(this).data('editable').value;\n                    var empty = publicLocation === 'null';\n                    if(!empty){\n                        $('.js-map-container').show();\n                        MapasCulturais.Map.initialize({mapSelector: '.js-map', locateMeControl: false, exportToGlobalScope: true, mapCenter:MapasCulturais.mapCenter});\n                    }else{\n                        $('#map-target').editable('setValue', [0, 0]);\n                        $('.js-map-container').hide();\n                    }\n\n                });\n            }else{\n                MapasCulturais.Map.initialize({mapSelector: '.js-map', locateMeControl: false, exportToGlobalScope: true, mapCenter:MapasCulturais.mapCenter});\n            }\n        }\n\n        if($('body').hasClass('controller-space') || $('body').hasClass('controller-event')){\n            MapasCulturais.Map.initialize({mapSelector: '.js-map', locateMeControl: false, exportToGlobalScope: true, mapCenter:MapasCulturais.mapCenter});\n        }\n\n        var timeout;\n        $(window).scroll(function() {\n            try{\n                leaflet.map.scrollWheelZoom.disable();\n                clearTimeout(timeout);\n                timeout = setTimeout(function() {\n                    leaflet.map.scrollWheelZoom.enable();\n                }, 400);\n            }catch(e){ }\n        });\n\n    });\n\n    // Fix Leaflet FUllScreen control that not allows keyboard inputs\n    (function(){\n        window.fullScreenApi.requestFullScreen = function(el) {\n\n            //Change the element to use <html> tag in Search\n            if(MapasCulturais.request.controller === 'site'){\n                el = document.querySelector('html');\n            }\n\n            //Add permission to allow keyboard input\n            return (this.prefix === '') ?\n                el.requestFullscreen(Element.ALLOW_KEYBOARD_INPUT)\n            :\n                el[this.prefix + 'RequestFullScreen'](Element.ALLOW_KEYBOARD_INPUT);\n\n            //Scroll the window to the bottom\n            //didn't work window.scrollTo(0,document.body.scrollHeight);\n        };\n    })();\n})(jQuery);\n"]}